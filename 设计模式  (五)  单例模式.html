<html>
<head>
  <title>设计模式  (五) : 单例模式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="7DE3DB51-BDD3-4E5A-BBD5-DC5D1AF77418"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1165"/>
<h1>设计模式  (五) : 单例模式</h1>

<div>
<span><h1><font style="font-size: 18px;">单例模式</font></h1><div>单例模式，是一种常用的软件设计模式。在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中一个类只有一个实例。即一个类只有一个对象实例！</div><h2><span style="font-weight: bold;"><br/></span></h2><h2><span style="font-weight: bold;"><font style="font-size: 18px;">一. 单例模式简介</font></span></h2><ol><li>单例模式的作用<br/><span style="font-weight: bold;">可以保证在程序运行过程，一个类只有一个实例，而且该实例易于供外界访问</span><br/><span style="-en-paragraph: true; font-weight: bold;">从而方便地控制了实例个数，并节约系统资源</span></li><li>单例模式的使用场合<br/><span style="-en-paragraph: true; font-weight: bold;">在整个应用程序中，共享一份资源（这份资源只需要创建初始化1次），一般用于工具类。例如：登陆控制器，网络数据请求，音乐播放器等一个工程需要使用多次的控制器或方法。</span></li><li>单例模式的优缺点<br/>优点：<br/><span style="font-weight: bold;">单例模式可以保证系统中一个类只有一个实例而且该实例易于外界访问，从而方便对实例个数的控制并节约系统资源。</span><br/><span style="font-weight: bold;">如果希望在系统中某个类的对象只能存在一个，单例模式是最好的解决方案。</span><br/><span style="font-weight: bold;">单例模式因为类控制了实例化过程，所以类可以更加灵活修改实例化过程。</span><br/>缺点：<br/><span style="font-weight: bold;">单例对象一旦建立，对象指针是保存在静态区的，单例对象在堆中分配的内存空间，会在应用程序终止后才会被释放。</span><br/><span style="font-weight: bold;">单例类无法继承，因此很难进行类的扩展。</span><br/><span style="-en-paragraph: true; font-weight: bold;">单例不适用于变化的对象，如果同一类型的对象总是要在不同的用例场景发生变化，单例就会引起数据的错误，不能保存彼此的状态。</span></li></ol><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">注意：我们在使用单例类之前，一定要考虑好单例类是否适合和类以后的扩展性，避免盲目滥用单例</span></div><h2><span style="font-weight: bold;"><br/></span></h2><h2><span style="font-weight: bold;">二. 单例在ARC中的实现</span></h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">ARC中单例实现步骤</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(39, 42, 216); font-weight: bold;">1</span><span style="font-size: 13px; line-height: normal; font-family: Menlo; font-weight: bold;"> 在类的内部提供一个</span><span style="font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(186, 45, 162); background-color: rgb(255, 255, 255); font-weight: bold;">static</span><span style="font-size: 13px; line-height: normal; font-family: Menlo; background-color: rgb(255, 255, 255); font-weight: bold;">修饰的全局变量</span></div><div><span style="font: 13.0px Menlo; color: #272ad8; background-color: #ffffff; font-weight: bold;">2</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> 提供一个类方法，方便外界访问</span></div><div><span style="font: 13.0px Menlo; color: #272ad8; background-color: #ffffff; font-weight: bold;">3</span><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;"> 重写+allocWithZone方法，保证永远都只为单例对象分配一次内存空间</span></div><div><span style="font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(39, 42, 216); font-weight: bold;">4</span><span style="font-size: 13px; line-height: normal; font-family: Menlo; font-weight: bold;"> 严谨起见，重写-copyWithZone方法和-MutableCopyWithZone方法</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;"><br/></span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">ARC中单例代码实现</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#import </span><span style="font: 13.0px Menlo; color: #d12f1b; background-color: #ffffff; font-weight: bold;">&quot;Tools.h&quot;</span></div><div><br style="font-weight: bold;"/></div><div><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">@implementation</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> Tools</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 创建静态对象 防止外部访问</span></div><div><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">static</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> Tools *_instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">+(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">instancetype</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)allocWithZone:(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">struct</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> _NSZone *)zone</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//    @synchronized (self) {</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//        // 为了防止多线程同时访问对象，造成多次分配内存空间，所以要加上线程锁</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//        if (_instance == nil) {</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//            _instance = [super allocWithZone:zone];</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//        }</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//        return _instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//    }</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 也可以使用一次性代码</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">static</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> dispatch_once_t onceToken;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    dispatch_once(&amp;onceToken, ^{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">        </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">if</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> (_instance == </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">nil</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">) {</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">            _instance = [</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">super</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> allocWithZone:zone];</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">        }</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    });</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> _instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 为了使实例易于外界访问 我们一般提供一个类方法</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 类方法命名规范 share类名|default类名|类名</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">+(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">instancetype</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)shareTools</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//return _instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 最好用self 用Tools他的子类调用时会出现错误</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> [[</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">self</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> alloc]init];</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">// 为了严谨，也要重写copyWithZone 和 mutableCopyWithZone</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">-(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">id</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)copyWithZone:(NSZone *)zone</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> _instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">-(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">id</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)mutableCopyWithZone:(NSZone *)zone</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> _instance;</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;">}</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;"><br/></span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;"><br/></span></div><h2><span style="font-weight: bold;">三. 单例在MRC中的实现</span></h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">MRC单例实现步骤</span></div><blockquote><div><span style="font-weight: bold;">1 在类的内部提供一个static修饰的全局变量</span></div><div><span style="font-weight: bold;">2 提供一个类方法，方便外界访问</span></div><div><span style="font-weight: bold;">3 重写+allocWithZone方法，保证永远都只为单例对象分配一次内存空间</span></div><div><span style="font-weight: bold;">4 严谨起见，重写-copyWithZone方法和-MutableCopyWithZone方法</span></div><div><span style="font-weight: bold;">5 重写release方法</span></div><div><span style="font-weight: bold;">6 重写retain方法</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">7 建议在retainCount方法中返回一个最大值</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">配置MRC环境</span></div><blockquote><div><span style="font-weight: bold;">1 注意ARC不是垃圾回收机制，是编译器特性</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">2 配置MRC环境：build setting -&gt;搜索automatic ref-&gt;修改为N0</span></div></blockquote><div><span style="font-weight: bold;">MRC中单例代码实现</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">配置好MRC环境之后，在ARC代码基础上重写下面的三个方法即可</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">-(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">oneway</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">void</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)release</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">-(</span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">instancetype</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">)retain</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> _instance;</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">-(NSUInteger)retainCount</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">{</span></div><div><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">    </span><span style="font: 13.0px Menlo; color: #ba2da2; background-color: #ffffff; font-weight: bold;">return</span><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;"> MAXFLOAT;</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;">}</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;"><br/></span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(0, 0, 0); font-weight: bold;"><br/></span></div><h2><span style="font-weight: bold;">四. 一劳永逸，单例模式的优化</span></h2><div><span style="font-weight: bold;">如果想要一劳永逸，我们将面临两个问题</span></div><div><span style="font-weight: bold;">1：如何写一份单例代码在ARC和MRC环境下都适用？</span></div><div><span style="font-weight: bold;">2：如何使一份单例代码可以多个类共同使用</span></div><div><span style="font-weight: bold;">为了解决这两个问题，我们可以在</span><span style="font-weight: bold;">PCH文件使用代参数的宏和条件编译</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">利用条件编译来判断是ARC还是MRC环境</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#if __has_feature(objc_arc)</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//如果是ARC，那么就执行这里的代码1</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#else</span></div><div><span style="font: 13.0px Menlo; color: #008400; background-color: #ffffff; font-weight: bold;">//如果不是ARC，那么就执行代理的代码2</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(120, 73, 42); font-weight: bold;">#endif</span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(120, 73, 42); font-weight: bold;"><br/></span></div><div><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(120, 73, 42); font-weight: bold;"><br/></span></div><div><span style="font-weight: bold;">注意：单例模式不可以使用继承，因为使用继承，同时也会继承静态变量，当子类和父类同时创建的时候只会创建一个先创建的实例对象。</span></div><div><span style="font-weight: bold;">废话不多说了直接上代码</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font: 13.0px Menlo; color: #000000; background-color: #ffffff; font-weight: bold;">PCH文件Single.h</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#define singleH(name) +(instancetype)share##name;</span></div><div><br style="font-weight: bold;"/></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#if __has_feature(objc_arc)</span></div><div><br style="font-weight: bold;"/></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#define singleM(name) static id _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">+(instancetype)allocWithZone:(struct _NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">static dispatch_once_t onceToken;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">dispatch_once(&amp;onceToken, ^{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">_instance = [super allocWithZone:zone];\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">});\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">+(instancetype)share##name\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return [[self alloc]init];\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(id)copyWithZone:(NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(id)mutableCopyWithZone:(NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#else</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">#define singleM static id _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">+(instancetype)allocWithZone:(struct _NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">static dispatch_once_t onceToken;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">dispatch_once(&amp;onceToken, ^{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">_instance = [super allocWithZone:zone];\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">});\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">+(instancetype)shareTools\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return [[self alloc]init];\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(id)copyWithZone:(NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(id)mutableCopyWithZone:(NSZone *)zone\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(oneway void)release\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(instancetype)retain\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return _instance;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">-(NSUInteger)retainCount\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">{\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">return MAXFLOAT;\</span></div><div><span style="font: 13.0px Menlo; color: #78492a; background-color: #ffffff; font-weight: bold;">}</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(120, 73, 42); font-weight: bold;">#endif</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="font-style: normal; font-variant-caps: normal; font-size: 13px; line-height: normal; font-family: Menlo; color: rgb(120, 73, 42); font-weight: bold;"><br/></span></div><div><span style="font-weight: bold;">这时我们就可以一劳永逸，任何项目中，当我们要使用单例类的时候只要在项目中导入PCH文件然后</span></div><div><span style="font-weight: bold;">在.h文件中调用</span><span style="font-weight: bold;">singleH(类名)</span></div><div><span style="font-weight: bold;">在.m文件中调用</span><span style="font-weight: bold;">singleM(类名)</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; font-weight: bold;">创建类时直接调用</span><span style="-en-paragraph: true; font-weight: bold;">share类名</span><span style="-en-paragraph: true; font-weight: bold;">方法即可。</span></div><div><br/></div></span>
</div></body></html> 