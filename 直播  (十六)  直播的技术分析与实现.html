<html>
<head>
  <title>直播  (十六) : 直播的技术分析与实现</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="909E6C28-5046-49C8-B0E6-DB3268E3B6AB"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1731"/>
<h1>直播  (十六) : 直播的技术分析与实现</h1>

<div>
<span><div style="direction: ltr; font-family: Calibri; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 21pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold;">HTTP Live Streaming直播(iOS直播)技术分析与实现</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">花了一些时间研究了</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">HTTP Live Streaming</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">（</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">HLS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">）技术，并实现了一个HLS编码器</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: red;">HLSLiveEncoder</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">，当然，C++写的。其功能是采集摄像头与麦克风，实时进行H.264视频编码和AAC音频编码，并按照HLS的协议规范，生成分段的标准TS文件以及m3u8索引文件。通过我的</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: red;">HLSLiveEncoder</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">和第三方Http服务器（例如：Nginx），成功实现了</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">HTTP Live Streaming</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">直播，并在iphone上测试通过。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 24pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 24.0pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; background: purple; mso-highlight: purple;">HLS技术要点分析</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">HTTP Live Streaming</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: blue;">（</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">HLS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">）是苹果公司(Apple Inc.)实现的基于HTTP的流媒体传输协议，可实现流媒体的直播和点播，主要应用在</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">iOS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">系统，为</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">iOS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">设备（如iPhone、iPad）提供音视频直播和点播方案。</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">HLS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">点播，基本上就是常见的分段HTTP点播，不同在于，它的分段非常小。要实现</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: black;">HLS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">点播，重点在于对媒体文件分段，目前有不少开源工具可以使用，这里我就不再讨论，只谈HLS直播技术。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">相对于常见的流媒体直播协议，例如</span><a href="http://www.cnblogs.com/haibindev/archive/2011/12/29/2305712.html" style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">RTMP协议</a><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">、RTSP协议、MMS协议等，HLS直播最大的不同在于，直播客户端获取到的，并不是一个完整的数据流。HLS协议在服务器端将直播数据流存储为连续的、很短时长的媒体文件（</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">MPEG-TS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">格式），而客户端则不断的下载并播放这些小文件，因为服务器端总是会将最新的直播数据生成新的小文件，这样客户端只要不停的按顺序播放从服务器获取到的文件，就实现了直播。由此可见，基本上可以认为，HLS是以点播的技术方式来实现直播。由于数据通过HTTP协议传输，所以完全不用考虑防火墙或者代理的问题，而且分段文件的时长很短，客户端可以很快的选择和切换码率，以适应不同带宽条件下的播放。不过HLS的这种技术特点，决定了它的延迟一般总是会高于普通的流媒体直播协议。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">根据以上的了解要实现</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">HTTP Live Streaming</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">直播，需要研究并实现以下技术关键点</span></div><ol style="direction: ltr; border-width: 100%; unicode-bidi: embed; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;" type="1"><li style="color: black;" value="1"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">采集视频源和音频源的数据</span></li><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">对原始数据进行H264编码和AAC编码</span></li><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">视频和音频数据封装为MPEG-TS包</span></li><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">HLS分段生成策略及m3u8索引文件</span></li><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">HTTP传输协议</span></li></ol><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">其中第1点和第2点，我之前的文章中已经提到过了，而最后一点，我们可以借助现有的HTTP服务器，所以，实现第3点和第4点是关键所在。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 24pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 24.0pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; background: purple; mso-highlight: purple;">程序框架与实现          </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">通过以上分析，实现</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: red;">HLS LiveEncoder</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">直播编码器，其逻辑和流程基本上很清楚了：分别开启音频与视频编码线程，通过</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">DirectShow</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">（或其他）技术来实现音视频采集，随后分别调用libx264和libfaac进行视频和音频编码。两个编码线程实时编码音视频数据后，根据自定义的分片策略，存储在某个</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">MPEG-TS</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">格式分段文件中，当完成一个分段文件的存储后，更新m3u8索引文件。如下图所示：</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">  </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">上图中</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: red;">HLSLiveEncoder</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">当收到视频和音频数据后，需要首先判断，当前分片是否应该结束，并创建新分片，以延续TS分片的不断生成。需要注意的是，新的分片，应当从关键帧开始，防止播放器解码失败。核心代码如下所示：</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">  </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">TsMuxer的接口也是比较简单的。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">    </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 24pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 24.0pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; background: purple; mso-highlight: purple;">HLS分段生成策略和m3u8   </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold;">1. 分段策略</span></div><ul style="direction: ltr; border-width: 100%; unicode-bidi: embed;" type="circle"><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">HLS的分段策略，基本上推荐是10秒一个分片，当然，具体时间还要根据分好后的分片的实际时长做标注</span></li><li style="color: black;"><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt;">通常来说，为了缓存等方面的原因，在索引文件中会保留最新的三个分片地址，以类似“滑动窗口”的形式，进行更新。</span></li></ul><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 15.75pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold;">2. m3u8文件简介</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">m3u8，是</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">HTTP Live Streaming</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">直播的索引文件。m3u8基本上可以认为就是.m3u格式文件，区别在于，m3u8文件使用</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: blue;">UTF-8</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">字符编码。</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXTM3U</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">                    </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;"> m3u</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">文件头，必须放在第一行</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXT-X-MEDIA-SEQUENCE</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">      </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">第一个</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">TS</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">分片的序列号</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXT-X-TARGETDURATION</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">      </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">每个分片</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">TS</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">的最大的时长</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXT-X-ALLOW-CACHE</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">         </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">是否允许</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">cache</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXT-X-ENDLIST</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">             </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;"> m3u8</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">文件结束符</span></div><div style="direction: ltr; font-size: 9pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">#EXTINF</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;; mso-spacerun: yes;">                    </span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;"> extra info</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">，分片</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Courier New&quot;;">TS</span><span style="direction: ltr; font-size: 9.0pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">的信息，如时长，带宽等</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">一个简单的m3u8索引文件</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">    </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 24pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 24.0pt; color: white; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; background: purple; mso-highlight: purple;">运行效果          </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">在Nginx工作目录下启动</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: red;">HLSLiveEncoder</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: black;">，并用VLC播放器连接播放</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">     </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image [4].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">通过iPhone播放的效果</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: black; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">     </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十六)  直播的技术分析与实现_files/Image [5].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div><div><br/></div></span>
</div></body></html> 