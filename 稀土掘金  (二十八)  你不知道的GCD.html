<html>
<head>
  <title>ç¨€åœŸæ˜é‡‘Â  (äºŒåå…«) : ä½ ä¸çŸ¥é“çš„GCD</title>
  <basefont face="å¾®è½¯é›…é»‘" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="2D074260-DD90-46B9-89E0-F2EAF2CBF698"/>
  <style>
    body, td {
      font-family: å¾®è½¯é›…é»‘;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="889"/>
<h1>ç¨€åœŸæ˜é‡‘Â  (äºŒåå…«) : ä½ ä¸çŸ¥é“çš„GCD</h1>

<div>
<span><div>ã€å‰è¨€ã€‘ä»iOS7å‡åˆ°iOS8åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ dispatch_async æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ NSOperationQueue ï¼šGCD ä¸­ Apple å¹¶æ²¡æœ‰æä¾›æ§åˆ¶å¹¶å‘æ•°é‡çš„æ¥å£ï¼Œè€Œ NSOperationQueue æœ‰ã€‚GCD æ²¡æœ‰æä¾›æš‚åœã€æ¢å¤ã€å–æ¶ˆé˜Ÿåˆ—ä»»åŠ¡çš„æ¥å£ï¼Œè€Œ NSOperationQueue æœ‰ï¼Œå¦‚æœæƒ³è®© GCD æ”¯æŒ NSOperationQueue åŸç”Ÿå°±æ”¯æŒçš„åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨è®¸å¤šGCD çš„é«˜çº§åŠŸèƒ½ï¼Œå¤§å¤§æé«˜äº†ä½¿ç”¨çš„éš¾åº¦ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Apple å§‹ç»ˆæœ‰ä¸€ä¸ªè§‚å¿µï¼šå°½å¯èƒ½é€‰ç”¨é«˜å±‚ APIï¼Œåªåœ¨ç¡®æœ‰å¿…è¦æ—¶æ‰æ±‚åŠ©äºåº•å±‚ã€‚ç„¶è€Œå¼€å‘è€…å¹¶ä¸ä¹°è´¦ï¼Œåœ¨æˆ‘è¿›è¡Œçš„ä¸€æ¬¡ </span><a href="http://weibo.com/1692391497/D1pKjqaiW?type=comment" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è°ƒæŸ¥</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¸­å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¤§æ¦‚ 80%çš„iOS å¼€å‘è€…ä¼šæ”¯æŒä½¿ç”¨ GCD æ¥å®Œæˆæ“ä½œé˜Ÿåˆ—çš„å®ç°ï¼Œè€Œä¸”æœ‰ 60% çš„å¼€å‘å·²ç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://camo.githubusercontent.com/abb8e19e7e95638b3b4973e48bfce4e2b0166844/687474703a2f2f6936352e74696e797069632e636f6d2f32766a316d64322e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image.png" type="image/png" data-filename="Image.png"/><br/></a><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ›´æ˜¯æœ‰äººè¿™æ ·è¡¨æ€ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å‡å¦‚ä¸è®©ä»–ç”¨ GCDï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://camo.githubusercontent.com/c94079a6de71fbd79f47dfc23785b216530e475d/687474703a2f2f6936362e74696e797069632e636f6d2f333467387164312e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></a><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ç§ç°è±¡ä¸€ç›´å­˜åœ¨ï¼ŒåŒ…æ‹¬ ARC ä¸ MRCã€SBå»º UI ä¸çº¯ä»£ç å»º UIã€SQL ä¸ CoreDataçš„äº‰è®ºã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä½†æ˜¯å› ä¸ºæ˜¯æºç è§£æçš„æ–‡ç« ï¼Œè€Œ Parse çš„ SDK æ²¡æœ‰ç”¨ä¸€å¥çš„ NSOperation çš„ä»£ç ï¼ŒGCD ä¸€è·¯ç”¨åˆ°åº•ï¼Œè®©æˆ‘ä¹Ÿååˆ†éœ‡æƒŠã€‚åªèƒ½è¯´æ˜ï¼Œå†™ Parse çš„è¿™ä½å¼€å‘è€…æ˜¯è‰ºé«˜äººèƒ†å¤§ã€‚è€Œä¸”æ—¢ç„¶ GCD çš„æ”¯æŒè€…å¦‚æ­¤ä¹‹å¤šï¼Œé‚£ä¹ˆå°±è°ˆä¸€è°ˆå¦‚ä½•è®© GCD èƒ½æ”¯æŒ NSOperationQueue åŸç”Ÿå°±æ”¯æŒçš„åŠŸèƒ½ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä»Šå¤©è™½ç„¶è°ˆäº†NSOperationåŸç”ŸåŠŸèƒ½çš„ GCD ç‰ˆæœ¬å®ç°ï¼Œä½†å¹¶ä¸ä»£è¡¨æˆ‘æ”¯æŒåƒ Parse è¿™æ · GCD ä¸€è·¯ç”¨åˆ°åº•ã€‚ ä¸šå†…ä¸€èˆ¬çš„çœ‹æ³•æ˜¯è¿™æ ·çš„ï¼š</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">GCD è™½ç„¶èƒ½å¤Ÿå®ç°æš‚åœå’Œç»ˆæ­¢ï¼Œä½†å¼€å‘è¿˜æ˜¯çµæ´»äº›å¥½ï¼Œé‚£äº› NSOperation ç”¨èµ·æ¥æ–¹ä¾¿çš„å°±ç›´æ¥ç”¨ NSOperation çš„æ–¹å¼ï¼Œä¸ç„¶è‹¹æœå¤šåŒ…é‚£ä¸€å±‚ä¸æ˜¯è›‹ç–¼ï¼ŒåŒ…æ‹¬æ–‡ç« é‡Œæåˆ°çš„ iOS8 åæ§åˆ¶çº¿ç¨‹æ•°çš„é—®é¢˜ï¼Œä¸ä¸€å®šé¡¹ç›®å°±ä¸€å®šè¦GCDä¸€è·¯åˆ°åº•ã€‚æœ‰æ—¶å€™éœ€è¦æ”¯æŒä¸€äº›é«˜å±‚çº§å°è£…åŠŸèƒ½æ¯”å¦‚ï¼š KVO æ—¶ NSOperation è¿˜æ˜¯æœ‰å®ƒçš„ä¼˜åŠ¿çš„ã€‚ GCD åè€Œæ˜¯å¤„ç†äº›æ¯”è¾ƒç®€å•çš„æ“ä½œæˆ–è€…æ˜¯è¾ƒç³»ç»Ÿçº§çš„æ¯”å¦‚ï¼šç›‘è§†è¿›ç¨‹æˆ–è€…ç›‘è§†æ–‡ä»¶å¤¹å†…æ–‡ä»¶çš„å˜åŒ–ä¹‹ç±»çš„æ¯”è¾ƒåˆé€‚ã€‚</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ï¼ˆiOSå¼€å‘å­¦ä¹ äº¤æµç¾¤ï¼š543800703ï¼‰</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç¬¬ä¸€ç¯‡çš„ç›®çš„æ˜¯é€šè¿‡è§£è¯» Parse æºç æ¥å±•ç¤ºGCDä¸¤ä¸ªé«˜çº§ç”¨æ³•ï¼š Dispatch Source ï¼ˆæ´¾å‘æºï¼‰å’Œ Dispatch Semaphore ï¼ˆä¿¡å·é‡ï¼‰ã€‚é¦–å…ˆé€šè¿‡Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼Œæ¥ä»‹ç» Dispatch Source ï¼ˆæ´¾å‘æºï¼‰ï¼›ç„¶åé€šè¿‡Parse çš„å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨çš„æŠ€å·§â€œå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•â€æ¥ä»‹ç»Dispatch Semaphore ï¼ˆä¿¡å·é‡ï¼‰ã€‚æˆ‘å·²å°†æ€è·¯æµ“ç¼©ä¸ºå¯è¿è¡Œçš„7ä¸ª Demo ä¸­ï¼Œè¯¦è§ä»“åº“é‡Œçš„ Demo1åˆ° Demo7ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¦‚æœå¯¹ GCD ä¸å¤ªç†Ÿæ‚‰ï¼Œè¯·å…ˆè¯»ä¸‹</span><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/GCD%E6%89%AB%E7%9B%B2%E7%AF%87.md" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€ŠGCD æ‰«ç›²ç¯‡ã€‹</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€‚</span></div><ol><li>Dispatch Sourceåˆ†æ´¾æº</li><ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#parse-ios-sdk%E4%BB%8B%E7%BB%8D">Parse-iOS-SDKä»‹ç»</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#parse-%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C%E4%BB%8B%E7%BB%8D">Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#parse-%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E5%AE%9E%E7%8E%B0%E4%BB%8B%E7%BB%8D">Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#dispatch-source-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4">Dispatch Source çš„ä½¿ç”¨æ­¥éª¤</a></li><ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAdispatch-source">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch Source</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%9B%E5%BB%BAdispatch-source%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95">ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E7%AC%AC%E4%B8%89%E6%AD%A5%E5%A4%84%E7%90%86dispatch-source%E7%9A%84%E6%9A%82%E5%81%9C%E4%B8%8E%E6%81%A2%E5%A4%8D%E6%93%8D%E4%BD%9C">ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E5%90%91dispatch-source%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6">ç¬¬å››æ­¥ï¼šå‘Dispatch Sourceå‘é€äº‹ä»¶</a></li></ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#gcd%E7%9C%9F%E7%9A%84%E4%B8%8D%E8%83%BD%E5%83%8Foperationqueue%E9%82%A3%E6%A0%B7%E7%BB%88%E6%AD%A2%E4%BB%BB%E5%8A%A1">GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E5%AE%8C%E6%95%B4%E4%BE%8B%E5%AD%90demo1%E8%AE%A9-dispatch-source-%E5%B8%AE-dispatch-queue-%E5%AE%9E%E7%8E%B0%E6%9A%82%E5%81%9C%E5%92%8C%E6%81%A2%E5%A4%8D%E5%8A%9F%E8%83%BD">å®Œæ•´ä¾‹å­Demo1ï¼šè®© Dispatch Source â€œå¸®â€ Dispatch Queue å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#dispatchsource%E8%83%BD%E9%80%9A%E8%BF%87%E5%90%88%E5%B9%B6%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F%E7%A1%AE%E4%BF%9D%E5%9C%A8%E9%AB%98%E8%B4%9F%E8%BD%BD%E4%B8%8B%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C">DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#dispatch-source-%E4%B8%8E-dispatch-queue-%E4%B8%A4%E8%80%85%E5%9C%A8%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E4%B8%8A%E7%9A%84%E5%85%B3%E7%B3%BB">Dispatch Source ä¸ Dispatch Queue ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E8%AE%A9-dispatch-source-%E4%B8%8E-dispatch-queue-%E5%90%8C%E6%97%B6%E5%AE%9E%E7%8E%B0%E6%9A%82%E5%81%9C%E5%92%8C%E6%81%A2%E5%A4%8D">è®© Dispatch Source ä¸ Dispatch Queue åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#parse-%E7%A6%BB%E7%BA%BF%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C%E7%9A%84%E4%BB%A3%E7%A0%81%E6%91%98%E5%BD%95">Parse â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•</a></li></ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#dispatch-semaphore-%E4%BF%A1%E5%8F%B7%E9%87%8F">Dispatch Semaphore ä¿¡å·é‡</a></li><ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E5%BC%BA%E5%88%B6%E6%8A%8A%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1%E6%9D%A5%E6%96%B9%E4%BE%BF%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E4%BD%BF%E7%94%A8dispatch-semaphore%E6%8E%A7%E5%88%B6%E5%B9%B6%E5%8F%91%E7%BA%BF%E7%A8%8B%E6%95%B0%E9%87%8F">ä½¿ç”¨Dispatch Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E4%B8%BA--nsurlsession-%E6%B7%BB%E5%8A%A0%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95">ä¸º NSURLSession æ·»åŠ åŒæ­¥æ–¹æ³•</a></li><ol><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E5%AF%BC%E8%87%B4watchdog%E8%B6%85%E6%97%B6">é£é™©ï¼šå¯¼è‡´Watchdogè¶…æ—¶</a></li><li><a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parse%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF/Parse%E7%9A%84%E5%BA%95%E5%B1%82%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF.md#%E5%A4%B1%E5%8E%BB%E4%BA%86-cancel-%E7%9A%84%E6%9C%BA%E4%BC%9A">é£é™©ï¼šå¤±å»äº† cancel çš„æœºä¼š</a></li></ol></ol></ol><h2>Parse-iOS-SDKä»‹ç»</h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://www.infoq.com/cn/news/2015/08/ios-weekly-ios841#rd" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€ŠiOSå¼€å‘å‘¨æŠ¥ï¼šiOS 8.4.1 å‘å¸ƒï¼ŒiOS 8 æ—¶ä»£è°¢å¹•ã€‹</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> å¯¹ Facebook æ——ä¸‹çš„ Parseæœ‰è¿™æ ·ä¸€æ®µä»‹ç»ï¼š</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Parse-SDK-iOS-OSXï¼šè‘—åçš„ BaaS å…¬å¸ Parse æœ€è¿‘å¼€æºäº†å®ƒä»¬çš„ iOS/OSX SDKã€‚Parse çš„æœåŠ¡è™½ç„¶åœ¨å›½å†…å¯èƒ½è®¿é—®é€Ÿåº¦ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä½†æ˜¯å®ƒä»¬åœ¨æœåŠ¡çš„ç¨³å®šæ€§å’Œ SDK è´¨é‡ä¸Šä¸€ç›´æœ‰éå¸¸ä¼˜å¼‚çš„è¡¨ç°ã€‚æ­¤æ¬¡å¼€æºçš„ SDK å¯¹äºæ—¥å¸¸å·¥ä½œæ˜¯ SDK å¼€å‘çš„å¼€å‘è€…æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªéš¾å¾—çš„å­¦ä¹ æœºä¼šã€‚Parse çš„å­˜å–æ“ä½œæ¶‰åŠåˆ°å¾ˆå¤šå¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œä» Parse SDK çš„æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ª SDK çš„å¼€å‘è€…å¯¹ iOS å¼€å‘å¤šçº¿ç¨‹æœ‰ç€éå¸¸æ·±åšçš„ç†è§£å’ŒåŠŸåº•ï¼Œè®©äººå¹æœã€‚æˆ‘ä¸ªäººæ¨èå¯¹æ­¤æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°è¯•ä»é˜…è¯» internal æ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªEventuallyQueue æ–‡ä»¶å¼€å§‹ç€æ‰‹ï¼Œç ”ç©¶ä¸‹ Parse çš„åº•å±‚å¤šçº¿ç¨‹å¤„ç†æ€è·¯ã€‚</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç±»ä¼¼çš„æœåŠ¡ï¼š Apple çš„ </span><a href="http://nshipster.cn/cloudkit/" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">CloudKit</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ã€ å›½å†…çš„ </span><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">LeanCloudï¼ˆåŸå </a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">AVOS</a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ï¼‰</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ã€‚</span></div><h2>Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»</h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¤§å¤šæ•°ä¿å­˜åŠŸèƒ½å¯ä»¥ç«‹åˆ»æ‰§è¡Œï¼Œå¹¶é€šçŸ¥åº”ç”¨â€œä¿å­˜å®Œæ¯•â€ã€‚ä¸è¿‡è‹¥ä¸éœ€è¦çŸ¥é“ä¿å­˜å®Œæˆçš„æ—¶é—´ï¼Œåˆ™å¯ä½¿ç”¨â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ æ¥ä»£æ›¿ï¼Œä¹Ÿå°±æ˜¯ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¦‚æœç”¨æˆ·ç›®å‰å°šæœªæ¥å…¥ç½‘ç»œï¼Œâ€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ ä¼šç¼“å­˜è®¾å¤‡ä¸­çš„æ•°æ®ï¼Œå¹¶åœ¨ç½‘ç»œè¿æ¥æ¢å¤åä¸Šä¼ ã€‚å¦‚æœåº”ç”¨åœ¨ç½‘ç»œæ¢å¤ä¹‹å‰å°±è¢«å…³é—­äº†ï¼Œé‚£ä¹ˆå½“å®ƒä¸‹ä¸€æ¬¡æ‰“å¼€æ—¶ï¼ŒSDK ä¼šè‡ªåŠ¨å†æ¬¡å°è¯•ä¿å­˜æ“ä½œã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ‰€æœ‰ saveEventuallyï¼ˆæˆ– deleteEventuallyï¼‰çš„ç›¸å…³è°ƒç”¨ï¼Œå°†æŒ‰ç…§è°ƒç”¨çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚å› æ­¤ï¼Œå¤šæ¬¡å¯¹æŸä¸€å¯¹è±¡ä½¿ç”¨ saveEventually æ˜¯å®‰å…¨çš„ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å›½å†…çš„ </span><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">LeanCloudï¼ˆåŸå </a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">AVOS</a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ï¼‰</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¹Ÿæä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä»¥ä¸Šã€ŠParse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œä»‹ç»ã€‹éƒ¨åˆ†å®Œå…¨æ‘˜å½•è‡ª LeanCloud çš„æ–‡æ¡£ã€‚è¯¦è§</span><a href="https://leancloud.cn/docs/ios_os_x_guide.html#%E7%A6%BB%E7%BA%BF%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€ŠLeanCloudå®˜æ–¹æ–‡æ¡£-iOS / OS X æ•°æ®å­˜å‚¨å¼€å‘æŒ‡å—--ç¦»çº¿å­˜å‚¨å¯¹è±¡ã€‹</a></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ï¼ˆåˆ©ç›Šç›¸å…³å£°æ˜ï¼šæœ¬äººç›®å‰å°±èŒäº </span><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">LeanCloudï¼ˆåŸå </a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">AVOS</a><a href="https://leancloud.cn/?source=T6M35E4H" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ï¼‰</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ï¼‰</span></div><h2>Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€å®ç°ä»‹ç»</h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Parse çš„â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œï¼ˆsaveEventually æˆ– deleteEventuallyï¼‰ æ˜¯é€šè¿‡ GCD çš„ Dispatch Source ï¼ˆä¿¡å·æºï¼‰æ¥å®ç°çš„ã€‚ä¸‹é¢å¯¹ Dispatch Source ï¼ˆä¿¡å·æºï¼‰è¿›è¡Œä¸€ä¸‹ä»‹ç»ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">GCDä¸­é™¤äº†ä¸»è¦çš„ Dispatch Queue å¤–ï¼Œè¿˜æœ‰ä¸å¤ªå¼•äººæ³¨ç›®çš„ Dispatch Source .å®ƒæ˜¯BSDç³»å†…æ ¸æƒ¯æœ‰åŠŸèƒ½kqueueçš„åŒ…è£…ã€‚kqueue æ˜¯åœ¨ XNU å†…æ ¸ä¸­å‘ç”Ÿå„ç§äº‹ä»¶æ—¶ï¼Œåœ¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ–¹æ‰§è¡Œå¤„ç†çš„æŠ€æœ¯ã€‚å…¶ CPU è´Ÿè·éå¸¸å°ï¼Œå°½é‡ä¸å ç”¨èµ„æºã€‚kqueue å¯ä»¥è¯´æ˜¯åº”ç”¨ç¨‹åºå¤„ç† XNU å†…æ ¸ä¸­å‘ç”Ÿçš„å„ç§äº‹ä»¶çš„æ–¹æ³•ä¸­æœ€ä¼˜ç§€çš„ä¸€ç§ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Source ä¹Ÿä½¿ç”¨åœ¨äº† Core Foundation æ¡†æ¶çš„ç”¨äºå¼‚æ­¥ç½‘ç»œçš„API CFSocket ä¸­ã€‚å› ä¸ºFoundation æ¡†æ¶çš„å¼‚æ­¥ç½‘ç»œ API æ˜¯é€šè¿‡CFSocketå®ç°çš„ï¼Œæ‰€ä»¥å¯äº«å—åˆ°ä»…ä½¿ç”¨ Foundation æ¡†æ¶çš„ Dispatch Source å¸¦æ¥çš„å¥½å¤„ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">é‚£ä¹ˆä¼˜åŠ¿ä½•åœ¨ï¼Ÿä½¿ç”¨çš„ Dispatch Source è€Œä¸ä½¿ç”¨ dispatch_async çš„å”¯ä¸€åŸå› å°±æ˜¯åˆ©ç”¨è”ç»“çš„ä¼˜åŠ¿ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è”ç»“çš„å¤§è‡´æµç¨‹ï¼šåœ¨ä»»ä¸€çº¿ç¨‹ä¸Šè°ƒç”¨å®ƒçš„çš„ä¸€ä¸ªå‡½æ•° dispatch_source_merge_data åï¼Œä¼šæ‰§è¡Œ Dispatch Source äº‹å…ˆå®šä¹‰å¥½çš„å¥æŸ„ï¼ˆå¯ä»¥æŠŠå¥æŸ„ç®€å•ç†è§£ä¸ºä¸€ä¸ª block ï¼‰ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ä¸ªè¿‡ç¨‹å« Custom event ,ç”¨æˆ·äº‹ä»¶ã€‚æ˜¯ dispatch source æ”¯æŒå¤„ç†çš„ä¸€ç§äº‹ä»¶ã€‚</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç®€å•åœ°è¯´ï¼Œè¿™ç§äº‹ä»¶æ˜¯ç”±ä½ è°ƒç”¨ dispatch_source_merge_data å‡½æ•°æ¥å‘è‡ªå·±å‘å‡ºçš„ä¿¡å·ã€‚</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸‹é¢ä»‹ç»ä¸‹ä½¿ç”¨æ­¥éª¤ï¼š</span></div><h2>Dispatch Source çš„ä½¿ç”¨æ­¥éª¤</h2><h3>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªDispatch Source</h3><div>Â Â Â  // è¯¦è§ Demo1ã€Demo2</div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_main_queue());</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸‹é¢å¯¹å‚æ•°è¿›è¡Œä¸‹è§£é‡Šï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å…¶ä¸­è‡ªå®šä¹‰æºç´¯ç§¯äº‹ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„å€¼ï¼Œç´¯ç§¯çš„æ–¹å¼å¯ä»¥æ˜¯ç›¸åŠ çš„ï¼Œæ­£å¦‚ä¸Šé¢ä»£ç ä¸­çš„ DISPATCH_SOURCE_TYPE_DATA_ADD ï¼Œä¹Ÿå¯ä»¥æ˜¯é€»è¾‘æˆ– DISPATCH_SOURCE_TYPE_DATA_OR ã€‚è¿™æ˜¯æœ€å¸¸è§çš„ä¸¤ä¸ª Dispatch Source å¯ä»¥å¤„ç†çš„äº‹ä»¶ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Source å¯å¤„ç†çš„æ‰€æœ‰äº‹ä»¶ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</span></div><table><thead><tr><td><div>åç§°</div></td><td><div>å†…å®¹</div></td></tr></thead><tbody><tr><td><div>DISPATCH_SOURCE_TYPE_DATA_ADD</div></td><td><div>å˜é‡å¢åŠ  </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_DATA_OR</div></td><td><div>å˜é‡OR </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_MACH_SEND</div></td><td><div>MACHç«¯å£å‘é€ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_MACH_RECV</div></td><td><div>MACHç«¯å£æ¥æ”¶ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_PROC</div></td><td><div>ç›‘æµ‹åˆ°ä¸è¿›ç¨‹ç›¸å…³çš„äº‹ä»¶ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_READ</div></td><td><div>å¯è¯»å–æ–‡ä»¶æ˜ åƒ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_SIGNAL</div></td><td><div>æ¥æ”¶ä¿¡å· </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_TIMER</div></td><td><div>å®šæ—¶å™¨ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_VNODE</div></td><td><div>æ–‡ä»¶ç³»ç»Ÿæœ‰å˜æ›´ </div></td></tr><tr><td><div>DISPATCH_SOURCE_TYPE_WRITE</div></td><td><div>å¯å†™å…¥æ–‡ä»¶æ˜ åƒ </div></td></tr></tbody></table><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è‡ªå®šä¹‰æºä¹Ÿéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å¤„ç†æ‰€æœ‰çš„å“åº”å¥æŸ„ï¼ˆblockï¼‰ã€‚é‚£ä¹ˆå²‚ä¸æ˜¯æœ‰ä¸¤ä¸ªé˜Ÿåˆ—äº†ï¼Ÿæ²¡é”™ï¼Œè‡³äº Dispatch Queue è¿™ä¸ªé˜Ÿåˆ—çš„çº¿ç¨‹æ‰§è¡Œä¸ Dispatch Sourceè¿™ä¸ªé˜Ÿåˆ—çš„çº¿ç¨‹æ‰§è¡Œçš„å…³ç³»ï¼Œä¸‹æ–‡ä¼šç»“åˆ Demo1å’Œ Demo2è¿›è¡Œè¯¦ç»†è®ºè¿°ã€‚</span></div><h3>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºDispatch Sourceçš„äº‹ä»¶å¤„ç†æ–¹æ³•</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åˆ†æ´¾æºæä¾›äº†é«˜æ•ˆçš„æ–¹å¼æ¥å¤„ç†äº‹ä»¶ã€‚é¦–å…ˆæ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ä¼šæ”¶åˆ°é€šçŸ¥ã€‚å¦‚æœåœ¨ç³»ç»Ÿè¿˜æ²¡æœ‰æ¥å¾—åŠé€šçŸ¥ä½ ä¹‹å‰äº‹ä»¶å°±å‘ç”Ÿäº†å¤šæ¬¡ï¼Œé‚£ä¹ˆè¿™äº›äº‹ä»¶ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªäº‹ä»¶ã€‚è¿™å¯¹äºåº•å±‚çš„é«˜æ€§èƒ½ä»£ç å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯OSåº”ç”¨å¼€å‘è€…å¾ˆå°‘ä¼šç”¨åˆ°è¿™æ ·çš„åŠŸèƒ½ã€‚ç±»ä¼¼åœ°ï¼Œåˆ†æ´¾æºå¯ä»¥å“åº”UNIXä¿¡å·ã€æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ã€å…¶ä»–è¿›ç¨‹çš„å˜åŒ–ä»¥åŠMach Portäº‹ä»¶ã€‚å®ƒä»¬ä¸­å¾ˆå¤šéƒ½åœ¨Macç³»ç»Ÿä¸Šå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯iOSå¼€å‘è€…é€šå¸¸ä¸ä¼šç”¨åˆ°ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸è¿‡ï¼Œè‡ªå®šä¹‰æºåœ¨iOSä¸­å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ€§èƒ½è‡³å…³é‡è¦çš„åœºåˆè¿›è¡Œè¿›åº¦åé¦ˆã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæº:è‡ªå®šä¹‰æºç´¯ç§¯äº‹ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„å€¼ã€‚ç´¯ç§¯æ–¹å¼å¯ä»¥æ˜¯ç›¸åŠ ( DISPATCH_SOURCE_TYPE_DATA_ADD ), ä¹Ÿå¯ä»¥æ˜¯é€»è¾‘æˆ–( DISPATCH_SOURCE_DATA_OR )ã€‚è‡ªå®šä¹‰æºä¹Ÿéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å¤„ç†æ‰€æœ‰çš„å“åº”å¤„ç†å—ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åˆ›å»ºæºåï¼Œéœ€è¦æä¾›ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚å½“æºç”Ÿæ•ˆæ—¶ä¼šåˆ†æ´¾æ³¨å†Œå¤„ç†æ–¹æ³•;å½“äº‹ä»¶å‘ç”Ÿæ—¶ä¼šåˆ†æ´¾äº‹ä»¶å¤„ç†æ–¹æ³•;å½“æºè¢«å–æ¶ˆæ—¶ä¼šåˆ†æ´¾å–æ¶ˆå¤„ç†æ–¹æ³•ã€‚è‡ªå®šä¹‰æºé€šå¸¸åªéœ€è¦ä¸€ä¸ªäº‹ä»¶å¤„ç†æ–¹æ³•ï¼Œå¯ä»¥åƒè¿™æ ·åˆ›å»º:</span></div><div> /*</div><div>Â  *çœç•¥éƒ¨åˆ†ï¼š </div><div>Â Â Â  æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  è¯¦è§Demo1ã€Demo2</div><div>Â  *</div><div>Â  */</div><div>Â Â Â  __block NSUInteger totalComplete = 0;</div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div>Â Â Â Â Â Â Â  NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div>Â Â Â Â Â Â Â  totalComplete += value;</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div>Â Â Â  });</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åœ¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªå¤„ç†æ–¹æ³•å—çš„å®ä¾‹è¢«åˆ†æ´¾ã€‚å¦‚æœè¿™ä¸ªå¤„ç†æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå¦ä¸€ä¸ªäº‹ä»¶å°±å‘ç”Ÿäº†ï¼Œäº‹ä»¶ä¼šä»¥æŒ‡å®šæ–¹å¼(ADDæˆ–è€…OR)è¿›è¡Œç´¯ç§¯ã€‚é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ï¼Œç³»ç»Ÿå³ä½¿åœ¨é«˜è´Ÿ è½½æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚å½“å¤„ç†äº‹ä»¶ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡ dispatch_source_get_data æ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ totalComplete çš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</span></div><h3>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†Dispatch Sourceçš„æš‚åœä¸æ¢å¤æ“ä½œ</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å½“è¿½åŠ å¤§é‡å¤„ç†åˆ°Dispatch Queueæ—¶ï¼Œåœ¨è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚ä¾‹å¦‚æ¼”ç®—ç»“æœè¢«Blockæˆªè·æ—¶ï¼Œä¸€äº›å¤„ç†ä¼šå¯¹è¿™ä¸ªæ¼”ç®—ç»“æœé€ æˆå½±å“ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·Dispatch Queueå³å¯ã€‚å½“å¯ä»¥æ‰§è¡Œæ—¶å†æ¢å¤ã€‚</span></div><pre>dispatch_suspend(queue);</pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">dispatch_resume å‡½æ•°æ¢å¤æŒ‡å®šçš„ Dispatch Queue . è¿™äº›å‡½æ•°å¯¹å·²ç»æ‰§è¡Œçš„å¤„ç†æ²¡æœ‰å½±å“ã€‚æŒ‚èµ·åï¼Œè¿½åŠ åˆ° Dispatch Queue ä¸­ä½†å°šæœªæ‰§è¡Œçš„å¤„ç†åœ¨æ­¤ä¹‹ååœæ­¢æ‰§è¡Œã€‚è€Œæ¢å¤åˆ™ä½¿å¾—è¿™äº›å¤„ç†èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚å› ä¸ºå¿˜è®°æ¢å¤åˆ†æ´¾æºçš„çŠ¶æ€è€Œäº§ç”Ÿbugæ˜¯å¸¸è§çš„äº‹å„¿ã€‚æ¢å¤çš„æ–¹æ³•æ˜¯è°ƒç”¨ dispatch_resume :</span></div><pre>dispatch_resume (source);</pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸ºäº†æ–¹ä¾¿ç†è§£ dispatch_suspend å‡½æ•°çš„ä½œç”¨ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ª Demoï¼šDemo3ï¼Œ çœ‹ä¸‹è¿è¡Œæ•ˆæœï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ€è€ƒä¸‹NSLogçš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·ï¼Ÿ</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo3ï¼ˆDemo_03_å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç®€å•ç‰ˆï¼‰ï¼š</span></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div><br/></div><div>Â Â Â  dispatch_queue_t queue1 = dispatch_queue_create(&quot;com.iOSChengXuYuan.queue1&quot;, 0);</div><div>Â Â Â  dispatch_queue_t queue2 = dispatch_queue_create(&quot;com.iOSChengXuYuan.queue2&quot;, 0);</div><div>Â Â Â  dispatch_group_t group = dispatch_group_create();</div><div><br/></div><div>Â Â Â  dispatch_async(queue1, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ä»»åŠ¡ 1 ï¼š queue 1...&quot;);</div><div>Â Â Â Â Â Â Â  sleep(1);</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;âœ…å®Œæˆä»»åŠ¡ 1&quot;);</div><div>Â Â Â  });</div><div><br/></div><div>Â Â Â  dispatch_async(queue2, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ä»»åŠ¡ 1 ï¼š queue 2...&quot;);</div><div>Â Â Â Â Â Â Â  sleep(1);</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;âœ…å®Œæˆä»»åŠ¡ 2&quot;);</div><div>Â Â Â  });</div><div><br/></div><div>Â Â Â  dispatch_group_async(group, queue1, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ğŸš«æ­£åœ¨æš‚åœ 1&quot;);</div><div>Â Â Â Â Â Â Â  dispatch_suspend(queue1);</div><div>Â Â Â  });</div><div>Â Â Â  dispatch_group_async(group, queue2, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ğŸš«æ­£åœ¨æš‚åœ 2&quot;);</div><div>Â Â Â Â Â Â Â  dispatch_suspend(queue2);</div><div>Â Â Â  });</div><div><br/></div><div>Â Â Â  dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</div><div>Â Â Â  NSLog(@&quot;ï¼ï¼ï¼ï¼ï¼ï¼ï¼ç­‰å¾…ä¸¤ä¸ªqueueå®Œæˆ, å†å¾€ä¸‹è¿›è¡Œ...&quot;);</div><div>Â Â Â  dispatch_async(queue1, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ä»»åŠ¡ 2 ï¼š queue 1&quot;);</div><div>Â Â Â  });</div><div>Â Â Â  dispatch_async(queue2, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ä»»åŠ¡ 2 ï¼š queue 2&quot;);</div><div>Â Â Â  });</div><div>Â Â Â  NSLog(@&quot;ğŸ”´ä¸ºä»€ä¹ˆè¿™ä¸ªNSLogä¼šåœ¨ä¸Šé¢ä¸¤ä¸ªNSLogä¹‹å‰æ‰“å°â“â“ç­”ï¼šdispatch_suspendçš„ä½œç”¨â€¼ï¸&quot;);</div><div><br/></div><div>Â Â Â  dispatch_resume(queue1);</div><div>Â Â Â  dispatch_resume(queue2);</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ‰“å°ï¼š</span></div><div>2015-09-06 02:44:59.614 CYLDispatchQueueSuspendTest[1610:116662] ä»»åŠ¡ 1 ï¼š queue 2...</div><div>2015-09-06 02:44:59.613 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 1 ï¼š queue 1...</div><div>2015-09-06 02:45:00.614 CYLDispatchQueueSuspendTest[1610:116665] âœ…å®Œæˆä»»åŠ¡ 1</div><div>2015-09-06 02:45:00.614 CYLDispatchQueueSuspendTest[1610:116662] âœ…å®Œæˆä»»åŠ¡ 2</div><div>2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116662] ğŸš«æ­£åœ¨æš‚åœ 2</div><div>2015-09-06 02:45:00.615 CYLDispatchQueueSuspendTest[1610:116665] ğŸš«æ­£åœ¨æš‚åœ 1</div><div>2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116515] ï¼ï¼ï¼ï¼ï¼ï¼ï¼ç­‰å¾…ä¸¤ä¸ªqueueå®Œæˆ, å†å¾€ä¸‹è¿›è¡Œ...</div><div>2015-09-06 02:45:00.616 CYLDispatchQueueSuspendTest[1610:116515] ğŸ”´ä¸ºä»€ä¹ˆè¿™ä¸ªNSLogä¼šåœ¨ä¸Šé¢ä¸¤ä¸ªNSLogä¹‹å‰æ‰“å°â“â“ç­”ï¼šdispatch_suspendçš„ä½œç”¨â€¼ï¸</div><div>2015-09-06 02:45:00.617 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 2 ï¼š queue 1</div><div>2015-09-06 02:45:00.619 CYLDispatchQueueSuspendTest[1610:116665] ä»»åŠ¡ 2 ï¼š queue 2</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ€è€ƒä¸‹NSLogçš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·ï¼Ÿç­”ï¼šdispatch_suspendçš„ä½œç”¨ï¼</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo3ï¼ˆDemo_03_å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç®€å•ç‰ˆï¼‰ã€‚</span></div><h3>ç¬¬å››æ­¥ï¼šå‘Dispatch Sourceå‘é€äº‹ä»¶</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ¢å¤æºåï¼Œå°±å¯ä»¥åƒä¸‹é¢çš„ä»£ç ç‰‡æ®µè¿™æ ·ï¼Œé€šè¿‡ dispatch_source_merge_data å‘åˆ†æ´¾æºå‘é€äº‹ä»¶:</span></div><div>Â Â Â  //2.</div><div>Â Â Â  //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div>Â Â Â  //è¯¦è§Demo1ã€Demo2</div><div>Â Â Â  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>Â Â Â Â Â Â Â  for (NSUInteger index = 0; index &lt; 100; index++) {</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_async(queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>Â Â Â Â Â Â Â Â Â Â Â  usleep(20000);//0.02ç§’</div><div>Â Â Â Â Â Â Â Â Â Â Â  });</div><div>Â Â Â Â Â Â Â  }</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸Šé¢ä»£ç åœ¨æ¯æ¬¡å¾ªç¯ä¸­æ‰§è¡ŒåŠ 1æ“ä½œã€‚ä¹Ÿå¯ä»¥ä¼ é€’å·²å¤„ç†è®°å½•çš„æ•°ç›®æˆ–å·²å†™å…¥çš„å­—èŠ‚æ•°ã€‚åœ¨ä»»ä½•çº¿ç¨‹ä¸­éƒ½å¯ä»¥è°ƒç”¨ dispatch_source_merge_data ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸å¯ä»¥ä¼ é€’0å€¼(äº‹ä»¶ä¸ä¼šè¢«è§¦å‘)ï¼ŒåŒæ ·ä¹Ÿä¸å¯ä»¥ä¼ é€’è´Ÿæ•°ã€‚</span></div><h1>GCDçœŸçš„ä¸èƒ½åƒOperationQueueé‚£æ ·ç»ˆæ­¢ä»»åŠ¡ï¼Ÿ</h1><h3>å®Œæ•´ä¾‹å­Demo1ï¼šè®© Dispatch Source â€œå¸®â€ Dispatch Queue å®ç°æš‚åœå’Œæ¢å¤åŠŸèƒ½</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æœ¬èŠ‚é…å¥—ä»£ç åœ¨ Demo1 ä¸­ï¼ˆDemo_01_å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_mainé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å…ˆå†™ä¸€æ®µä»£ç æ¼”ç¤ºä¸‹DispatchSourceçš„åŸºæœ¬ç”¨æ³•ï¼š</span></div><div>//</div><div>//Â  .m</div><div>//Â  CYLDispatchSourceTest</div><div>//</div><div>//Â  Created by å¾®åš@iOSç¨‹åºçŠ­è¢ï¼ˆ <a href="http://weibo.com/luohanchenyilong/%EF%BC%89">http://weibo.com/luohanchenyilong/ï¼‰</a> on 15/9/1.</div><div>//Â  Copyright (c) 2015å¹´ <a href="https://github.com/ChenYilong">https://github.com/ChenYilong</a> . All rights reserved.</div><div>//</div><div><br/></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div>Â Â Â  //1.</div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_main_queue());</div><div>Â Â Â  __block NSUInteger totalComplete = 0;</div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div>Â Â Â Â Â Â Â  NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div>Â Â Â Â Â Â Â  totalComplete += value;</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ğŸ”µçº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div>Â Â Â  });</div><div>Â Â Â  //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div>Â Â Â  [self resume];</div><div><br/></div><div>Â Â Â  //2.</div><div>Â Â Â  //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div>Â Â Â  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>Â Â Â  dispatch_async(queue, ^{</div><div>Â Â Â Â Â Â Â  for (NSUInteger index = 0; index &lt; 100; index++) {</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>Â Â Â Â Â Â Â Â Â Â Â  NSLog(@&quot;â™»ï¸çº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div>Â Â Â Â Â Â Â Â Â Â Â  usleep(20000);//0.02ç§’</div><div>Â Â Â Â Â Â Â  }</div><div>Â Â Â  });</div><div>}</div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åˆ™è¾“å‡ºæ—¥å¿—ï¼š</span></div><div>2015-09-03 16:50:48.346 CYLDispatchSourceTest[8331:874681] âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)</div><div>2015-09-03 16:50:48.348 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.372 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.401 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.424 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.444 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.473 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.493 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.515 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.07000000000000001</div><div>2015-09-03 16:50:48.515 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:48.516 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.08</div><div>2015-09-03 16:50:48.516 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:48.535 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:48.556 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.09</div><div>/*================çœç•¥ä¸­é—´====================*/</div><div>2015-09-03 16:50:50.630 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:50.630 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.97</div><div>2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:50.654 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.98</div><div>2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:50.676 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:50.699 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:50:50.708 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š0.99</div><div>2015-09-03 16:50:50.708 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874681] è¿›åº¦ï¼š1</div><div>2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874681] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff373428140&gt;{number = 1, name = main}</div><div>2015-09-03 16:50:50.722 CYLDispatchSourceTest[8331:874889] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7ff3735abe40&gt;{number = 2, name = (null)}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è€—æ—¶ï¼š2.376</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™æ®µä»£ç è¿˜å¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å°†åˆ›å»ºå¼‚æ­¥çš„æ“ä½œæ”¾åœ¨ for å¾ªç¯å†…éƒ¨ï¼š</span></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div>Â Â Â  //1.</div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_main_queue());</div><div>Â Â Â  __block NSUInteger totalComplete = 0;</div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div>Â Â Â Â Â Â Â  NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div>Â Â Â Â Â Â Â  totalComplete += value;</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/100));</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ğŸ”µçº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div><br/></div><div>Â Â Â  });</div><div>Â Â Â  //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div>Â Â Â  [self resume];</div><div><br/></div><div>Â Â Â  //2.</div><div>Â Â Â  //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div>Â Â Â  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>Â Â Â Â Â Â Â  for (NSUInteger index = 0; index &lt; 100; index++) {</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_async(queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>Â Â Â Â Â Â Â Â Â Â Â  NSLog(@&quot;â™»ï¸çº¿ç¨‹å·ï¼š%@&quot;, [NSThread currentThread]);</div><div>Â Â Â Â Â Â Â Â Â Â Â  usleep(20000);//0.02ç§’</div><div>Â Â Â Â Â Â Â Â Â Â Â  });</div><div>Â Â Â Â Â Â Â  }</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ‰§è¡Œç»“æœï¼š</span></div><div>2015-09-03 16:48:10.153 CYLDispatchSourceTest[8301:871133] âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)</div><div>2015-09-03 16:48:10.154 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:48:10.156 CYLDispatchSourceTest[8301:871177] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663417370&gt;{number = 4, name = (null)}</div><div>2015-09-03 16:48:10.156 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;{number = 3, name = (null)}</div><div>2015-09-03 16:48:10.163 CYLDispatchSourceTest[8301:871184] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635507b0&gt;{number = 5, name = (null)}</div><div>2015-09-03 16:48:10.164 CYLDispatchSourceTest[8301:871185] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618c90&gt;{number = 6, name = (null)}</div><div>2015-09-03 16:48:10.164 CYLDispatchSourceTest[8301:871186] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663596920&gt;{number = 7, name = (null)}</div><div>2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871187] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663465d20&gt;{number = 8, name = (null)}</div><div>2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871175] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634404f0&gt;{number = 9, name = (null)}</div><div>2015-09-03 16:48:10.182 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.09</div><div>2015-09-03 16:48:10.174 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:48:10.187 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.184 CYLDispatchSourceTest[8301:871188] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348e850&gt;{number = 10, name = (null)}</div><div>2015-09-03 16:48:10.184 CYLDispatchSourceTest[8301:871177] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663417370&gt;{number = 4, name = (null)}</div><div>2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.13</div><div>2015-09-03 16:48:10.187 CYLDispatchSourceTest[8301:871192] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348db80&gt;{number = 11, name = (null)}</div><div>2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871189] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635121b0&gt;{number = 12, name = (null)}</div><div>2015-09-03 16:48:10.191 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;{number = 3, name = (null)}</div><div>2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871184] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635507b0&gt;{number = 5, name = (null)}</div><div>2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871185] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618c90&gt;{number = 6, name = (null)}</div><div>2015-09-03 16:48:10.192 CYLDispatchSourceTest[8301:871186] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663596920&gt;{number = 7, name = (null)}</div><div>2015-09-03 16:48:10.194 CYLDispatchSourceTest[8301:871190] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635138b0&gt;{number = 13, name = (null)}</div><div>2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871187] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663465d20&gt;{number = 8, name = (null)}</div><div>2015-09-03 16:48:10.196 CYLDispatchSourceTest[8301:871175] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634404f0&gt;{number = 9, name = (null)}</div><div>2015-09-03 16:48:10.206 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.21</div><div>2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.210 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.23</div><div>2015-09-03 16:48:10.201 CYLDispatchSourceTest[8301:871193] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663487830&gt;{number = 14, name = (null)}</div><div>2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871194] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634662c0&gt;{number = 15, name = (null)}</div><div>2015-09-03 16:48:10.207 CYLDispatchSourceTest[8301:871195] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618160&gt;{number = 16, name = (null)}</div><div>2015-09-03 16:48:10.211 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.210 CYLDispatchSourceTest[8301:871196] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663566720&gt;{number = 17, name = (null)}</div><div>2015-09-03 16:48:10.211 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;{number = 2, name = (null)}</div><div>/*ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼çœç•¥20è¡Œå¸¦æœ‰çš„ â™»ï¸çš„æ‰“å°å†…å®¹ï¼ˆæ²¡æœ‰é‡å¤çš„çº¿ç¨‹å·ï¼‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼*/</div><div>2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871196] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663566720&gt;{number = 17, name = (null)}</div><div>2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871174] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663616c50&gt;{number = 2, name = (null)}</div><div>2015-09-03 16:48:10.239 CYLDispatchSourceTest[8301:871191] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663597ca0&gt;{number = 18, name = (null)}</div><div>2015-09-03 16:48:10.245 CYLDispatchSourceTest[8301:871202] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663617c00&gt;{number = 24, name = (null)}</div><div>2015-09-03 16:48:10.247 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.5</div><div>2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.248 CYLDispatchSourceTest[8301:871203] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663531ab0&gt;{number = 25, name = (null)}</div><div>2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.51</div><div>2015-09-03 16:48:10.249 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871204] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66344bbf0&gt;{number = 26, name = (null)}</div><div>2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.52</div><div>2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.53</div><div>2015-09-03 16:48:10.250 CYLDispatchSourceTest[8301:871205] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663461d90&gt;{number = 27, name = (null)}</div><div>2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871206] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66341d370&gt;{number = 28, name = (null)}</div><div>2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.54</div><div>2015-09-03 16:48:10.251 CYLDispatchSourceTest[8301:871207] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634196e0&gt;{number = 29, name = (null)}</div><div>2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.254 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.57</div><div>2015-09-03 16:48:10.254 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.58</div><div>2015-09-03 16:48:10.252 CYLDispatchSourceTest[8301:871208] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66341bd50&gt;{number = 30, name = (null)}</div><div>2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871209] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66361a070&gt;{number = 31, name = (null)}</div><div>2015-09-03 16:48:10.253 CYLDispatchSourceTest[8301:871210] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663618020&gt;{number = 32, name = (null)}</div><div>2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.255 CYLDispatchSourceTest[8301:871211] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663612c90&gt;{number = 33, name = (null)}</div><div>2015-09-03 16:48:10.256 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.59</div><div>2015-09-03 16:48:10.257 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.256 CYLDispatchSourceTest[8301:871212] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635996d0&gt;{number = 34, name = (null)}</div><div>2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.6</div><div>2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.259 CYLDispatchSourceTest[8301:871213] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66340bd30&gt;{number = 35, name = (null)}</div><div>2015-09-03 16:48:10.260 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.61</div><div>2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.262 CYLDispatchSourceTest[8301:871214] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66354f4b0&gt;{number = 36, name = (null)}</div><div>2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.62</div><div>2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.264 CYLDispatchSourceTest[8301:871215] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663531010&gt;{number = 37, name = (null)}</div><div>2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.63</div><div>2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871216] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66360c6e0&gt;{number = 38, name = (null)}</div><div>2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871176] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66359ac80&gt;{number = 3, name = (null)}</div><div>2015-09-03 16:48:10.270 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š0.64</div><div>2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871198] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb663576ab0&gt;{number = 20, name = (null)}</div><div>2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871189] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6635121b0&gt;{number = 12, name = (null)}</div><div>2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871188] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348e850&gt;{number = 10, name = (null)}</div><div>2015-09-03 16:48:10.271 CYLDispatchSourceTest[8301:871192] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66348db80&gt;{number = 11, name = (null)}</div><div>/*ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼çœç•¥30è¡Œå¸¦æœ‰çš„ â™»ï¸çš„æ‰“å°å†…å®¹ï¼ˆæ²¡æœ‰é‡å¤çš„çº¿ç¨‹å·ï¼‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼*/</div><div>2015-09-03 16:48:10.277 CYLDispatchSourceTest[8301:871222] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66361ca00&gt;{number = 43, name = (null)}</div><div>2015-09-03 16:48:10.278 CYLDispatchSourceTest[8301:871223] â™»ï¸çº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb66360c620&gt;{number = 44, name = (null)}</div><div>2015-09-03 16:48:10.290 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div>2015-09-03 16:48:10.293 CYLDispatchSourceTest[8301:871133] è¿›åº¦ï¼š1</div><div>2015-09-03 16:48:10.293 CYLDispatchSourceTest[8301:871133] ğŸ”µçº¿ç¨‹å·ï¼š&lt;NSThread: 0x7fb6634077a0&gt;{number = 1, name = main}</div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è€—æ—¶ï¼š0.14ç§’ï¼Œä¸ä¹‹å‰çš„2.376ç§’ç›¸æ¯”ï¼Œæ—¶é—´æ˜¯åè€…çš„17å€ ï¼Œæ€§èƒ½ç›¸å·®å¾ˆå¤§ã€‚</span></div><h3>DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç„¶è€Œä¸Šä¾‹ä¸­ä¹Ÿå› ä¸ºå¹¶å‘æ‰§è¡Œï¼Œé€Ÿåº¦ç›¸å½“å¿«ï¼Œè°ƒç”¨ dispatch_source_merge_data åæ‰€è§¦å‘çš„ dispatch_source_set_event_handler çš„é¢‘ç‡ä¹Ÿå¤§å¤§å‡å°‘ï¼Œæœ‰æ—¶åªä¼šåœ¨ç»“æŸæ—¶è§¦å‘ä¸€æ¬¡ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¦‚æœä½ ç»†å¿ƒè§‚å¯Ÿä¸‹ä¸Šä¾‹ä¸­çš„æ‰“å°ğŸ”µï¼ˆå°è“ç‚¹ï¼‰â™»ï¸ï¼ˆå°ç»¿ç‚¹ï¼‰ä¸ªæ•°æ˜¯ä¸ä¸€çš„ï¼Œä½† totalComplete çš„å€¼ï¼Œæˆ–è€…è¿›åº¦æ¡ä»0.0åˆ°1.0çš„æ‰§è¡Œæ˜¯æ­£å¸¸ï¼Œä½†æ˜¯ğŸ”µï¼ˆå°è“ç‚¹ï¼‰ä¸ºä»€ä¹ˆæ²¡æœ‰è¢«æ‰“å°ï¼Ÿè¿™æ˜¯å› ä¸ºï¼š</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œ</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åœ¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªå¤„ç† block çš„å®ä¾‹è¢«åˆ†é…ï¼Œå¦‚æœè¿™ä¸ªå¤„ç†æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå¦ä¸€ä¸ªäº‹ä»¶å°±å‘ç”Ÿäº†ï¼Œäº‹ä»¶ä¼šä»¥æŒ‡å®šæ–¹å¼ï¼ˆADDæˆ– ORï¼‰è¿›è¡Œç´¯ç§¯ã€‚DispatchSourceèƒ½é€šè¿‡åˆå¹¶äº‹ä»¶ï¼ˆblockï¼‰çš„æ–¹å¼ç¡®ä¿åœ¨é«˜è´Ÿè½½ä¸‹æ­£å¸¸å·¥ä½œã€‚å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡ dispatch_source_get_data æ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”æ—¶é—´æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ä¸­è¿›åº¦æ¡ totalComplete çš„å€¼æ˜¯æœ€ç»ˆç§¯ç´¯çš„å€¼ï¼Œè€Œ block ä¸æ˜¯æ¯æ¬¡éƒ½æ‰§è¡Œçš„ï¼Œä½†æ‰“å°ğŸ”µï¼ˆå°è“ç‚¹ï¼‰â™»ï¸ï¼ˆå°ç»¿ç‚¹ï¼‰ä¸ªæ•°ä¸ä¸€ã€‚ä½†èƒ½ç¡®ä¿è¿›åº¦æ¡èƒ½ä»0.0åˆ°1.0çš„æ­£å¸¸æ‰§è¡Œã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸‹é¢æˆ‘ä»¬æ¥æ¼”ç¤ºä¸‹å¦‚ä½•æ§åˆ¶Dispatch Source(åˆ†æ´¾æº)ï¼Œè®©å®ƒéšæ—¶æš‚åœï¼Œéšæ—¶æ¢å¤ï¼š</span></div><div>- (void)didReceiveMemoryWarning {</div><div>Â Â Â  [super didReceiveMemoryWarning];</div><div>Â Â Â  [self changeStatus:self.running];</div><div>}</div><div><br/></div><div>- (void)changeStatus:(BOOL)shouldPause {</div><div>Â Â Â  if (shouldPause) {</div><div>Â Â Â Â Â Â Â  [self pause];</div><div>Â Â Â  } else {</div><div>Â Â Â Â Â Â Â  [self resume];</div><div>Â Â Â  }</div><div>}</div><div><br/></div><div>- (void)resume {</div><div>Â Â Â  if (self.running) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â  }</div><div>Â Â Â  NSLog(@&quot;âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)&quot;);</div><div>Â Â Â  self.running = YES;</div><div>Â Â Â  dispatch_resume(_processingQueueSource);</div><div>}</div><div><br/></div><div>- (void)pause {</div><div>Â Â Â  if (!self.running) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â  }</div><div>Â Â Â  NSLog(@&quot;ğŸš«æš‚åœDispatch Source(åˆ†æ´¾æº)&quot;);</div><div>Â Â Â  self.running = NO;</div><div>Â Â Â  dispatch_suspend(_processingQueueSource);</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¹¶å–æ¶ˆæ‰“å°çº¿ç¨‹çš„ NSLog ï¼Œç„¶åä½¿ç”¨ä¸‹å›¾ä¸­çš„å¿«æ·é”®è¿…é€Ÿè§¦å‘ didReceiveMemoryWarning ä»¥åˆ‡æ¢Dispatch Source(åˆ†æ´¾æº)çš„çŠ¶æ€:</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://camo.githubusercontent.com/9bc7d58ec6032b886bd6f891c3a92a5ff443a052/687474703a2f2f6936312e74696e797069632e636f6d2f3674686a6d662e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></a><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://camo.githubusercontent.com/aedffd76ce62f7e0ff3517c07b9a0e8741e55a50/687474703a2f2f6935392e74696e797069632e636f6d2f73757974306f2e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image.gif" type="image/gif" data-filename="Image.gif"/><br/></a><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo1 å®ç°ï¼ˆDemo_01_å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_mainé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</span></div><h3>Dispatch Source ä¸ Dispatch Queue ä¸¤è€…åœ¨çº¿ç¨‹æ‰§è¡Œä¸Šçš„å…³ç³»</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æœ¬èŠ‚é…å¥—ä»£ç åœ¨ Demo2 ä¸­ï¼ˆDemo_02_å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_globalé˜Ÿåˆ—ç‰ˆï¼‰ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç­”æ¡ˆæ˜¯ï¼šæ²¡æœ‰å…³ç³»ã€‚ä¸¤è€…ä¼šç‹¬ç«‹è¿è¡Œã€‚ Dispatch Queue åƒä¸€ä¸ªç”Ÿäº§ä»»åŠ¡çš„ç”Ÿäº§è€…ï¼Œè€Œ Dispatch Source åƒå¤„ç†ä»»åŠ¡çš„æ¶ˆè´¹è€…ã€‚å¯ä»¥ä¸€è¾¹å¼‚æ­¥ç”Ÿäº§ï¼Œä¹Ÿå¯ä¸€è¾¹å¼‚æ­¥æ¶ˆè´¹ã€‚ä½ å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä¸Šè°ƒç”¨ dispatch_source_merge_data ä»¥è§¦å‘ dispatch_source_set_event_handler ã€‚è€Œå¥æŸ„çš„æ‰§è¡Œçº¿ç¨‹ï¼Œå–å†³äºä½ åˆ›å»ºå¥æŸ„æ—¶æ‰€æŒ‡å®šçš„çº¿ç¨‹ï¼Œå¦‚æœä½ åƒä¸‹é¢è¿™æ ·åˆ›å»ºï¼Œé‚£ä¹ˆå¥æŸ„ä¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼š</span></div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„ Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_main_queue());</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¦‚æœä½ åƒä¸‹é¢è¿™æ ·åˆ›å»ºï¼Œé‚£ä¹ˆå¥æŸ„ä¼šåœ¨å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œï¼š</span></div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®š global Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_global_queue(0, 0));</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo2 å®ç°ï¼ˆDemo_02_å¯¹DispatchSourceå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_globalé˜Ÿåˆ—ç‰ˆï¼‰</span></div><h3>è®© Dispatch Source ä¸ Dispatch Queue åŒæ—¶å®ç°æš‚åœå’Œæ¢å¤</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æœ¬èŠ‚ä»£ç è¯¦è§ Demo4ï¼ˆDemo_04_å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç»¼åˆç‰ˆï¼‰</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼šä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒåªæ˜¯ä¸€ç§â€œå‡æš‚åœâ€çš„çŠ¶æ€ã€‚for å¾ªç¯è¿˜æ˜¯è¦æ‰§è¡Œ100éï¼Œå¾ªç¯çš„æ¬¡æ•°å¹¶æ²¡æœ‰å› ä½ æš‚åœäº†æ´¾å‘æºè€Œæš‚åœï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºçœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆæ°¸è¿œä¼šæ˜¯åœ¨è¿™é‡Œï¼Œè¿™æ ·çš„æš‚åœæ¯«æ— æ„ä¹‰ã€‚é‚£ä¹ˆå¦‚ä½•è®© for å¾ªç¯éšæ—¶å¯ä»¥æš‚åœï¼Ÿ</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å®é™…ä¸Š Dispatch Queue æ²¡æœ‰â€œå–æ¶ˆâ€è¿™ä¸€æ¦‚å¿µã€‚ä¸€æ—¦å°†å¤„ç†è¿½åŠ åˆ° Dispatch Queue ä¸­ï¼Œå°±æ²¡æœ‰æ–¹æ³•å¯å°†è¯¥å¤„ç†å»é™¤ï¼Œä¹Ÿæ²¡æœ‰æ–¹æ³•å¯åœ¨æ‰§è¡Œä¸­å–æ¶ˆè¯¥å¤„ç†ã€‚ç¼–ç¨‹äººå‘˜è¦ä¹ˆåœ¨å¤„ç†ä¸­å¯¼å…¥å–æ¶ˆè¿™ä¸€æ¦‚å¿µã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¦ä¹ˆæ”¾å¼ƒå–æ¶ˆï¼Œæˆ–è€…ä½¿ç”¨ NSOperationQueue ç­‰å…¶ä»–æ–¹æ³•ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Source ä¸ Dispatch Queue ä¸åŒï¼Œæ˜¯å¯ä»¥å–æ¶ˆçš„ã€‚è€Œä¸”å–æ¶ˆæ—¶å¿…é¡»æ‰§è¡Œçš„å¤„ç†å¯æŒ‡å®šä¸ºå›è°ƒç”¨çš„Blockå½¢å¼ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Source æ˜¯å¦‚ä½•æ‰§è¡Œå–æ¶ˆçš„ï¼Ÿæ‰“ä¸ªæ¯”æ–¹ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Queue å°±å¥½åƒç“œå†œç§ç“œï¼Œåªè¦ç§äº†ç“œï¼Œå°±èµ°ä¸Šäº†ä¸€æ¡ä¸å½’è·¯ï¼šä¸ç®¡æœ‰æ²¡æœ‰äººä¹°ï¼Œä½ éƒ½å¿…é¡»è¦å¥½å¥½æ–½è‚¥ï¼Œå¥½å¥½æµ‡æ°´ã€‚æ²¡æœ‰æ”¾å¼ƒçš„ä½™åœ°ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Source å°±å¥½åƒä¹°ç“œçš„äººï¼Œæ¯”å¦‚ä½ åœ¨ç“œå†œç§ç“œæ—¶ï¼Œå‘Šè¯‰ç“œå†œï¼Œâ€œä½ çš„ç“œç†Ÿä¸€ä¸ªæˆ‘ä¹°ä¸€ä¸ªâ€ï¼Œç­‰ç“œæˆç†Ÿäº†ï¼Œä½ å¼€å§‹ä¹°ï¼Œä¸æ–­å¾—ä¹°ï¼Œé™†ç»­ä¹°äº†100ä¸ªï¼Œçªç„¶ä½ æ„Ÿè§‰åƒå¤Ÿäº†ï¼Œä½ ä¸ä¹°äº†ï¼Œä½†æ˜¯ç“œè¿˜æ˜¯åœ¨ä¸æ–­å¾—æˆç†Ÿç€ï¼Œç„¶ååªèƒ½çƒ‚åœ¨åœ°é‡Œäº†ã€‚ç­‰ä½ çªç„¶åˆæƒ³ä¹°çš„æ—¶å€™ï¼Œåœ°é‡Œå·²ç»æœ‰1000ä¸ªç“œï¼Œä½ è¦ä¹°ï¼Œå¿…é¡»å…¨ä¹°ã€‚ã€‚ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å›åˆ°ä»£ç é‡Œï¼Œä¹Ÿå°±æ˜¯è¯´ Dispatch Source çš„æš‚åœï¼Œåªæ˜¯æš‚åœè°ƒç”¨ dispatch_source_set_event_handler ï¼Œ Dispatch Queue ä¸­çš„forå¾ªç¯å¹¶æ²¡æœ‰å› æ­¤æš‚åœï¼Œå®ƒè¿˜æ˜¯åœ¨ä¸€ç›´è¿è¡Œç€ï¼Œç­‰ä½ æ¢å¤ Dispatch Source çš„æ—¶å€™ï¼Œ Dispatch Queue å¯èƒ½å·²ç»è¿è¡Œç»“æŸã€‚ç„¶åä½ å°±ä¼šåƒä¸Šé¢çš„gifå›¾ä¸­é‚£æ ·ï¼Œä»â€œè¿›åº¦ï¼š0.9â€æš‚åœï¼Œæ¢å¤æ—¶ç›´æ¥è·³åˆ°â€œè¿›åº¦ï¼š1â€ï¼Œè·³è¿‡äº†ä¸­é—´çš„â€œè¿›åº¦ï¼š0.91â€ã€â€œè¿›åº¦ï¼š0.92â€ã€â€œè¿›åº¦ï¼š0.93â€ç­‰ç­‰ã€‚æ‰€ä»¥è¯´è¿™æ˜¯ä¸€ç§â€œå‡æš‚åœâ€ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">é‚£ä¹ˆå¦‚ä½•åœ¨å¤„ç†ä¸­å¯¼å…¥å–æ¶ˆè¿™ä¸€æ¦‚å¿µï¼Ÿä»£ç å¦‚ä¸‹ï¼š</span></div><div>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>__block BOOL isCanceled = NO;</div><div>dispatch_async(queue, ^{</div><div><br/></div><div>Â Â Â  if (isCanceled) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â Â  }</div><div><br/></div><div>Â Â Â  NSData *thumbnailData = [NSURLConnection sendSynchronousRequest:request];</div><div>Â Â Â  ...</div><div>});</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å®Œæ•´çš„ä»£ç åˆ™éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼š</span></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div>Â Â Â  //1.</div><div>Â Â Â  // æŒ‡å®šDISPATCH_SOURCE_TYPE_DATA_ADDï¼ŒåšæˆDispatch Source(åˆ†æ´¾æº)ã€‚è®¾å®šMain Dispatch Queue ä¸ºè¿½åŠ å¤„ç†çš„Dispatch Queue</div><div>Â Â Â  _processingQueueSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_DATA_ADD, 0, 0,</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_get_main_queue());</div><div>Â Â Â  __block NSUInteger totalComplete = 0;</div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  //å½“å¤„ç†äº‹ä»¶è¢«æœ€ç»ˆæ‰§è¡Œæ—¶ï¼Œè®¡ç®—åçš„æ•°æ®å¯ä»¥é€šè¿‡dispatch_source_get_dataæ¥è·å–ã€‚è¿™ä¸ªæ•°æ®çš„å€¼åœ¨æ¯æ¬¡å“åº”äº‹ä»¶æ‰§è¡Œåä¼šè¢«é‡ç½®ï¼Œæ‰€ä»¥totalCompleteçš„å€¼æ˜¯æœ€ç»ˆç´¯ç§¯çš„å€¼ã€‚</div><div>Â Â Â Â Â Â Â  NSUInteger value = dispatch_source_get_data(_processingQueueSource);</div><div>Â Â Â Â Â Â Â  totalComplete += value;</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;è¿›åº¦ï¼š%@&quot;, @((CGFloat)totalComplete/CYLTotalNumber));</div><div>Â Â Â  });</div><div>Â Â Â  //åˆ†æ´¾æºåˆ›å»ºæ—¶é»˜è®¤å¤„äºæš‚åœçŠ¶æ€ï¼Œåœ¨åˆ†æ´¾æºåˆ†æ´¾å¤„ç†ç¨‹åºä¹‹å‰å¿…é¡»å…ˆæ¢å¤ã€‚</div><div>Â Â Â  [self resume];</div><div><br/></div><div><br/></div><div>Â Â Â  //2.</div><div>Â Â Â  //æ¢å¤æºåï¼Œå°±å¯ä»¥é€šè¿‡dispatch_source_merge_dataå‘Dispatch Source(åˆ†æ´¾æº)å‘é€äº‹ä»¶:</div><div>Â Â Â  //ä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œå°†_queueåšæˆâ€œä¸²è¡Œé˜Ÿåˆ—â€</div><div>Â Â Â  _queue = dispatch_queue_create(&quot;com.ioschengxuyuan.queue1&quot;, 0);</div><div>Â Â Â  NSLog(@&quot;ğŸ”´ç±»åä¸æ–¹æ³•åï¼š%sï¼ˆåœ¨ç¬¬%dè¡Œï¼‰ï¼Œæè¿°ï¼š%@&quot;, __PRETTY_FUNCTION__, __LINE__, @&quot;å¯åŠ¨é˜Ÿåˆ—&quot;);</div><div>Â Â Â  for (NSUInteger index = 0; index &lt; CYLTotalNumber; index++) {</div><div>Â Â Â Â Â Â Â  dispatch_async(_queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  if (!self.running) {</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;</div><div>Â Â Â Â Â Â Â Â Â Â Â  }</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>Â Â Â Â Â Â Â Â Â Â Â  usleep(200000);//0.2ç§’</div><div>Â Â Â Â Â Â Â  });</div><div>Â Â Â  }</div><div>}</div><div><br/></div><div>- (void)didReceiveMemoryWarning {</div><div>Â Â Â  [super didReceiveMemoryWarning];</div><div>Â Â Â  [self changeStatus:self.running];</div><div>}</div><div><br/></div><div>- (void)changeStatus:(BOOL)shouldPause {</div><div>Â Â Â  if (shouldPause) {</div><div>Â Â Â Â Â Â Â  [self pause];</div><div>Â Â Â  } else {</div><div>Â Â Â Â Â Â Â  [self resume];</div><div>Â Â Â  }</div><div>}</div><div><br/></div><div>- (void)resume {</div><div>Â Â Â  if (self.running) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â  }</div><div>Â Â Â  NSLog(@&quot;âœ…æ¢å¤Dispatch Source(åˆ†æ´¾æº)ä»¥åŠ_queue&quot;);</div><div>Â Â Â  self.running = YES;</div><div>Â Â Â  dispatch_resume(_processingQueueSource);</div><div>Â Â Â  if (_queue) {</div><div>Â Â Â Â Â Â Â  dispatch_resume(_queue);</div><div>Â Â Â  }</div><div>}</div><div><br/></div><div>- (void)pause {</div><div>Â Â Â  if (!self.running) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â  }</div><div>Â Â Â  NSLog(@&quot;ğŸš«æš‚åœDispatch Source(åˆ†æ´¾æº)ä»¥åŠ_queue&quot;);</div><div>Â Â Â  self.running = NO;</div><div>Â Â Â  dispatch_suspend(_processingQueueSource);</div><div>Â Â Â  dispatch_suspend(_queue);</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://camo.githubusercontent.com/ecd18e4e827f9de514f1e94d8fcef6efa78deff6/687474703a2f2f6936312e74696e797069632e636f6d2f33336d303665722e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image [1].gif" type="image/gif" data-filename="Image.gif"/><br/></a><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo4ï¼ˆDemo_04_å¯¹DispatchQueueå®ç°å–æ¶ˆæ¢å¤æ“ä½œ_ç»¼åˆç‰ˆï¼‰</span></div><h2>Parse â€œç¦»çº¿å­˜å‚¨å¯¹è±¡â€æ“ä½œçš„ä»£ç æ‘˜å½•</h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¥æŸ„å¦‚ä¸‹ï¼š</span></div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  [self _runCommands];</div><div>Â Â Â  });</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä½•æ—¶ä¼šè°ƒç”¨å¥æŸ„ï¼Ÿ ä¸‹é¢å°† Parse é‡Œæ¶‰åŠè°ƒç”¨å¥æŸ„çš„è¯­å¥ç½—åˆ—ä¸€ä¸‹ï¼Œ å› ä¸ºæ‘˜å½•çš„ä»£ç ä¸å®Œæ•´ï¼Œå¯èƒ½å¹¶ä¸èƒ½çœ‹å‡ºä½¿ç”¨çš„å®Œæ•´è¿‡ç¨‹ã€‚æ‰€ä»¥å¯ä»¥å¤§è‡´é¢„è§ˆä¸€ä¸‹ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹Parse æºç ï¼Œå¹¶ä¸”æˆ‘å·²å°†è¿™äº›é€»è¾‘æµ“ç¼©ä¸ºå¯è¿è¡Œçš„ Demoï¼Œä¹Ÿå¯æ­é…ç†è§£ã€‚</span></div><div>- (void)start {</div><div>Â Â Â  dispatch_source_set_event_handler(_processingQueueSource, ^{</div><div>Â Â Â Â Â Â Â  [self _runCommands];</div><div>Â Â Â  });</div><div>Â Â Â  [self resume];</div><div>}</div><div>- (void)resume {</div><div>Â Â Â  if (self.running) {</div><div>Â Â Â Â Â Â Â  return;</div><div>Â Â Â  }</div><div>Â Â Â  self.running = YES;</div><div>Â Â Â  dispatch_resume(_processingQueueSource);</div><div>Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç›‘å¬ç½‘ç»œçŠ¶æ€ï¼Œä¸€æ—¦ç½‘ç»œé‡è¿ä¸Šä¹‹åï¼Œè®¾ç½® connectedå±æ€§ä¸º YESï¼Œå¹¶é‡å†™å…¶ setter æ–¹æ³•ï¼Œè°ƒç”¨ dispatch_source_merge_data è¿›è¡Œå‘é€æ¶ˆæ¯çš„æ“ä½œï¼š</span></div><div>/*! Manually sets the network connection status. */</div><div>- (void)setConnected:(BOOL)connected {</div><div>Â Â Â  BFTaskCompletionSource *barrier = [BFTaskCompletionSource taskCompletionSource];</div><div>Â Â Â  dispatch_async(_processingQueue, ^{</div><div>Â Â Â Â Â Â Â  dispatch_sync(_synchronizationQueue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  if (self.connected != connected) {</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  _connected = connected;</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (connected) {</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }</div><div>Â Â Â Â Â Â Â Â Â Â Â  }</div><div>Â Â Â Â Â Â Â  });</div><div>Â Â Â Â Â Â Â  barrier.result = nil;</div><div>Â Â Â  });</div><div>Â Â Â  if (connected) {</div><div>Â Â Â Â Â Â Â  dispatch_async(_synchronizationQueue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  if (_retryingSemaphore) {</div><div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  dispatch_semaphore_signal(_retryingSemaphore);</div><div>Â Â Â Â Â Â Â Â Â Â Â  }</div><div>Â Â Â Â Â Â Â  });</div><div>Â Â Â  }</div><div>Â Â Â  [barrier.task waitForResult:nil];</div><div>}</div><div><br/></div><div>- (void)_didEnqueueCommand:(id&lt;PFNetworkCommand&gt;)command</div><div>Â Â Â Â Â Â Â Â Â Â Â  withIdentifier:(NSString *)identifier</div><div>Â Â Â Â Â  taskCompletionSource:(BFTaskCompletionSource *)taskCompletionSource {</div><div>Â Â Â  PFAssertIsOnDispatchQueue(_synchronizationQueue);</div><div><br/></div><div>Â Â Â  _taskCompletionSources[identifier] = taskCompletionSource;</div><div>Â Â Â  dispatch_source_merge_data(_processingQueueSource, 1);</div><div><br/></div><div>Â Â Â  if (_retryingSemaphore) {</div><div>Â Â Â Â Â Â Â  dispatch_semaphore_signal(_retryingSemaphore);</div><div>Â Â Â  }</div><div>}</div><div><br/></div><h2>Dispatch Semaphore ä¿¡å·é‡</h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸ºäº†å±•ç¤ºä½œç”¨ï¼Œä¸¾ä¸ªåä¾‹ï¼š</span></div><div>Â Â Â  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>Â Â Â  NSMutableArray *array = [[NSMutableArray alloc] init];</div><div>Â Â Â  dispatch_group_t group = dispatch_group_create();</div><div>Â Â Â  for(int i = 0; i&lt; 100000; ++i) {</div><div>Â Â Â Â Â Â Â  dispatch_group_async(group, queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  [array addObject:[NSNumber numberWithInt:i]];</div><div>Â Â Â Â Â Â Â  });</div><div>Â Â Â  }</div><div>Â Â Â  dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</div><div>Â Â Â  NSLog(@&quot;%@&quot;,Â  @([array count]));</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿è¡Œç»“æœç»å¯¹å¤§è·Œçœ¼é•œï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æˆ‘è¿è¡Œäº†ä¸‰æ¬¡ï¼Œä¸‰æ¬¡ç»“æœå‡ä¸ä¸€è‡´ï¼š</span></div><ol><li>ç¬¬ä¸€æ¬¡ï¼šå´©æºƒã€‚ã€‚ã€‚<br/><a href="https://camo.githubusercontent.com/63a266138f18f6e225146375424c12e37399ad15/687474703a2f2f6936372e74696e797069632e636f6d2f323976787439772e6a7067"><img src="ç¨€åœŸæ˜é‡‘  (äºŒåå…«)  ä½ ä¸çŸ¥é“çš„GCD_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></a><br/>CYLDispatchSemaphoreTest(10384,0x112d43000) malloc: *** error for object 0x7f898487ca00: pointer being freed was not allocated<br/>*** set a breakpoint in malloc_error_break to debug<br/>(lldb) </li><li>ç¬¬äºŒæ¬¡ï¼šä¸å¤Ÿã€‚ã€‚<br/>2015-09-07 00:42:20.145 CYLDispatchSemaphoreTest[10417:779722] 99996</li><li>ç¬¬ä¸‰æ¬¡ï¼šè¿˜æ˜¯ä¸å¤Ÿã€‚ã€‚ã€‚<br/>2015-09-07 00:42:52.734 CYLDispatchSemaphoreTest[10438:780505] 99949</li></ol><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ç§èµ„æºæŠ¢å¤ºçš„æƒ…å†µï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—ï¼Œæˆ–è€…åƒä¸‹é¢ä¸€æ ·çš„åŒæ­¥é˜Ÿåˆ—ï¼Œå¾—ä»¥è§£å†³ï¼š</span></div><div> dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div>Â Â Â  NSMutableArray *array = [[NSMutableArray alloc] init];</div><div>Â Â Â  for(int i = 0; i&lt; 100000; ++i) {</div><div>Â Â Â Â Â Â Â  dispatch_sync(queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  [array addObject:[NSNumber numberWithInt:i]];</div><div>Â Â Â Â Â Â Â  });</div><div><br/></div><div>Â Â Â  }</div><div>Â Â Â  NSLog(@&quot;%@&quot;, @([array count]));</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸‹é¢å±•ç¤ºä¸‹å±•ç¤ºä½¿ç”¨ dispatch_semaphore_t çš„è§£å†³æ–¹æ¡ˆï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">dispatch_semaphore_t çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯è§£å†³è¿™ç§èµ„æºæŠ¢å¤ºçš„æƒ…å†µï¼Œä¸‹é¢å±•ç¤ºä¸‹ä½¿ç”¨ dispatch_semaphore_t å®ç°ä¸€ä¸ªèµ„æºé”ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä»¥ä¸‹æºç è¯¦è§ Demo6ï¼ˆDemo_06_å±•ç¤ºdispatch_semaphore_tåŸºæœ¬ç”¨æ³•ï¼‰</span></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div>Â Â Â  //å› ä¸ºç”¨åˆ°äº†dispatch_barrier_asyncï¼Œè¯¥å‡½æ•°åªèƒ½æ­é…è‡ªå®šä¹‰å¹¶è¡Œé˜Ÿåˆ—dispatch_queue_tä½¿ç”¨ã€‚æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ï¼šdispatch_get_global_queue</div><div>Â Â Â  dispatch_queue_t queue = dispatch_queue_create(&quot;com.ioschengxuyuan.gcd.ForBarrier&quot;, DISPATCH_QUEUE_CONCURRENT);</div><div>Â Â Â  /*</div><div>Â Â Â Â  *</div><div>Â Â Â Â  *ç”ŸæˆDispatch Semaphore</div><div>Â Â Â Â  Dispatch Semaphore çš„è®¡æ•°åˆå§‹å€¼è®¾å®šä¸ºâ€œ1â€</div><div>Â Â Â Â  (è¯¥åˆå§‹å€¼çš„1ä¸ä¸‹æ–‡ä¸­ä¸¤ä¸ªå‡½æ•°dispatch_semaphore_waitä¸dispatch_semaphore_signalè¿›è¡Œçš„å‡1ã€åŠ 1é‡Œçš„1æ²¡æœ‰å¿…ç„¶è”ç³»ã€‚</div><div><br/></div><div>Â Â Â Â  å°±ç®—åˆå§‹å€¼æ˜¯100ï¼Œä¸¤ä¸ªå‡½æ•°dispatch_semaphore_waitä¸dispatch_semaphore_signalè¿˜æ˜¯ä¼šå‡â€œ1â€ã€åŠ â€œ1â€)ã€‚</div><div>Â Â Â Â  ä¿è¯å¯è®¿é—® NSMutableArray ç±»å¯¹è±¡çš„çº¿ç¨‹</div><div>Â Â Â Â  åŒæ—¶åªèƒ½æœ‰1ä¸ª</div><div>Â Â Â Â  *</div><div>Â Â Â Â  */</div><div>Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(1) ;</div><div>Â Â Â  NSMutableArray *array = [[NSMutableArray alloc] init];</div><div>Â Â Â  for(int i = 0; i&lt; 100000; ++i) {</div><div>Â Â Â Â Â Â Â  dispatch_async(queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  /*</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *ç­‰å¾…Dispatch Semaphore</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  */</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER) ;</div><div>Â Â Â Â Â Â Â Â Â Â Â  /*</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *ç”±äºDispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *æ‰€ä»¥å°†Dispatch Semaphoreçš„è®¡æ•°å€¼å‡å»1</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *dispatch_semaphore_wait å‡½æ•°æ‰§è¡Œè¿”å›ã€‚</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *å³æ‰§è¡Œåˆ°æ­¤æ—¶çš„</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *Dispatch Semaphore çš„è®¡æ•°å€¼æ’ä¸º0</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *ç”±äºå¯è®¿é—®NSMutaleArrayç±»å¯¹è±¡çš„çº¿ç¨‹</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *åªæœ‰ä¸€ä¸ª</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *å› æ­¤å¯å®‰å…¨åœ°è¿›è¡Œæ›´æ–°</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  */</div><div>Â Â Â Â Â Â Â Â Â Â Â  NSLog(@&quot;ğŸ”´%@&quot;,[NSThread currentThread]);</div><div>Â Â Â Â Â Â Â Â Â Â Â  [array addObject:[NSNumber numberWithInt:i]];</div><div>Â Â Â Â Â Â Â Â Â Â Â  /*</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *æ’ä»–æ§åˆ¶å¤„ç†ç»“æŸï¼Œ</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *æ‰€ä»¥é€šè¿‡dispatch_semaphore_signalå‡½æ•°</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *å°†Dispatch Semaphoreçš„è®¡æ•°å€¼åŠ 1</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *å¦‚æœæœ‰é€šè¿‡dispatch_semaphore_waitå‡½æ•°</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  *ç­‰å¾…Dispatch Semaphoreçš„è®¡æ•°å€¼å¢åŠ çš„çº¿ç¨‹ï¼Œ</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  â˜…å°±ç”±æœ€å…ˆç­‰å¾…çš„çº¿ç¨‹æ‰§è¡Œã€‚</div><div>Â Â Â Â Â Â Â Â Â Â Â Â  */</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_semaphore_signal(semaphore);</div><div>Â Â Â Â Â Â Â  });</div><div>Â Â Â  }</div><div>Â Â Â  /*</div><div>Â Â Â Â  *</div><div>Â Â Â Â  ç­‰ä¸ºæ•°ç»„éå†æ·»åŠ å…ƒç´ åï¼Œæ£€æŸ¥ä¸‹æ•°ç»„çš„æˆå‘˜ä¸ªæ•°æ˜¯å¦æ­£ç¡®</div><div>Â Â Â Â  *</div><div>Â Â Â Â  */</div><div>Â Â Â  dispatch_barrier_async(queue, ^{</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;ğŸ”´ç±»åä¸æ–¹æ³•åï¼š%sï¼ˆåœ¨ç¬¬%dè¡Œï¼‰ï¼Œæè¿°ï¼š%@&quot;, __PRETTY_FUNCTION__, __LINE__, @([array count]));</div><div>Â Â Â  });</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸ºäº†åŠ æ·±å¯¹dispatch_semaphore_tåŸºæœ¬ç”¨æ³•çš„ç†è§£ï¼Œå†ç»™ä¸€ä¸ªç¤ºä¾‹ Demoï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ€è€ƒä¸‹ä¸ºä½•ä¼šå¦‚ä½•æ‰“å°ï¼š ç„¶åå†åˆ†åˆ«è¯•ä¸€ä¸‹ç¬¬ä¸‰è¡Œå’Œç¬¬å››è¡Œï¼š</span></div><div>Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div>//Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç„¶åè§‚å¯Ÿä¸‹æ‰“å°ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo5ï¼ˆDemo_05_å±•ç¤ºdispatch_semaphore_tåŸºæœ¬ç”¨æ³•ï¼‰</span></div><div>- (void)viewDidLoad {</div><div>Â Â Â  [super viewDidLoad];</div><div><br/></div><div>Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div>//Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);</div><div><br/></div><div>Â Â Â  dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 1ull * NSEC_PER_SEC);//ç­‰å¾…ä¸€ç§’</div><div>Â Â Â  //dispatch_time_t time = DISPATCH_TIME_FOREVER;//æ°¸ä¹…ç­‰å¾…</div><div>Â Â Â  NSLog(@&quot;begin ==&gt;Â  è½¦åº“å¼€å§‹è¥ä¸šäº†ï¼&quot;);</div><div>Â Â Â  /*</div><div>Â Â Â Â  *</div><div>Â Â Â Â  å¦‚æœ semphore çš„å€¼ç­‰äº0ï¼Œå°±é˜»å¡1ç§’é’Ÿï¼Œæ‰ä¼šå¾€ä¸‹ç…§å¸¸è¿›è¡Œï¼›</div><div>Â Â Â Â  å¦‚æœå¤§äºç­‰äº1åˆ™å¾€ä¸‹è¿›è¡Œå¹¶å°† semphore è¿›è¡Œå‡1å¤„ç†ã€‚</div><div>Â Â Â Â  *</div><div>Â Â Â Â  */</div><div>Â Â Â  long result = dispatch_semaphore_wait(semaphore, time);</div><div>Â Â Â  if (result == 0) {</div><div>Â Â Â Â Â Â Â  /*</div><div>Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â  *ç”±å­Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div>Â Â Â Â Â Â Â Â  *æˆ–è€…åœ¨å¾…æœºä¸­çš„æŒ‡å®šæ—¶é—´å†…</div><div>Â Â Â Â Â Â Â Â  *Dispatch Semaphoreçš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº1</div><div>Â Â Â Â Â Â Â Â  æ‰€ä»¥Dispatch Semaphoreçš„è®¡æ•°å€¼å‡å»1</div><div>Â Â Â Â Â Â Â Â  å¯æ‰§è¡Œéœ€è¦è¿›è¡Œæ’ä»–æ§åˆ¶çš„å¤„ç†.</div><div>Â Â Â Â Â Â Â Â  å¯ä»¥ç†è§£ä¸ºï¼šæ²¡æœ‰é˜»å¡çš„çº¿ç¨‹äº†ã€‚</div><div>Â Â Â Â Â Â Â Â  å°±å¥½æ¯”ï¼šè½¦åº“æœ‰ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„è½¦ä½ï¼Œåªæ¥äº†ä¸€è¾†è½¦ï¼Œæ‰€ä»¥â€œæ— éœ€ç­‰å¾…â€</div><div>Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â  */</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;result = 0 ==&gt; æœ‰è½¦ä½ï¼Œæ— éœ€ç­‰å¾…ï¼==&gt; åœ¨è¿™é‡Œå¯å®‰å…¨åœ°æ‰§è¡Œã€éœ€è¦æ’ä»–æ§åˆ¶çš„å¤„ç†ï¼ˆæ¯”å¦‚åªå…è®¸ä¸€æ¡çº¿ç¨‹ä¸ºmutableArrayè¿›è¡ŒaddObjæ“ä½œï¼‰ã€‘&quot;);</div><div>Â Â Â Â Â Â Â  dispatch_semaphore_signal(semaphore);//ä½¿ç”¨signalä»¥ç¡®ä¿ç¼–è¯‘å™¨releaseæ‰dispatch_semaphore_tæ—¶çš„å€¼ä¸åˆå§‹å€¼ä¸€è‡´ï¼Œ å¦åˆ™ä¼šEXC_BAD_INSTRUCTION ,è§http://is.gd/EaJgk5</div><div>Â Â Â  } else {</div><div>Â Â Â Â Â Â Â  /*</div><div>Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â  *ç”±äºDispatch Semaphoreçš„è®¡æ•°å€¼ä¸º0</div><div>Â Â Â Â Â Â Â Â  .å› æ­¤åœ¨è¾¾åˆ°æŒ‡å®šæ—¶é—´ä¸ºæ­¢å¾…æœº</div><div>Â Â Â Â Â Â Â Â  è¿™ä¸ªelseé‡Œå‘ç”Ÿçš„äº‹æƒ…ï¼Œå°±å¥½æ¯”ï¼šè½¦åº“æ²¡è½¦ä½ï¼Œæ¥äº†ä¸€è¾†è½¦ï¼Œç­‰å¾…äº†åŠä¸ªå°æ—¶åï¼Œåšå‡ºçš„ä¸€äº›äº‹æƒ…ã€‚</div><div>Â Â Â Â Â Â Â Â  æ¯”å¦‚ï¼šå¿å—ä¸äº†ï¼Œèµ°äº†ã€‚ã€‚</div><div>Â Â Â Â Â Â Â Â  *</div><div>Â Â Â Â Â Â Â Â  */</div><div>Â Â Â Â Â Â Â  NSLog(@&quot;result != 0 ==&gt; timeoutï¼Œdeadlineï¼Œå¿å—ä¸äº†ï¼Œèµ°äº†ã€‚ã€‚&quot;);</div><div><br/></div><div>Â Â Â  }</div><div>}</div><h3>åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šå¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸‹é¢æ˜¯ Parse çš„ä¸€æ®µä»£ç ï¼š</span></div><div> @interface PFEventuallyQueueTestHelper : NSObject {</div><div>Â Â Â  dispatch_semaphore_t events[PFEventuallyQueueEventCount];</div><div>}</div><div><br/></div><div>- (void)clear;</div><div>- (void)notify:(PFEventuallyQueueTestHelperEvent)event;</div><div>- (BOOL)waitFor:(PFEventuallyQueueTestHelperEvent)event;</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ³¨é‡Šæ˜¯è¿™æ ·å†™çš„ï¼š</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">PFEventuallyQueueTestHelper gets notifications of various events happening in the command cache, // so that tests can be synchronized. See CommandTests.m for examples of how to use this.</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å¼ºåˆ¶æŠŠå¼‚æ­¥ä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥ä»»åŠ¡æ¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚è¿™ä¸ªç”¨é€”ä¿¡å·é‡æ˜¯æœ€åˆé€‚çš„ç”¨é€”ã€‚ä½†æ³¨æ„å¹¶ä¸æ¨èåº”ç”¨åˆ°é™¤æ­¤ä¹‹å¤–çš„å…¶å®ƒåœºæ™¯ï¼</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ç§å¼‚æ­¥è½¬åŒæ­¥ä¾¿äºå•å…ƒæµ‹è¯•çš„ç”¨æ³•ç±»ä¼¼äºä¸‹é¢çš„å†™æ³•ï¼š</span></div><div>#define WAIT_FOREVER [self waitForStatus:XCTAsyncTestCaseStatusSucceeded timeout:DBL_MAX];</div><div>#define NOTIFY [self notify:XCTAsyncTestCaseStatusSucceeded];</div><div>- (void)testInstallationMutated {</div><div>Â Â Â  NSDictionary *dict = [self jsonWithFileName:@&quot;TestInstallationSave&quot;];</div><div>Â Â Â  AVInstallation *installation = [AVInstallation currentInstallation];</div><div>Â Â Â  [installation objectFromDictionary:dict];</div><div>Â Â Â  [installation setObject:@(YES) forKey:@&quot;enableNoDisturb&quot;];</div><div>Â Â Â  [installation saveInBackgroundWithBlock:^(BOOL succeeded, NSError *error) {</div><div>Â Â Â Â Â Â Â  XCTAssertNil(error);</div><div>Â Â Â Â Â Â Â  NOTIFY;</div><div>Â Â Â  }];</div><div>Â Â Â  WAIT;</div><div>} </div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¿¡å·é‡å±æ€§åº•å±‚å·¥å…·ï¼Œä»–è™½ç„¶éå¸¸å¼ºå¤§ï¼Œä½†åœ¨å¤šæ•°éœ€è¦ä½¿ç”¨å®ƒçš„åœºåˆï¼Œæœ€å¥½ä»è®¾è®¡è§’åº¦é‡æ–°è€ƒè™‘ï¼Œçœ‹æ˜¯å¦å¯ä»¥ä¸ç”¨ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¸å¦‚æ“ä½œé˜Ÿåˆ—è¿™æ ·çš„é«˜çº§å·¥å…·ã€‚é€šå¸¸å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªåˆ†æ´¾é˜Ÿåˆ—é…åˆ dispatch_suspend ï¼Œæˆ–è€…é€šè¿‡å…¶å®ƒæ–¹å¼åˆ†è§£æ“ä½œæ¥é¿å…ä½¿ç”¨ä¿¡å·é‡ã€‚ä¿¡å·é‡å¹¶éä¸å¥½ï¼Œåªæ˜¯å®ƒæœ¬èº«æ˜¯é”ï¼Œèƒ½ä¸ä½¿ç”¨å°±ä¸ç”¨ã€‚å°½é‡ç”¨ cocoa æ¡†æ¶ä¸­çš„é«˜çº§æŠ½è±¡ï¼Œä¿¡å·é‡éå¸¸æ¥è¿‘åº•å±‚ã€‚æ‰€ä»¥é™¤äº†ä¸Šé¢çš„ä¾‹å­æ˜¯æœ€ä½³åº”ç”¨åœºæ™¯å¤–ï¼Œä¸æ¨èåº”ç”¨åˆ°é™¤æ­¤ä¹‹å¤–çš„å…¶å®ƒåœºæ™¯ï¼</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://www.cnblogs.com/snailHL/p/3906112.html" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€Šå…³äºdispatch_semaphoreçš„ä½¿ç”¨ã€‹</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¸­æœ‰è¿™æ ·çš„æè¿°ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å…³äºä¿¡å·é‡ï¼Œä¸€èˆ¬å¯ä»¥ç”¨åœè½¦æ¥æ¯”å–»ã€‚</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€åœè½¦åœºå‰©ä½™4ä¸ªè½¦ä½ï¼Œé‚£ä¹ˆå³ä½¿åŒæ—¶æ¥äº†å››è¾†è½¦ä¹Ÿèƒ½åœçš„ä¸‹ã€‚å¦‚æœæ­¤æ—¶æ¥äº†äº”è¾†è½¦ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€è¾†éœ€è¦ç­‰å¾…ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€ä¿¡å·é‡çš„å€¼å°±ç›¸å½“äºå‰©ä½™è½¦ä½çš„æ•°ç›®ï¼Œdispatch_semaphore_waitå‡½æ•°å°±ç›¸å½“äºæ¥äº†ä¸€è¾†è½¦ï¼Œ</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€dispatch_semaphore_signalï¼Œå°±ç›¸å½“äºèµ°äº†ä¸€è¾†è½¦ã€‚åœè½¦ä½çš„å‰©ä½™æ•°ç›®åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å·²ç»æŒ‡æ˜äº†ï¼ˆdispatch_semaphore_createï¼ˆlong valueï¼‰ï¼‰</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€è°ƒç”¨ä¸€æ¬¡dispatch_semaphore_signalï¼Œå‰©ä½™çš„è½¦ä½å°±å¢åŠ ä¸€ä¸ªï¼›è°ƒç”¨ä¸€æ¬¡dispatch_semaphore_waitå‰©ä½™è½¦ä½å°±å‡å°‘ä¸€ä¸ªï¼›</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€å½“å‰©ä½™è½¦ä½ä¸º0æ—¶ï¼Œå†æ¥è½¦ï¼ˆå³è°ƒç”¨dispatch_semaphore_waitï¼‰å°±åªèƒ½ç­‰å¾…ã€‚æœ‰å¯èƒ½åŒæ—¶æœ‰å‡ è¾†è½¦ç­‰å¾…ä¸€ä¸ªåœè½¦ä½ã€‚æœ‰äº›è½¦ä¸»</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€æ²¡æœ‰è€å¿ƒï¼Œç»™è‡ªå·±è®¾å®šäº†ä¸€æ®µç­‰å¾…æ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ç­‰ä¸åˆ°åœè½¦ä½å°±èµ°äº†ï¼Œå¦‚æœç­‰åˆ°äº†å°±å¼€è¿›å»åœè½¦ã€‚è€Œæœ‰äº›è½¦ä¸»å°±åƒæŠŠè½¦åœåœ¨è¿™ï¼Œ</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€€ã€€æ‰€ä»¥å°±ä¸€ç›´ç­‰ä¸‹å»ã€‚</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://m.blog.csdn.net/blog/choudang/38121827" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ã€ŠGCD dispatch_semaphore ä¿¡å·é‡ åè°ƒçº¿ç¨‹åŒæ­¥ã€‹</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¹Ÿæœ‰ç±»ä¼¼çš„æ¯”å–»ï¼š</span></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä»¥ä¸€ä¸ªåœè½¦åœºæ˜¯è¿ä½œä¸ºä¾‹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œå‡è®¾åœè½¦åœºåªæœ‰ä¸‰ä¸ªè½¦ä½ï¼Œä¸€å¼€å§‹ä¸‰ä¸ªè½¦ä½éƒ½æ˜¯ç©ºçš„ã€‚è¿™æ—¶å¦‚æœåŒæ—¶æ¥äº†äº”è¾†è½¦ï¼Œçœ‹é—¨äººå…è®¸å…¶ä¸­ä¸‰è¾†ä¸å—é˜»ç¢çš„è¿›å…¥ï¼Œç„¶åæ”¾ä¸‹è½¦æ‹¦ï¼Œå‰©ä¸‹çš„è½¦åˆ™å¿…é¡»åœ¨å…¥å£ç­‰å¾…ï¼Œæ­¤åæ¥çš„è½¦ä¹Ÿéƒ½ä¸å¾—ä¸åœ¨å…¥å£å¤„ç­‰å¾…ã€‚è¿™æ—¶ï¼Œæœ‰ä¸€è¾†è½¦ç¦»å¼€åœè½¦åœºï¼Œçœ‹é—¨äººå¾—çŸ¥åï¼Œæ‰“å¼€è½¦æ‹¦ï¼Œæ”¾å…¥ä¸€è¾†ï¼Œå¦‚æœåˆç¦»å¼€ä¸¤è¾†ï¼Œåˆ™åˆå¯ä»¥æ”¾å…¥ä¸¤è¾†ï¼Œå¦‚æ­¤å¾€å¤ã€‚</span></div><div>åœ¨è¿™ä¸ªåœè½¦åœºç³»ç»Ÿä¸­ï¼Œè½¦ä½æ˜¯å…¬å…±èµ„æºï¼Œæ¯è¾†è½¦å¥½æ¯”ä¸€ä¸ªçº¿ç¨‹ï¼Œçœ‹é—¨äººèµ·çš„å°±æ˜¯ä¿¡å·é‡çš„ä½œç”¨ã€‚ æ›´è¿›ä¸€æ­¥ï¼Œä¿¡å·é‡çš„ç‰¹æ€§å¦‚ä¸‹ï¼šä¿¡å·é‡æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼ˆè½¦ä½æ•°ï¼‰ï¼Œæ‰€æœ‰é€šè¿‡å®ƒçš„çº¿ç¨‹ï¼ˆè½¦è¾†ï¼‰éƒ½ä¼šå°†è¯¥æ•´æ•°å‡ä¸€ï¼ˆé€šè¿‡å®ƒå½“ç„¶æ˜¯ä¸ºäº†ä½¿ç”¨èµ„æºï¼‰ï¼Œå½“è¯¥æ•´æ•°å€¼ä¸ºé›¶æ—¶ï¼Œæ‰€æœ‰è¯•å›¾é€šè¿‡å®ƒçš„çº¿ç¨‹éƒ½å°†å¤„äºç­‰å¾…çŠ¶æ€ã€‚åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š Waitï¼ˆç­‰å¾…ï¼‰ å’Œ Releaseï¼ˆé‡Šæ”¾ï¼‰ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Waitï¼ˆç­‰å¾…ï¼‰æ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡ç„¶åå°†ä¿¡å·é‡å‡ä¸€ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°ä¿¡å·é‡å¤§äºä¸€æˆ–è¶…æ—¶ã€‚Releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šæ˜¯åœ¨ä¿¡å·é‡ä¸Šæ‰§è¡ŒåŠ æ“ä½œï¼Œå¯¹åº”äºè½¦è¾†ç¦»å¼€åœè½¦åœºï¼Œè¯¥æ“ä½œä¹‹æ‰€ä»¥å«åšâ€œé‡Šæ”¾â€æ˜¯å› ä¸ºåŠ æ“ä½œå®é™…ä¸Šæ˜¯é‡Šæ”¾äº†ç”±ä¿¡å·é‡å®ˆæŠ¤çš„èµ„æºã€‚</div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ä¸ªæ¯”å–»é‡Œå¯ä»¥ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥è¡¨ç¤ºï¼š</span></div><table><thead><tr><td><div>å–»ä½“</div></td><td><div>æœ¬ä½“</div></td><td><div>ä»£ç </div></td></tr></thead><tbody><tr><td><div>è½¦ä½ </div></td><td><div>ä¿¡å·é‡ </div></td><td><div>dispatch_semaphore_t</div></td></tr><tr><td><div>å‰©ä½™å‡ ä¸ªè½¦ä½ </div></td><td><div>æœ€å¤§å¹¶å‘çº¿ç¨‹ </div></td><td><div>dispatch_semaphore_t</div></td></tr><tr><td><div>çœ‹é—¨äººèµ·çš„ä½œç”¨ </div></td><td><div>ä¿¡å·é‡çš„ä½œç”¨ </div></td><td><div>dispatch_semaphore_t</div></td></tr><tr><td><div>è½¦ </div></td><td><div>çº¿ç¨‹ </div></td><td><div>ä»£ç  </div></td></tr><tr><td><div>è€å¿ƒçš„æé™æ—¶é—´ </div></td><td><div>è¶…æ—¶æ—¶é—´ </div></td><td><div>dispatch_semaphore_wait</div></td></tr><tr><td><div>é€›è¡—ç»“æŸèµ°äº†ï¼Œç¦»å¼€è½¦ä½ </div></td><td><div>signal+1 </div></td><td><div>dispatch_semaphore_signal</div></td></tr></tbody></table><h3>ä½¿ç”¨Dispatch Semaphoreæ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ­£å¦‚æ–‡ç« å¼€å¤´æ‰€è¯´ï¼šä» iOS7 å‡åˆ° iOS8 åï¼ŒGCD å‡ºç°äº†ä¸€ä¸ªé‡å¤§çš„å˜åŒ–ï¼šåœ¨ iOS7 æ—¶ï¼Œä½¿ç”¨ GCD çš„å¹¶è¡Œé˜Ÿåˆ—ï¼Œ dispatch_async æœ€å¤§å¼€å¯çš„çº¿ç¨‹ä¸€ç›´èƒ½æ§åˆ¶åœ¨6ã€7æ¡ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯ä¸ªä½æ•°ï¼Œç„¶è€Œ iOS8åï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸€åº¦å¯ä»¥è¾¾åˆ°40æ¡ã€50æ¡ã€‚ç„¶è€Œåœ¨æ–‡æ¡£ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™ä¸€åšæ³•çš„ç›®çš„è¿›è¡Œä»‹ç»ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ç¬”è€…æ¨æµ‹ Apple çš„ç›®çš„æ˜¯æƒ³å€Ÿæ­¤è®©å¼€å‘è€…ä½¿ç”¨ NSOperationQueue ï¼šGCD ä¸­ Apple å¹¶æ²¡æœ‰æä¾›æ§åˆ¶å¹¶å‘æ•°é‡çš„æ¥å£ï¼Œè€Œ NSOperationQueue æœ‰ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ GCD å®ç°ï¼Œéœ€è¦ä½¿ç”¨ GCD çš„ä¸€é¡¹é«˜çº§åŠŸèƒ½ï¼šDispatch Semaphoreä¿¡å·é‡ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¯¦è§ Demo7ï¼ˆDemo_07_å±•ç¤ºdispatch_semaphore_tæ§åˆ¶çº¿ç¨‹å¹¶å‘æ•°é‡çš„ç”¨æ³•ï¼‰</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Demo7ä¸­ä½¿ç”¨äº† </span><a href="http://mp.weixin.qq.com/s?__biz=MzAxNDAzMzk0MQ==&amp;mid=203702345&amp;idx=1&amp;sn=226f6f784d37b89718f6949c9214e1e6&amp;scene=1&amp;srcid=kl2ZmcSfYHuB6bMvYPEq#rd" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ç¯‡åšæ–‡</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¸­çš„ä¾‹å­ã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Dispatch Semaphoreä¿¡å·é‡çš„ä½¿ç”¨åœ¨ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä¸Š Demoï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸»è¦åšçš„å°±æ˜¯å°†ä¸Šæ–‡ä¸­ dispatch_semaphore_t çš„ä¸ªæ•°è®¾ç½®ä¸ºä¸€ä¸ªå¯å˜å‚æ•°ï¼šè¿™æ ·å°±è¾¾åˆ°äº†æ§åˆ¶å¹¶è¡Œçº¿ç¨‹æ•°é‡çš„ç›®çš„ï¼š</span></div><div>/*</div><div> *</div><div> ç®€å•ç‰ˆæœ¬ï¼šæ— ä¸“é—¨æ§åˆ¶å¹¶å‘ç­‰å¾…çš„çº¿ç¨‹ï¼Œç¼ºç‚¹é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯ä»¥è·‘ä¸€ä¸‹ demoï¼Œä½ ä¼šå‘ç°ä¸»å±å¹•ä¸Šçš„æŒ‰é’®æ˜¯ä¸å¯ç‚¹å‡»çš„</div><div> *</div><div> */</div><div>void dispatch_async_limit(dispatch_queue_t queue,NSUInteger limitSemaphoreCount, dispatch_block_t block) {</div><div>Â Â Â  //æ§åˆ¶å¹¶å‘æ•°çš„ä¿¡å·é‡</div><div>Â Â Â  static dispatch_semaphore_t limitSemaphore;</div><div>Â Â Â  //ä¸“é—¨æ§åˆ¶å¹¶å‘ç­‰å¾…çš„çº¿ç¨‹</div><div><br/></div><div><br/></div><div>Â Â Â  //ä½¿ç”¨ dispatch_onceè€Œé lazy æ¨¡å¼ï¼Œé˜²æ­¢å¯èƒ½çš„å¤šçº¿ç¨‹æŠ¢å é—®é¢˜</div><div>Â Â Â  static dispatch_once_t onceToken;</div><div>Â Â Â  dispatch_once(&amp;onceToken, ^{</div><div>Â Â Â Â Â Â Â  limitSemaphore = dispatch_semaphore_create(limitSemaphoreCount);</div><div>Â Â Â  });</div><div><br/></div><div><br/></div><div>Â Â Â Â Â Â Â  //å¯ç”¨ä¿¡å·é‡åæ‰èƒ½ç»§ç»­ï¼Œå¦åˆ™ç­‰å¾…</div><div>Â Â Â Â Â Â Â  dispatch_semaphore_wait(limitSemaphore, DISPATCH_TIME_FOREVER);</div><div>Â Â Â Â Â Â Â  dispatch_async(queue, ^{</div><div>Â Â Â Â Â Â Â Â Â Â Â  !block ? : block();</div><div>Â Â Â Â Â Â Â Â Â Â Â  //åœ¨è¯¥å·¥ä½œçº¿ç¨‹æ‰§è¡Œå®Œæˆåé‡Šæ”¾ä¿¡å·é‡</div><div>Â Â Â Â Â Â Â Â Â Â Â  dispatch_semaphore_signal(limitSemaphore);</div><div>Â Â Â Â Â Â Â  });</div><div><br/></div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä½ å¯èƒ½å‘ç°ï¼Œè¿™æ®µä»£ç æœ‰é—®é¢˜é˜»å¡äº†å½“å‰çº¿ç¨‹ï¼ŒDemo7ä¸­ä¹Ÿç»™å‡ºäº†æ”¹è‰¯ç‰ˆï¼Œå¯ä»¥çœ‹ä¸‹ã€‚</span></div><h3>ä¸º NSURLSession æ·»åŠ åŒæ­¥æ–¹æ³•</h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">NSURLSession å–æ¶ˆäº†åŒæ­¥æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å€ŸåŠ©ä¿¡å·é‡æ¥å®ç°ï¼š</span></div><div>+ (NSData *)sendSynchronousRequest:(NSURLRequest *)request returningResponse:(NSURLResponse *__autoreleasing *)response error:(NSError *__autoreleasing *)error {</div><div>Â Â Â  __block NSData *data = nil;</div><div>Â Â Â  dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</div><div><br/></div><div>Â Â Â  [[[NSURLSession sharedSession] dataTaskWithRequest:request completionHandler:^(NSData *taskData, NSURLResponse *taskResponse, NSError *taskError) {</div><div>Â Â Â Â Â Â Â  data = taskData;</div><div><br/></div><div>Â Â Â Â Â Â Â  if (response)</div><div>Â Â Â Â Â Â Â Â Â Â Â  *response = taskResponse;</div><div><br/></div><div>Â Â Â Â Â Â Â  if (error)</div><div>Â Â Â Â Â Â Â Â Â Â Â  *error = taskError;</div><div><br/></div><div>Â Â Â Â Â Â Â  dispatch_semaphore_signal(semaphore);</div><div>Â Â Â  }] resume];</div><div><br/></div><div>Â Â Â  dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</div><div><br/></div><div>Â Â Â  return data;</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä½†æ˜¯ä¹Ÿè¦æ€è€ƒä¸‹ä¸ºä»€ä¹ˆ Apple å–æ¶ˆäº†åŒæ­¥æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•çš„é£é™©è¿œè¿œè¶…è¿‡å—ç›Šã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¦æ³¨æ„ï¼š</span></div><ul><li>é™¤éä¸‡ä¸å¾—å·²ï¼Œå¦åˆ™æ°¸è¿œä¸è¦å°è¯•åœ¨ä¸»çº¿ç¨‹ä¸Šå‘é€åŒæ­¥çš„ç½‘ç»œè¯·æ±‚</li><li>å°½é‡åªåœ¨åå°çº¿ç¨‹ä¸­ç‹¬å çº¿ç¨‹å‘é€åŒæ­¥çš„ç½‘ç»œè¯·æ±‚</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">é£é™©å¦‚ä¸‹æ‰€ç¤ºï¼š</span></div><h4>å¯¼è‡´Watchdogè¶…æ—¶</h4><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">å…³äºWatchdogè¶…æ—¶ï¼š</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">åœ¨ </span><a href="https://developer.apple.com/library/ios/qa/qa1693/_index.html" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold; font-style: italic;">QA1693ï¼šSynchronous Networking On The Main Thread</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> æ–‡æ¡£ä¸­æè¿°äº†Watchdogæœºåˆ¶ï¼ŒåŒ…æ‹¬ç”Ÿæ•ˆåœºæ™¯å’Œè¡¨ç°ã€‚å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯¹ä¸€äº›ç‰¹å®šçš„UIäº‹ä»¶ï¼ˆæ¯”å¦‚å¯åŠ¨ã€æŒ‚èµ·ã€æ¢å¤ã€ç»“æŸï¼‰å“åº”ä¸åŠæ—¶ï¼ŒWatchdogä¼šæŠŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹²æ‰ï¼Œå¹¶ç”Ÿæˆä¸€ä»½å“åº”çš„crashæŠ¥å‘Šã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">è¿™ä»½crashæŠ¥å‘Šçš„æœ‰è¶£ä¹‹å¤„åœ¨äºå¼‚å¸¸ä»£ç ï¼šâ€œ0x8badf00dâ€ï¼Œå³â€œate bad foodâ€ã€‚ å¦‚æœè¯´ç‰¹å®šçš„UIäº‹ä»¶æ¯”è¾ƒæŠ½è±¡ï¼Œé‚£ä¹ˆç”¨ä»£ç æ¥ç›´æ¥æè¿°çš„è¯ï¼Œå¯¹åº”çš„å°±æ˜¯ï¼ˆåˆ›å»ºä¸€ä¸ªå·¥ç¨‹æ—¶Xcodeè‡ªåŠ¨ç”Ÿæˆçš„ï¼‰UIApplicationDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼š</span></div><div>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {</div><div>Â Â Â  return YES;</div><div>}</div><div><br/></div><div>- (void)applicationWillResignActive:(UIApplication *)application {</div><div>Â Â Â  // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</div><div>Â Â Â  // Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</div><div>}</div><div><br/></div><div>- (void)applicationDidEnterBackground:(UIApplication *)application {</div><div>Â Â Â  // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</div><div>Â Â Â  // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.</div><div>}</div><div><br/></div><div>- (void)applicationWillEnterForeground:(UIApplication *)application {</div><div>Â Â Â  // Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.</div><div>}</div><div><br/></div><div>- (void)applicationDidBecomeActive:(UIApplication *)application {</div><div>Â Â Â  // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</div><div>}</div><div><br/></div><div>- (void)applicationWillTerminate:(UIApplication *)application {</div><div>Â Â Â  // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.</div><div>}</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">æ‰€ä»¥å½“é‡åˆ°Watchdogæ—¥å¿—æ—¶ï¼Œå¯ä»¥æ£€æŸ¥ä¸‹ä¸Šé¢å‡ ä¸ªæ–¹æ³•æ˜¯å¦æœ‰æ¯”è¾ƒé‡çš„é˜»å¡UIçš„åŠ¨ä½œã€‚</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="https://developer.apple.com/library/ios/qa/qa1693/_index.html" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold; font-style: italic;">QA1693ï¼šSynchronous Networking On The Main Thread</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> ä¸¾çš„ä¾‹å­å°±æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡ŒåŒæ­¥ç½‘ç»œè¯·æ±‚ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨å…¬å¸çš„Wifiç¯å¢ƒä¸‹ä½¿ç”¨åˆ™ä¸€åˆ‡é¡ºåˆ©ï¼Œä½†å½“åº”ç”¨ç¨‹åºå‘å¸ƒå‡ºå»é¢å‘å¾ˆå¤§èŒƒå›´çš„ç”¨æˆ·ï¼Œåœ¨å„ç§ç½‘ç»œç¯å¢ƒä¸‹è¿è¡Œï¼Œåˆ™ä¸å¯é¿å…åœ°ä¼šå‡ºç°ä¸€ç‰‡Watchdogè¶…æ—¶æŠ¥å‘Šã€‚ å¦ä¸€ç§å¯èƒ½å‡ºç°é—®é¢˜çš„åœºæ™¯å°±æ˜¯æ•°æ®é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ•°æ®åº“ç‰ˆæœ¬è¿ç§»ï¼ˆåŒæ ·æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼‰ã€‚</span></div><h4>å¤±å»äº† cancel çš„æœºä¼šï¼š</h4><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ä¸èƒ½åƒå¼‚æ­¥é‚£æ ·è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼š</span></div><div>-(IBAction)cancelUpload:(id)sender {</div><div>Â Â Â  if (_uploadTask.state == NSURLSessionTaskStateRunning) {</div><div>Â Â Â Â Â Â Â  [_uploadTask cancel];</div><div>Â Â Â  }</div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">ç¬”è®°æ•´ç†ï¼šEdison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">è”ç³»æ–¹å¼ï¼šQQï¼š277593 ï¼ˆç¬”è®°æ„è§å»ºè®®å¯åŠ æ­¤Qï¼Œä¸“äººæ›´æ–°æ­¤ç¬”è®°ï¼‰ï¼›</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;">Â </span></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">æ³¨ï¼šå°é“é€”å¾„è·å–åˆ°çš„ç¬”è®°ï¼Œæ— æ³•è‡ªåŠ¨æ›´æ–°ï¼Œè¯·è°…è§£ï¼(ç¬”è®°å¹³å‡æ¯æœˆæ›´æ–°ä¸€æ¬¡ï¼Œç¥å„ä½éƒ½èƒ½æ‹¿åˆ°å¿ƒä»ªçš„offer)</span><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;">Â </span></div><div><br/></div></span>
</div></body></html> 