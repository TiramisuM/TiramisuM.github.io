<html>
<head>
  <title>稀土掘金  (十一) : 单元测试-1</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="F7FFBE19-8464-47BD-A012-A877CA846192"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1470"/>
<h1>稀土掘金  (十一) : 单元测试-1</h1>

<div>
<span><div>由于只是一些简单实用的东西，学学还是挺不错的。其实单元测试用的好，开发起来也会快很多。就是为了方便测试一些功能是否正常运行，还有调试接口是否能正常使用。有时候你可能是为了测试某一个网络接口，然后每次都重新启动并且经过很多操作之后才测试到了那个网络接口。如果使用了单元测试，就可以直接测试那个方法，相对方便很多。 比如由于修改较多，我们想测试一下分享功能是否正常，这时候就有用了。（而不是重新启动程序，进入到分享界面，点击分享，填写分享内容。）其实单元测试并没有降低我们打代码的效率，我们可以在单元测试通过了，直接用到相应的地方。</div><div>当然也有一些高级的作用，比如自动发布、自动测试（特别在一些大的项目，以防止程序被误改或引起新的问题）。</div><div>现在，让我们先理清一下单元测试到底有些什么东西？</div><div><a href="http://blog.csdn.net/jymn_chen/article/details/21552941" style="font-weight: bold;">OCUnit</a>（即用XCTest进行测试）其实就是苹果自带的测试框架，我们主要讲的就是这个。<a href="http://blog.csdn.net/jymn_chen/article/details/21562869" style="font-weight: bold;">GHUnit</a>是一个可视化的测试框架。（有了它，你可以点击APP来决定测试哪个方法，并且可以点击查看测试结果等。）<a href="http://blog.csdn.net/jymn_chen/article/details/21562869" style="font-weight: bold;">OCMock</a>就是模拟某个方法或者属性的返回值，你可能会疑惑为什么要这样做?使用用模型生成的模型对象，再传进去不就可以了？答案是可以的，但是有特殊的情况。比如你测试的是方法A，方法A里面调用到了方法B，而且方法B是有参数传入，但又不是方法A所提供。这时候，你可以使用OCMock来模拟方法B返回的值。（在不影响测试的情况下，就可以这样去模拟。）除了这些，在没有网络的情况下，也可以通过OCMock模拟返回的数据。<a href="http://www.cocoachina.com/ios/20150702/12253.html">UITests</a>就是通过代码化来实现自动点击界面，输入文字等功能。靠人工操作的方式来覆盖所有测试用例是非常困难的，尤其是加入新功能以后，旧的功能也要重新测试一遍，这导致了测试需要花非常多的时间来进行回归测试，这里产生了大量重复的工作，而这些重复的工作有些是可以自动完成的，这时候UITests就可以帮助解决这个问题了。</div><h6>最简单的单元测试</h6><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">1.新建项目：</span></div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div><br/></div><div>2.最简单的测试，注意截图路径的问题</div><div>进入到这个类，setUp是每个测试方法调用<span style="font-weight: bold;">前</span>执行，tearDown是每个测试方法调用<span style="font-weight: bold;">后</span>执行。testExample是测试方法，和我们新建的没有差别。不过测试方法必须testXXX的格式，且不能有参数，不然不会识别为测试方法。测试方法的执行顺序是字典序排序。</div><div>按快捷键Command + U进行单元测试，这个快捷键是全部测试。</div><div>testExample方法中输入</div><pre><code>    NSLog<span>(@&quot;自定义测试testExample&quot;)</span>;<br/>    int  a= 3;<br/>    XCTAssertTrue<span>(a == 0,&quot;a 不能等于 0&quot;)</span>;</code></pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">点击播放按钮，开始单个方法的测试：</span></div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">出现如下结果，由于我们断言a是不能等于0的，所以测试没有通过。当然有其它的，用到再看，demo里都有。</span></div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image [2].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><h5>进行网络请求的测试</h5><div>使用CocoaPods安装AFNetworking和STAlertView（<a href="http://code4app.com/article/cocoapods-install-usage">CocoaPods安装和使用教程</a> ）</div><div>Pofile:</div><pre><code>platform :ios, '7.0'<br/>pod 'AFNetworking', '~&gt; 2.5.0'<br/>pod 'STAlertView', '~&gt; 1.0.0'</code></pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这时会发现AFNetworking根本没法在单元测试里使用，因为没有找到库，所以我们需要配置一下：</span></div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image.gif" type="image/gif" data-filename="Image.gif"/><br/></div><div>UITestDemo设置.gif</div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image [1].gif" type="image/gif" data-filename="Image.gif"/><br/></div><div>UITestDemo设置2.gif</div><div><br/></div><div>在Info.plist中添加NSAppTransportSecurity类型Dictionary。 在NSAppTransportSecurity下添加NSAllowsArbitraryLoads类型Boolean,值设为YES。设置位置如下：</div><div><img src="稀土掘金  (十一)  单元测试-1_files/Image [3].jpg" type="image/jpeg" data-filename="Image.jpg" width="291"/><br/></div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">iOS9的http安全问题：现在进行异步请求的网络测试，由于测试方法主线程执行完就会结束，所以需要设置一下，否则没法查看异步返回结果。在方法结束前设置等待，调回回来的时候再让它继续执行。（</span><a href="http://blog.csdn.net/diyagoanyhacker/article/details/8540239" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">另一种异步函数的单元测试</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">）定义宏如下：</span></div><pre><code>waitForExpectationsWithTimeout是等待时间，超过了就不再等待往下执行。<br/>#define WAIT do {\<br/>[self expectationForNotification:@&quot;RSBaseTest&quot; object:nil handler:nil];\<br/>[self waitForExpectationsWithTimeout:30 handler:nil];\<br/>} while (0);<br/><br/>#define NOTIFY \<br/>[[NSNotificationCenter defaultCenter]postNotificationName:@&quot;RSBaseTest&quot; object:nil];</code></pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">增加测试方法testRequest：</span></div><pre><code>-(void)testRequest{<br/>    1.获得请求管理者<br/>    AFHTTPRequestOperationManager *mgr = [AFHTTPRequestOperationManager manager];<br/>    mgr.responseSerializer.acceptableContentTypes = [NSSet setWithObjects:@&quot;text/html&quot;,nil];<br/><br/>    2.发送GET请求<br/>    [mgr GET:@&quot;<a href="http://www.weather.com.cn/adat/sk/101110101.html">http://www.weather.com.cn/adat/sk/101110101.html</a>&quot; parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) {<br/>        NSLog(@&quot;responseObject:%@&quot;,responseObject);<br/>        XCTAssertNotNil(responseObject, @&quot;返回出错&quot;);<br/>        NOTIFY  继续执行<br/>    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {<br/>        NSLog(@&quot;error:%@&quot;,error);<br/>        XCTAssertNil(error, @&quot;请求出错&quot;);<br/>        NOTIFY  继续执行<br/>    }];<br/>    WAIT   暂停<br/>}</code></pre><div>有时候我们想测试一下整个流程是否可以跑通，比如获取验证码、登录、上传头像，查询个人资料。其实只要输入验证码就可以完成整个测试。这时候就需要用到输入框了，以便程序继续执行。使用了一个第三方的弹出输入框STAlertView，前面已经设置。</div><div>STAlertView的使用方法：</div><pre><code>        self.stAlertView = [[STAlertView alloc]initWithTitle:@&quot;验证码&quot; message:nil textFieldHint:@&quot;请输入手机验证码&quot; textFieldValue:nil cancelButtonTitle:@&quot;取消&quot; otherButtonTitle:@&quot;确定&quot; cancelButtonBlock:^{<br/>            点击取消返回后执行<br/>            [self testAlertViewCancel];<br/>            NOTIFY  继续执行<br/>        } otherButtonBlock:^(NSString *b) {<br/>            点击确定后执行<br/>            [self alertViewComfirm:b];<br/>             NOTIFY 继续执行<br/>        }];<br/>        [self.stAlertView show];</code></pre><ul><li>高级自动化单元测试，推荐看LeanCloud 工程师的<a href="http://pan.baidu.com/s/1skt0wNF">李智维的自动化单元测试的直播录影</a></li><li>李智维的演示<a href="https://github.com/lzwjava/LZAlbum">github</a><br/>其实讲得非常不错，自动化单元测试，自动化发布都有讲到，不过由于自己的功力不够，只能留着以后慢慢学习。</li></ul><div><br/></div><div><br/></div><div><br/></div><div style="font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Menlo; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div style="font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Menlo; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: Menlo; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div></span>
</div></body></html> 