<html>
<head>
  <title>设计模式  (四) : MVVM + RAC</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="AEF14849-A3D5-4062-8FEA-B21C7C4F80CA"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1166"/>
<h1>设计模式  (四) : MVVM + RAC</h1>

<div>
<span><div><span style="font-weight: bold;">一、前言</span></div><blockquote><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">对于设计模式这个让人又爱又恨的玩意，说来其实简单，但一千个人眼中就有一千种哈姆雷特，说他千变万化确实是事实，而且当你深入其中的时候你真的会上瘾，并乐此不疲</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">！</span></div></blockquote></blockquote><h2><span style="font-weight: bold;">二、谈谈MVVM和RAC</span></h2><h3><span style="font-weight: bold;">1、MVVM浅析</span></h3><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">到这里我就默认你看过MVVM相关文章（毕竟相关文章已经可以用满天飞来形容了~(≧▽≦)/~啦啦啦！），仅仅简要谈谈我对其的理解。</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">MVC是构建iOS App的标准模式，是苹果推荐的一个用来组织代码的权威范式，市面上大部分App都是这样构建的，具体组建模式不细说，iOS入门者都比较了解（虽然不一定能完全去遵守），但其几个不能避免的问题却是很严重困扰开发者比如</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">厚重的ViewController、遗失的网络逻辑（没有属于它的位置）、较差的可测试性</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">等因此也就会有</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">维护性较强、耦合性很低</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">的一种新架构MVVM (MVC 引申出得新的架构)的流行。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">MVVM虽然来自微软，但是不应该反对它，它正式规范了正式规范了视图和控制器紧耦合的性质，如下图：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div>MVVM图示</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ViewModel: 相比较于MVC新引入的视图模型。是视图显示逻辑、验证逻辑、网络请求等代码存放的地方，唯一要注意的是，任何视图本身的引用都不应该放在VM中，换句话说就是VM中不要引入UIKit.h (对于image这个，也有人将其看做数据来处理，这就看个人想法了，并不影响整体的架构)。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这样，首先解决了VC臃肿的问题，将逻辑代码、网络请求等都写入了VM中，然后又由于VM中包含了所有的展示逻辑而且不会引用V，所以它是可以通过编程充分测试的。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">so，就是这个样子的，6666！</span></div><h3><span style="font-weight: bold;">2、RAC浅浅析</span></h3><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">特别浅。。。本文重点是框架及实战及MVVM思想，RAC这玩意话说学习曲线较长，难以理解，不好上手，是因为之前学习的时候使用者、中文教程还比较少，所以学习运用起来比较费劲，(当时确实废了好大得劲，实力装逼一把 @%&amp;$%&amp; )但现在已经成熟的烂大街了，只要有心，好的教程一大把，能潜下心来看我写的水文的人，拿下RAC不在话下！</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ReactiveCocoa 可以说是结合了函数式编程和响应式编程的框架，也可称其为函数响应式编程（FRP）框架，强调一点，RAC虽然最大的优点是</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">提供了一个单一的、统一的方法去处理异步的行为，包括delegate方法,blocks回调,target-action机制,notifications和KVO.</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">但是不要简单的只是单纯的认为他仅仅就是减少代码复杂度，更好的配合MVVM而已，小伙子，这样你就小看它了。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">它最大的与众不同是提供了一种新的写代码的思维，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">由于RAC将Cocoa中KVO、UIKit event、delegate、selector等都增加了RAC支持，所以都不用去做很多跨函数的事。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">如果全工程都使用RAC来实现，对于同一个业务逻辑终于可以在同一块代码里完成了，将UI事件，逻辑处理，文件或数据库操作，异步网络请求，UI结果显示，这一大套统统用函数式编程的思路嵌套起来，进入页面时搭建好这所有的关系，用户点击后妥妥的等着这一套联系一个个的按期望的逻辑和次序触发，最后显示给用户。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">额，就说这么多，再说就没头了~(≧▽≦)/~啦啦啦!</span></div><h3><span style="font-weight: bold;">3、本篇对两者的理解运用</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">在此次介绍中，会使用MVVM+RAC结合的方式，搞定一个添加上拉加载及下拉刷新的列表，所以更多的诠释MVVM思想，而不是RAC的逻辑链式操作（这一点用登录界面来写更能体现Y^o^Y ），RAC在此扮演的更大一部分的角色是更好的解耦，减少代码复杂度，使代码层次分明、逻辑清晰更便于维护升级。</span></div><h2><span style="font-weight: bold;">二、框架部分</span></h2><h3><span style="font-weight: bold;">1、框架目录详解</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">首先介绍一下本框架的目录结构，如下图</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">1、Frameworks</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">存放系统库的虚拟文件夹, </span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">目前搭建框架的时候需要手动添加一个名称为Frameworks的虚拟文件夹,这样你在Build Phases 中添加的系统库会自动归入此文件夹，不会直接在外部显示以至于打乱目录结构。</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">系统库添加流程如下:</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [2].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">另外,细心地家伙会发现此目录中有两个相同的Frameworks, 那这到底是什么鬼？最上面的那个Frameworks是在自己搭框架自己添加的,当时的项目还很单纯, 没有这么淘气，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">问题出在下面那个Pods Target上，添加它之后就会自动给你生成一个虚拟的Frameworks的文件夹</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，那又该问了为啥不直接用下面那个呢？？？（废话真多！反正也没冲突，就留着吧╮(╯﹏╰）╭）</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">既然提到了Pods，那接下来讲讲CocoaPods(第三方类库管理工具)。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">2、CocoaPods</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">当你开发iOS应用时，会</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">经常使用到很多第三方开源类库，比如JSONKit，AFNetWorking等等。可能某个类库又用到其他类库，所以要使用它，必须得另外下载其他类库，而其他类库又用到其他类库</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，“子子孙孙无穷尽也”，反正在早期我是体会过这种痛苦，好心酸，手动一个个去下载所需类库是十分麻烦的。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">还有另外一种常见情况是，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">你项目中用到的类库有更新，你必须得重新下载新版本，重新加入到项目中</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">，十分麻烦。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">CocoaPods就是帮你解决上面的问题的，话说这玩意应该是iOS最常用最有名的类库管理工具了，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">作为iOS程序员的我们，掌握CocoaPods的使用是必不可少的基本技能</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">了，至于这玩意该咋用？</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">O(∩_∩)O哈哈~你觉得我会告诉你么？好吧，我这人还是很心软的，下面一张图告诉你该咋用...(๑乛◡乛๑ 磨人的小妖精)</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">☝(•̀˓◞•́)哎呦，不错哦~是不是get了一个新技能 ？6666！</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">3、AppDelegate</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这个目录下放的是AppDelegate.h(.m)文件，是整个应用的入口文件，所以单独拿出来。一会儿告诉你如何写一个简洁的AppDelegate，会在这个文件夹里添加一些类，所以将其放入一个文件夹内还是很有必要的。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">4、Class</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">工程主体类, 日常大部分开发代码均在这里,又细分了好多次级目录。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">通用类</span></div><ul><li><span style="font-weight: bold;">General :</span> 通用类（文件夹项目移植过程中都不需要更改的就能直接使用的）</li><ul><li><span style="font-weight: bold;">Base :</span> 基类 （整个框架的基类）</li><li><span style="font-weight: bold;">Categories :</span> 公共扩展类 （就是一些常用的类别，比如分享啊什么的）</li><li><span style="font-weight: bold;">Core :</span> 公共核心类（一般存放个人信息、接口API等）</li><li><span style="font-weight: bold;">Models :</span> 公共Model （公用的一些数据模型）</li><li><span style="font-weight: bold;">Views :</span> 公共View （封装的一些常用的View）</li></ul></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">工具类</span></div><ul><li><span style="font-weight: bold;">Helpers :</span> 工程的相关辅助类（比如类似数据请求、表单上传、网络监测等工具类）</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">宏定义类</span></div><ul><li><span style="font-weight: bold;">Macro :</span> 宏定义类 （就是整个应用会用到的宏定义）</li><ul><li><span style="font-weight: bold;">AppMacro.h</span> app项目的相关宏定义</li><li><span style="font-weight: bold;">NotificationMacro.h</span> 通知相关的宏定义</li><li><span style="font-weight: bold;">VendorMacro.h</span> 第三方相关宏定义</li><li><span style="font-weight: bold;">UtilsMacro.h</span> 为简化代码的宏定义</li><li>...等等等等（其他随你定啦！Y^o^Y ）</li></ul></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">APP具体模块代码类</span></div><ul><li><span style="font-weight: bold;">Sections :</span> 各模块的文件夹（一般而言，我们以人为单位）</li><ul><li><span style="font-weight: bold;">LSSections</span> </li><li><span style="font-weight: bold;">CLSections</span> </li><li>...等等等等（也可以写你最喜欢的苍老师的，叼叼的！）</li></ul></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">每个成员的文件夹下是其所负责模块的文件夹，比如苍老师负责PHP界面模块（我也认为PHP是最好的语言！大家可以在评论区谈论一下！๑乛◡乛๑ 磨人的小妖精），如下（接着上面的个人文件夹）:</span></div><ul><li><span style="font-weight: bold;">PHP :</span> 模块名，也可以是首页（HomePage）...等等</li><ul><li><span style="font-weight: bold;">ViewControllers</span> 界面控制器存放处（这是文件夹名）</li><li><span style="font-weight: bold;">ViewModels</span> 打杂的（MVVM的核心、解耦合、处理逻辑等）</li><li><span style="font-weight: bold;">Views</span> 界面相关View存放处(界面相关子View)</li><li><span style="font-weight: bold;">Models</span> 数据模型存放处（各种单纯的数据模型，一点都不胖，是标准的瘦Model）</li></ul></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这就是标准的MVVM了。。。为啥不和上面目录连起来呢？为啥呢？为啥呢？因为臣妾做不到啊！！！（不会三级、四级列表的MarkDown写法，求大神支招！良辰必有重谢！）</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">第三方类库</span></div><ul><li><span style="font-weight: bold;">Vendors :</span> 第三方的类库/SDK，如UMeng、WeiboSDK、WeixinSDK等等。</li></ul><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">到这哥们又该疑惑了，心里该碎碎念了：(๑⁼̴̀д⁼̴́๑)ﾄﾞﾔｯ‼ What are you 弄啥嘞！刚才刚讲了个第三方库管理CocoaPods，你丫这里自己又搞了一个，ԅ( ¯་། ¯ԅ) 信不信我突突了你！</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">哈哈哈，刚才的CocoaPods确实管理着大部分的第三方库，这里建立第三方库目录的原因有两个：</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">其一，并不是所有的你需要的第三方都支持pods的，所以还是需要手动添加一些类库。其二，一些第三方库虽然支持pods，但是需要我们去更改甚至自定义这个第三方，此时也需要放入这里，也防止使用pods一不小心更新掉你的自定义！</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ᕕ(ᐛ)ᕗ 你来打我啊！</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">5、Resource</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这里放置的是工程所需的一些资源，如下</span></div><ul><li><span style="font-weight: bold;">Fonts</span> 字体</li><li><span style="font-weight: bold;">Images</span> 图片（当然你可以添加至Assets.xcassets, 没人拦着你）</li><li><span style="font-weight: bold;">Sounds</span> 声音</li><li><span style="font-weight: bold;">Videos</span> 视频</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ok，目录就讲到这里！想知道更详细的可以私信我！</span></div><h3><span style="font-weight: bold;">2、基类详解</span></h3><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这里着重讲解一下VC、V、VM的基类，其他的模式与View类似所以略过，其中TableViewCell的基类稍微特殊所以也提一下。</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">我目前的基类如下图：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [3].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">是不是眼花缭乱了..., 我曾经也看它不顺眼, 曾经尝试过把基类都干掉，然后遇到了一些麻烦...就妥协了，在文章的最后可以跟大家聊聊我是怎么去干掉基类，然后又失败的，这里先详细讲一下基类。</span></div></blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">1、YDViewController</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><div><img src="设计模式  (四)  MVVM + RAC_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [4].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">函数的具体用意图已经标的很清楚了，这里简单讲一下四个函数的作用</span></div><ul><li><span style="font-weight: bold;">yd_addSubviews :</span> 添加View到ViewController</li><li><span style="font-weight: bold;">yd_bindViewModel :</span> 用来绑定V(VC)与VM</li><li><span style="font-weight: bold;">yd_layoutNavigation :</span> 设置导航栏、分栏</li><li><span style="font-weight: bold;">yd_getNewData :</span> 初次获取数据的时候调用（不是特别必要）</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">2、YDView</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><ul><li><span style="font-weight: bold;">yd_setupViews :</span> 添加子View到主View</li><li><span style="font-weight: bold;">yd_bindViewModel :</span> 绑定V与VM</li><li><span style="font-weight: bold;">yd_addReturnKeyBoard :</span> 设置点击空白键盘回收</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">3、YDViewModel</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><div><img src="设计模式  (四)  MVVM + RAC_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div></div><ul><li><span style="font-weight: bold;">yc_initialize :</span> 进行一些逻辑绑定，网络数据请求处理。</li><li><span style="font-weight: bold;">LSRefreshDataStatus</span> 数据处理后需要进行的操作标识</li><ul><li><span style="font-weight: bold;">LSHeaderRefresh_HasMoreData</span> 下拉还有更多数据</li><li><span style="font-weight: bold;">LSHeaderRefresh_HasNoMoreData</span> 下拉没有更多数据</li><li><span style="font-weight: bold;">LSFooterRefresh_HasMoreData</span> 上拉还有更多数据</li><li><span style="font-weight: bold;">LSFooterRefresh_HasNoMoreData</span> 上拉没有更多数据</li><li><span style="font-weight: bold;">LSRefreshError</span> 刷新出错</li><li><span style="font-weight: bold;">LSRefreshUI</span> 仅仅刷新UI布局</li></ul></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">4、YDTableViewCell</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">由于Cell比较特殊，所以单拎出来说一下。观察上面的ViewMdoel、View等的基类会发现每个基类都会有数据绑定的地方，但是cell得数据绑定需要放在数据初始化的时候，因为所有的基类的数据逻辑绑定都是在没有返回初始化对象的时候调用的，但是cell中假如在那里面进行数据绑定会出现问题比如下图：</span></div></blockquote><div><img src="设计模式  (四)  MVVM + RAC_files/Image [5].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div>cell复用失败</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">上图中的函数假如是在 bindViewModel 内，则会复用失败，点击按钮是没有反应的，但是假如是在数据初始化的时候调用：比如 setViewModel 的时候，就会OK了，因为里面用到了</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">cell的在RAC中复用机制 </span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">rac_prepareForReuseSignal</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;"> ，在cell还没有初始化返回的时候是失效的。</span></div><h3><span style="font-weight: bold;">3、题外话</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">基类的作用是统一管理，统一风格，便于编码，有更多的额外的附加功能的话，建议使用Protocol 或 Category，这样移植性强，便于管理与扩展，不至于牵一发而动全身。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">本篇基类核心是用VM来配置V（VC），并提供一些必须的Protocol方法来处理界面显示、逻辑，将代码风格规范化，各个部分的功能明朗化，这样，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">当你需要写什么，需要找什么，需要更改什么的时候都会很明确这些代码的位置，逻辑更清晰，而不会浪费更多的时间在思考应该写在哪，该去哪找，要改的地方在哪这种不该费时间的问题上。</span></div><h2><span style="font-weight: bold;">三、实战部分（经典列表的实现）</span></h2><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这里讲一下如下界面的代码构造方式，很普通的一个列表：(懒得再写了，这是我之前做的一个项目的一个界面，之前基类讲解中会看到都是YD开头的，在这里是YC开头就这个区别而已)</span></div></blockquote><div><img src="设计模式  (四)  MVVM + RAC_files/Image [6].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">首先观察这个界面，需求是：头部的内容数量多的话是可以左右滑动的，然后整体是可以上拉加载的。我是这样处理的：</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">首先界面整体是一个TableView，然后分为一个Header、一个Section和主体列表Row。在Header上嵌套一个CollectionView保证可复用。</span><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">具体分层如下</span></div></blockquote><div><img src="设计模式  (四)  MVVM + RAC_files/Image [7].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">然后处理完后的目录如下：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [8].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">简单介绍一下：</span></div><ul><li><span style="font-weight: bold;">ViewController</span></li><ul><li><span style="font-weight: bold;">LSCircleListViewController :</span> 界面主控制器，负责跳转、Navgation、TabBar等</li></ul><li><span style="font-weight: bold;">View</span></li><ul><li><span style="font-weight: bold;">LSCircleListView :</span> 界面主View，负责主要界面的显示</li><li><span style="font-weight: bold;">LSCircleListHeaderView :</span> 头部Header，封装的内部含有一个CollectionView</li><li><span style="font-weight: bold;">LSCircleListCollectionCell :</span> 头部Header中的CollectionView自定义的Cell</li><li><span style="font-weight: bold;">LSCircleListSectionHeaderView :</span> SectionView，此界面不需复用，所以单纯一个View即可，若需要复用需要TableViewHeaderFooterView</li><li><span style="font-weight: bold;">LSCircleListTableCell :</span> 主TableView的Cell</li></ul><li><span style="font-weight: bold;">ViewModel</span></li><ul><li><span style="font-weight: bold;">LSCircleListViewModel :</span> 界面主ViewModel</li><li><span style="font-weight: bold;">LSCircleListHeaderViewModel :</span> 头部Header对应的ViewModel</li><li><span style="font-weight: bold;">LSCircleListCollectionCellViewModel :</span> 头部CollectionCell及TableViewCell的ViewModel（因为二者的数据结构是一致的）</li><li><span style="font-weight: bold;">LSCircleListSectionHeaderViewModel :</span> Section的ViewModel</li></ul><li><span style="font-weight: bold;">Model</span></li><ul><li><span style="font-weight: bold;">LSCircleListModel :</span> 圈子的数据模型（header和tableViewCell数据结构是一致的）</li></ul></ul><blockquote><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">一个小小的界面这么多类...是不是难以接受了，淡定些，骚年！你要想想把这些个东西都放在VC内是个什么赶脚？也得好几千行呢！（有点夸张！不过也够头疼的），这么多类，这里着重讲一下主VC、主V、主VM、主M就ok，能详细讲明白MVVM之间是如何工作的就一通百通了。</span></div></blockquote><h3><span style="font-weight: bold;">1、LSCircleListViewController的处理</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">先上代码：</span></div><div>#import &quot;LSCircleListViewController.h&quot;</div><div>#import &quot;LSCircleListView.h&quot;</div><div>#import &quot;LSCircleListViewModel.h&quot;</div><div>#import &quot;LSCircleMainPageViewController.h&quot;</div><div>#import &quot;LSCircleMainPageViewModel.h&quot;</div><div>#import &quot;LSCircleListCollectionCellViewModel.h&quot;</div><div>#import &quot;LSNewCircleListViewController.h&quot;</div><div><br/></div><div>@interface LSCircleListViewController ()</div><div><br/></div><div>@property (nonatomic, strong) LSCircleListView *mainView;</div><div><br/></div><div>@property (nonatomic, strong) LSCircleListViewModel *viewModel;</div><div><br/></div><div>@end</div><div><br/></div><div>@implementation LSCircleListViewController</div><div><br/></div><div>- (void)viewDidLoad {</div><div>    [super viewDidLoad];</div><div>    // Do any additional setup after loading the view.</div><div>}</div><div><br/></div><div>#pragma mark - system</div><div>- (void)updateViewConstraints {</div><div><br/></div><div>    WS(weakSelf)</div><div><br/></div><div>    [self.mainView mas_makeConstraints:^(MASConstraintMaker *make) {</div><div><br/></div><div>        make.edges.equalTo(weakSelf.view);</div><div>    }];</div><div><br/></div><div>    [super updateViewConstraints];</div><div>}</div><div><br/></div><div>#pragma mark - private</div><div>- (void)yc_addSubviews {</div><div><br/></div><div>    [self.view addSubview:self.mainView];</div><div>}</div><div><br/></div><div>- (void)yc_bindViewModel {</div><div><br/></div><div>    @weakify(self);</div><div>    [[self.viewModel.cellClickSubject takeUntil:self.rac_willDeallocSignal] subscribeNext:^(LSCircleListCollectionCellViewModel *viewModel) {</div><div><br/></div><div>        @strongify(self);</div><div><br/></div><div>        LSCircleMainPageViewModel *mainViewModel = [[LSCircleMainPageViewModel alloc] init];</div><div>        mainViewModel.headerViewModel.circleId = viewModel.idStr;</div><div>        mainViewModel.headerViewModel.headerImageStr = viewModel.headerImageStr;</div><div>        mainViewModel.headerViewModel.title = viewModel.name;</div><div>        mainViewModel.headerViewModel.numStr = viewModel.peopleNum;</div><div><br/></div><div>        LSCircleMainPageViewController *circleMainVC = [[LSCircleMainPageViewController alloc] initWithViewModel:mainViewModel];</div><div>        [self.rdv_tabBarController setTabBarHidden:YES animated:YES];</div><div>        [self.navigationController pushViewController:circleMainVC animated:YES];</div><div>    }];</div><div><br/></div><div>    [self.viewModel.listHeaderViewModel.addNewSubject subscribeNext:^(id x) {</div><div><br/></div><div>        @strongify(self);</div><div>        LSNewCircleListViewController *newCircleListVC = [[LSNewCircleListViewController alloc] init];</div><div>        [self.rdv_tabBarController setTabBarHidden:YES animated:YES];</div><div>        [self.navigationController pushViewController:newCircleListVC animated:YES];</div><div>    }];</div><div>}</div><div><br/></div><div>- (void)yc_layoutNavigation {</div><div><br/></div><div>    self.title = @&quot;圈子列表&quot;;</div><div>    [self.rdv_tabBarController setTabBarHidden:NO animated:YES];</div><div>}</div><div><br/></div><div>#pragma mark - layzLoad</div><div>- (LSCircleListView *)mainView {</div><div><br/></div><div>    if (!_mainView) {</div><div><br/></div><div>        _mainView = [[LSCircleListView alloc] initWithViewModel:self.viewModel];</div><div>    }</div><div><br/></div><div>    return _mainView;</div><div>}</div><div><br/></div><div>- (LSCircleListViewModel *)viewModel {</div><div><br/></div><div>    if (!_viewModel) {</div><div><br/></div><div>        _viewModel = [[LSCircleListViewModel alloc] init];</div><div>    }</div><div><br/></div><div>    return _viewModel;</div><div>}</div><div><br/></div><div>- (void)didReceiveMemoryWarning {</div><div>    [super didReceiveMemoryWarning];</div><div>    // Dispose of any resources that can be recreated.</div><div>}</div><div><br/></div><div>/*</div><div>#pragma mark - Navigation</div><div><br/></div><div>// In a storyboard-based application, you will often want to do a little preparation before navigation</div><div>- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {</div><div>    // Get the new view controller using [segue destinationViewController].</div><div>    // Pass the selected object to the new view controller.</div><div>}</div><div>*/</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">对于VC，分为三个模块，下面分别来说一下：</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">i 第一个模块：系统函数</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [9].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">此函数是从iOS6.0开始在ViewController中新增一个更新约束布局的方法，这个方法默认的实现是调用对应View的 updateConstraints 。ViewController的View在更新视图布局时，会先调用ViewController的updateViewConstraints 方法</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">。我们可以通过重写这个方法去更新当前View的内部布局，而不用再继承这个View去重写-updateConstraints方法。我们在重写这个方法时，务必要调用 super 或者 调用当前View的 -updateConstraints 方法。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅱ 第二个模块 : 私有函数</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [10].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">前面基类内也提到了这三个函数的具体作用，即</span></div><ul><li><span style="font-weight: bold;">yd_addSubviews :</span> 添加View到ViewController</li><li><span style="font-weight: bold;">yd_bindViewModel :</span> 这里绑定了两个跳转事件。</li><li><span style="font-weight: bold;">yd_layoutNavigation :</span> 设置了标题为“圈子列表”、及TabBar不隐藏</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅲ 第三个模块 : 懒加载</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [11].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这就不用解释了，用到时再加载。</span></div><h3><span style="font-weight: bold;">2、View的处理</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">先上代码</span></div><div>#import &quot;LSCircleListView.h&quot;</div><div>#import &quot;LSCircleListViewModel.h&quot;</div><div>#import &quot;LSCircleListHeaderView.h&quot;</div><div>#import &quot;LSCircleListSectionHeaderView.h&quot;</div><div>#import &quot;LSCircleListTableCell.h&quot;</div><div><br/></div><div>@interface LSCircleListView () &lt;UITableViewDataSource, UITableViewDelegate&gt;</div><div><br/></div><div>@property (strong, nonatomic) LSCircleListViewModel *viewModel;</div><div><br/></div><div>@property (strong, nonatomic) UITableView *mainTableView;</div><div><br/></div><div>@property (strong, nonatomic) LSCircleListHeaderView *listHeaderView;</div><div><br/></div><div>@property (strong, nonatomic) LSCircleListSectionHeaderView *sectionHeaderView;</div><div><br/></div><div>@end</div><div>@implementation LSCircleListView</div><div><br/></div><div><br/></div><div>/*</div><div> // Only override drawRect: if you perform custom drawing.</div><div> // An empty implementation adversely affects performance during animation.</div><div> - (void)drawRect:(CGRect)rect {</div><div> // Drawing code</div><div> }</div><div> */</div><div><br/></div><div>#pragma mark - system</div><div><br/></div><div>- (instancetype)initWithViewModel:(id&lt;YCViewModelProtocol&gt;)viewModel {</div><div><br/></div><div>    self.viewModel = (LSCircleListViewModel *)viewModel;</div><div>    return [super initWithViewModel:viewModel];</div><div>}</div><div><br/></div><div>- (void)updateConstraints {</div><div><br/></div><div>    WS(weakSelf)</div><div>    [self.mainTableView mas_makeConstraints:^(MASConstraintMaker *make) {</div><div><br/></div><div>        make.edges.equalTo(weakSelf);</div><div>    }];</div><div>    [super updateConstraints];</div><div>}</div><div><br/></div><div>#pragma mark - private</div><div>- (void)yc_setupViews {</div><div><br/></div><div>    [self addSubview:self.mainTableView];</div><div>    [self setNeedsUpdateConstraints];</div><div>    [self updateConstraintsIfNeeded];</div><div>}</div><div><br/></div><div>- (void)yc_bindViewModel {</div><div><br/></div><div>    [self.viewModel.refreshDataCommand execute:nil];</div><div><br/></div><div>    @weakify(self);</div><div><br/></div><div>    [self.viewModel.refreshUI subscribeNext:^(id x) {</div><div><br/></div><div>        @strongify(self);</div><div>        [self.mainTableView reloadData];</div><div>    }];</div><div><br/></div><div>    [self.viewModel.refreshEndSubject subscribeNext:^(id x) {</div><div>        @strongify(self);</div><div><br/></div><div>        [self.mainTableView reloadData];</div><div><br/></div><div>        switch ([x integerValue]) {</div><div>            case LSHeaderRefresh_HasMoreData: {</div><div><br/></div><div>                [self.mainTableView.mj_header endRefreshing];</div><div><br/></div><div>                if (self.mainTableView.mj_footer == nil) {</div><div><br/></div><div>                    self.mainTableView.mj_footer = [MJRefreshBackNormalFooter footerWithRefreshingBlock:^{</div><div>                        @strongify(self);</div><div>                        [self.viewModel.nextPageCommand execute:nil];</div><div>                    }];</div><div>                }</div><div>            }</div><div>                break;</div><div>            case LSHeaderRefresh_HasNoMoreData: {</div><div><br/></div><div>                [self.mainTableView.mj_header endRefreshing];</div><div>                self.mainTableView.mj_footer = nil;</div><div>            }</div><div>                break;</div><div>            case LSFooterRefresh_HasMoreData: {</div><div><br/></div><div>                [self.mainTableView.mj_header endRefreshing];</div><div>                [self.mainTableView.mj_footer resetNoMoreData];</div><div>                [self.mainTableView.mj_footer endRefreshing];</div><div>            }</div><div>                break;</div><div>            case LSFooterRefresh_HasNoMoreData: {</div><div>                [self.mainTableView.mj_header endRefreshing];</div><div>                [self.mainTableView.mj_footer endRefreshingWithNoMoreData];</div><div>            }</div><div>                break;</div><div>            case LSRefreshError: {</div><div><br/></div><div>                [self.mainTableView.mj_footer endRefreshing];</div><div>                [self.mainTableView.mj_header endRefreshing];</div><div>            }</div><div>                break;</div><div><br/></div><div>            default:</div><div>                break;</div><div>        }</div><div>    }];</div><div>}</div><div><br/></div><div>#pragma mark - lazyLoad</div><div>- (LSCircleListViewModel *)viewModel {</div><div><br/></div><div>    if (!_viewModel) {</div><div><br/></div><div>        _viewModel = [[LSCircleListViewModel alloc] init];</div><div>    }</div><div><br/></div><div>    return _viewModel;</div><div>}</div><div><br/></div><div>- (UITableView *)mainTableView {</div><div><br/></div><div>    if (!_mainTableView) {</div><div><br/></div><div>        _mainTableView = [[UITableView alloc] init];</div><div>        _mainTableView.delegate = self;</div><div>        _mainTableView.dataSource = self;</div><div>        _mainTableView.backgroundColor = GX_BGCOLOR;</div><div>        _mainTableView.separatorStyle = UITableViewCellSeparatorStyleNone;</div><div>        _mainTableView.tableHeaderView = self.listHeaderView;</div><div>        [_mainTableView registerClass:[LSCircleListTableCell class] forCellReuseIdentifier:[NSString stringWithUTF8String:object_getClassName([LSCircleListTableCell class])]];</div><div><br/></div><div>        WS(weakSelf)</div><div>        _mainTableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{</div><div><br/></div><div>            [weakSelf.viewModel.refreshDataCommand execute:nil];</div><div>        }];</div><div>        _mainTableView.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingBlock:^{</div><div><br/></div><div>            [weakSelf.viewModel.nextPageCommand execute:nil];</div><div>        }];</div><div>    }</div><div><br/></div><div>    return _mainTableView;</div><div>}</div><div><br/></div><div>- (LSCircleListHeaderView *)listHeaderView {</div><div><br/></div><div>    if (!_listHeaderView) {</div><div><br/></div><div>        _listHeaderView = [[LSCircleListHeaderView alloc] initWithViewModel:self.viewModel.listHeaderViewModel];</div><div>        _listHeaderView.frame = CGRectMake(0, 0, SCREEN_WIDTH, 160);</div><div>    }</div><div><br/></div><div>    return _listHeaderView;</div><div>}</div><div><br/></div><div>- (LSCircleListSectionHeaderView *)sectionHeaderView {</div><div><br/></div><div>    if (!_sectionHeaderView) {</div><div><br/></div><div>        _sectionHeaderView = [[LSCircleListSectionHeaderView alloc] initWithViewModel:self.viewModel.sectionHeaderViewModel];</div><div>    }</div><div><br/></div><div>    return _sectionHeaderView;</div><div>}</div><div><br/></div><div>#pragma mark - delegate</div><div><br/></div><div>#pragma mark - UITableViewDataSource</div><div>- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {</div><div><br/></div><div>    return 1;</div><div>}</div><div><br/></div><div>- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {</div><div><br/></div><div>    return self.viewModel.dataArray.count;</div><div>}</div><div><br/></div><div>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {</div><div><br/></div><div><br/></div><div>    LSCircleListTableCell *cell = [tableView dequeueReusableCellWithIdentifier:[NSString stringWithUTF8String:object_getClassName([LSCircleListTableCell class])] forIndexPath:indexPath];</div><div><br/></div><div>    if (self.viewModel.dataArray.count &gt; indexPath.row) {</div><div><br/></div><div>        cell.viewModel = self.viewModel.dataArray[indexPath.row];</div><div>    }</div><div><br/></div><div>    return cell;</div><div>}</div><div><br/></div><div>#pragma mark - UITableViewDelegate</div><div><br/></div><div>- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {</div><div><br/></div><div>    return 100;</div><div>}</div><div><br/></div><div>- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {</div><div><br/></div><div>    if (self.viewModel.dataArray.count &gt; indexPath.row) {</div><div><br/></div><div>        [self.viewModel.cellClickSubject sendNext:self.viewModel.dataArray[indexPath.row]];</div><div>    }</div><div>}</div><div><br/></div><div>- (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section {</div><div><br/></div><div>    return self.sectionHeaderView;</div><div>}</div><div><br/></div><div>- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section {</div><div><br/></div><div>    return 45;</div><div>}</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">主View分为四个模块：</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅰ 第一个模块 : 系统函数</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [12].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">每个View都会有对应的ViewModel，这样也更易复用，这里因为是主View，一般而言我都会使得VC和主V共用一个VM，这样对于跳转、数据共享等都有着极大的好处。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅱ 第二个模块 : 私有函数</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [13].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [14].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">具体作用途中已经标注，需要注意的是这些对于不同数据的处理，是我自己写的，逻辑上肯定没有那么缜密，仅供参考。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅲ 第三个模块 : 懒加载</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [15].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这里没啥好说的，就是用的MJRefresh这个第三方库做的刷新。不过，假如你细心的话肯定会发现下面那两个View都是用VM来配置初始化的，这个和主View的配置初始化的意义是一样的。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ⅳ 第四个模块 : 代理及数据源</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [16].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">其中使用的是自定义Cell，用ViewModel来配置，点击事件也是和之前的VC的跳转联系起来了，并将VM传过去。</span></div><h3><span style="font-weight: bold;">3、LSCircleListModel的处理</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">同样，先上代码</span></div><div>#import &lt;Foundation/Foundation.h&gt;</div><div><br/></div><div>@interface LSCircleListModel : NSObject</div><div><br/></div><div>@property (nonatomic, copy) NSString *idStr;</div><div><br/></div><div>@property (nonatomic, copy) NSString *title;</div><div><br/></div><div>@property (nonatomic, copy) NSString *intro;</div><div><br/></div><div>@property (nonatomic, copy) NSString *img;</div><div><br/></div><div>@property (nonatomic, copy) NSString *memberCount;</div><div><br/></div><div>@property (nonatomic, copy) NSString *topicCount;</div><div><br/></div><div>@end</div><div><br/></div><div>#import &quot;LSCircleListModel.h&quot;</div><div><br/></div><div>@implementation LSCircleListModel</div><div><br/></div><div>+ (NSDictionary *)mj_replacedKeyFromPropertyName {</div><div><br/></div><div>    return  @{</div><div>              @&quot;idStr&quot;:@&quot;id&quot;,</div><div>              @&quot;title&quot;:@&quot;title&quot;,</div><div>              @&quot;intro&quot;:@&quot;intro&quot;,</div><div>              @&quot;img&quot;:@&quot;img&quot;,</div><div>              @&quot;memberCount&quot;:@&quot;MemberCount&quot;,</div><div>              @&quot;topicCount&quot;:@&quot;TopicCount&quot;,</div><div>              };</div><div>}</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这个就不贴图介绍了，就是单纯的数据模型，使用了MJExtention这个数据模型转换框架。没有做任何其他的逻辑处理。</span></div><h3><span style="font-weight: bold;">4、ViewModel的处理</span></h3><div>#import &quot;YCViewModel.h&quot;</div><div>#import &quot;LSCircleListHeaderViewModel.h&quot;</div><div>#import &quot;LSCircleListSectionHeaderViewModel.h&quot;</div><div><br/></div><div>@interface LSCircleListViewModel : YCViewModel</div><div><br/></div><div>@property (nonatomic, strong) RACSubject *refreshEndSubject;</div><div><br/></div><div>@property (nonatomic, strong) RACSubject *refreshUI;</div><div><br/></div><div>@property (nonatomic, strong) RACCommand *refreshDataCommand;</div><div><br/></div><div>@property (nonatomic, strong) RACCommand *nextPageCommand;</div><div><br/></div><div>@property (nonatomic, strong) LSCircleListHeaderViewModel *listHeaderViewModel;</div><div><br/></div><div>@property (nonatomic, strong) LSCircleListSectionHeaderViewModel *sectionHeaderViewModel;</div><div><br/></div><div>@property (nonatomic, strong) NSArray *dataArray;</div><div><br/></div><div>@property (nonatomic, strong) RACSubject *cellClickSubject;</div><div><br/></div><div>@end</div><div>#import &quot;LSCircleListViewModel.h&quot;</div><div>#import &quot;LSCircleListCollectionCellViewModel.h&quot;</div><div>#import &quot;LSCircleListModel.h&quot;</div><div><br/></div><div>@interface LSCircleListViewModel ()</div><div><br/></div><div>@property (nonatomic, assign) NSInteger currentPage;</div><div><br/></div><div>@end</div><div><br/></div><div>@implementation LSCircleListViewModel</div><div><br/></div><div>- (void)yc_initialize {</div><div><br/></div><div>    @weakify(self);</div><div>    [self.refreshDataCommand.executionSignals.switchToLatest subscribeNext:^(NSDictionary *dict) {</div><div><br/></div><div>        @strongify(self);</div><div><br/></div><div>        if (dict == nil) {</div><div><br/></div><div>            [self.refreshEndSubject sendNext:@(LSRefreshError)];</div><div>            ShowErrorStatus(@&quot;网络连接失败&quot;);</div><div>            return;</div><div>        }</div><div><br/></div><div>        if ([dict[@&quot;status&quot;] integerValue] == 0) {</div><div><br/></div><div>            self.listHeaderViewModel.dataArray = [[[([(NSDictionary *)dict[@&quot;res&quot;] arrayForKey:@&quot;JoinCircles&quot;]).rac_sequence map:^id(NSDictionary *dic) {</div><div><br/></div><div>                LSCircleListModel *model = [LSCircleListModel mj_objectWithKeyValues:dic];</div><div>                LSCircleListCollectionCellViewModel *viewModel = [[LSCircleListCollectionCellViewModel alloc] init];</div><div>                viewModel.model = model;</div><div>                return viewModel;</div><div>            }] array] mutableCopy];</div><div><br/></div><div>            self.dataArray = [[[([(NSDictionary *)dict[@&quot;res&quot;] arrayForKey:@&quot;Circles&quot;]).rac_sequence map:^id(NSDictionary *dic) {</div><div><br/></div><div>                LSCircleListModel *model = [LSCircleListModel mj_objectWithKeyValues:dic];</div><div>                LSCircleListCollectionCellViewModel *viewModel = [[LSCircleListCollectionCellViewModel alloc] init];</div><div>                viewModel.model = model;</div><div>                return viewModel;</div><div>            }] array] mutableCopy];</div><div><br/></div><div><br/></div><div>            [self ls_setHeaderRefreshWithArray:dict[@&quot;Circles&quot;]];</div><div>            [self ls_dismiss];</div><div><br/></div><div>        } else {</div><div><br/></div><div>            [self.refreshEndSubject sendNext:@(LSRefreshError)];</div><div>            ShowMessage(dict[@&quot;mes&quot;]);</div><div>        }        </div><div>    }];</div><div><br/></div><div><br/></div><div>    [[[self.refreshDataCommand.executing skip:1] take:1] subscribeNext:^(id x) {</div><div><br/></div><div>        @strongify(self);</div><div>        if ([x isEqualToNumber:@(YES)]) {</div><div><br/></div><div>            [self ls_showWithStatus:@&quot;正在加载&quot;];</div><div>        }</div><div>    }];</div><div><br/></div><div>    [self.nextPageCommand.executionSignals.switchToLatest subscribeNext:^(NSDictionary *dict) {</div><div><br/></div><div>        @strongify(self);</div><div><br/></div><div>        if (dict == nil) {</div><div><br/></div><div>            [self.refreshEndSubject sendNext:@(LSRefreshError)];</div><div>            ShowErrorStatus(@&quot;网络连接失败&quot;);</div><div>            return;</div><div>        }</div><div><br/></div><div>        if ([dict[@&quot;status&quot;] integerValue] == 0) {</div><div><br/></div><div>            NSMutableArray *recommandArray = [[NSMutableArray alloc] initWithArray:self.dataArray];</div><div>            for (NSDictionary *subDic in [(NSDictionary *)dict[@&quot;res&quot;] arrayForKey:@&quot;Circles&quot;]) {</div><div><br/></div><div>                LSCircleListModel *model = [LSCircleListModel mj_objectWithKeyValues:subDic];</div><div>                LSCircleListCollectionCellViewModel *viewModel = [[LSCircleListCollectionCellViewModel alloc] init];</div><div>                viewModel.model = model;</div><div>                [recommandArray addObject:viewModel];</div><div>            }</div><div>            self.dataArray = recommandArray;</div><div><br/></div><div>            [self ls_setFootRefreshWithArray:dict[@&quot;Circles&quot;]];</div><div>            [self ls_dismiss];</div><div><br/></div><div>        } else {</div><div><br/></div><div>            [self.refreshEndSubject sendNext:@(LSRefreshError)];</div><div>            ShowMessage(dict[@&quot;mes&quot;]);</div><div>        }</div><div>    }];</div><div>}</div><div><br/></div><div>#pragma mark - private</div><div><br/></div><div>- (NSMutableDictionary *)requestCircleListWithId:(NSString *)idStr currentPage:(NSString *)currentPage {</div><div><br/></div><div>    idStr = IF_NULL_TO_STRING(idStr);</div><div>    currentPage = IF_NULL_TO_STRING(currentPage);</div><div><br/></div><div>    NSMutableDictionary * dict = [@{@&quot;MemberID&quot;: idStr, @&quot;pageSize&quot;: LS_REQUEST_LIST_COUNT, @&quot;pageIndex&quot;:currentPage} mutableCopy];</div><div><br/></div><div>    return dict;</div><div>}</div><div><br/></div><div>- (void)ls_setFootRefreshWithArray:(NSArray *)array {</div><div><br/></div><div>    if (array.count &lt; LS_REQUEST_LIST_NUM_COUNT) {</div><div><br/></div><div>        [self.refreshEndSubject sendNext:@(LSFooterRefresh_HasNoMoreData)];</div><div>    } else {</div><div><br/></div><div>        [self.refreshEndSubject sendNext:@(LSFooterRefresh_HasMoreData)];</div><div>    }</div><div>}</div><div><br/></div><div>- (void)ls_setHeaderRefreshWithArray:(NSArray *)array {</div><div><br/></div><div>    if (array.count &lt; LS_REQUEST_LIST_NUM_COUNT) {</div><div><br/></div><div>        [self.refreshEndSubject sendNext:@(LSHeaderRefresh_HasNoMoreData)];</div><div>    } else {</div><div><br/></div><div>        [self.refreshEndSubject sendNext:@(LSHeaderRefresh_HasMoreData)];</div><div>    }</div><div>}</div><div><br/></div><div>#pragma mark - lazyLoad</div><div>- (RACSubject *)refreshUI {</div><div><br/></div><div>    if (!_refreshUI) {</div><div><br/></div><div>        _refreshUI = [RACSubject subject];</div><div>    }</div><div><br/></div><div>    return _refreshUI;</div><div>}</div><div><br/></div><div>- (RACSubject *)refreshEndSubject {</div><div><br/></div><div>    if (!_refreshEndSubject) {</div><div><br/></div><div>        _refreshEndSubject = [RACSubject subject];</div><div>    }</div><div><br/></div><div>    return _refreshEndSubject;</div><div>}</div><div><br/></div><div>- (RACCommand *)refreshDataCommand {</div><div><br/></div><div>    if (!_refreshDataCommand) {</div><div><br/></div><div>        @weakify(self);</div><div>        _refreshDataCommand = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) {</div><div><br/></div><div>            @strongify(self);</div><div>            return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) {</div><div><br/></div><div>                @strongify(self);</div><div>                self.currentPage = 1;</div><div>                [self.request POST:LS_URL_CIRCLE_MEMBER_LIST parameters:[self requestCircleListWithId:@&quot;1&quot; currentPage:[NSString stringWithFormat:@&quot;%d&quot;,self.currentPage]] success:^(CMRequest *request, NSString *responseString) {</div><div><br/></div><div>                    NSDictionary *dict = [responseString objectFromJSONString];</div><div>                    [subscriber sendNext:dict];</div><div>                    [subscriber sendCompleted];</div><div><br/></div><div>                } failure:^(CMRequest *request, NSError *error) {</div><div><br/></div><div>                    ShowErrorStatus(@&quot;网络连接失败&quot;);</div><div>                    [subscriber sendCompleted];</div><div>                }];</div><div>                return nil;</div><div>            }];</div><div>        }];</div><div>    }</div><div><br/></div><div>    return _refreshDataCommand;</div><div>}</div><div><br/></div><div>- (RACCommand *)nextPageCommand {</div><div><br/></div><div>    if (!_nextPageCommand) {</div><div><br/></div><div>        @weakify(self);</div><div>        _nextPageCommand = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) {</div><div><br/></div><div>            @strongify(self);</div><div>            return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) {</div><div><br/></div><div>                @strongify(self);</div><div>                self.currentPage ++;</div><div>                [self.request POST:LS_URL_CIRCLE_TOPIC_LIST parameters:nil success:^(CMRequest *request, NSString *responseString) {</div><div><br/></div><div>                    NSDictionary *dict = [responseString objectFromJSONString];</div><div>                    [subscriber sendNext:dict];</div><div>                    [subscriber sendCompleted];</div><div><br/></div><div>                } failure:^(CMRequest *request, NSError *error) {</div><div><br/></div><div>                    @strongify(self);</div><div>                    self.currentPage --;</div><div>                    ShowErrorStatus(@&quot;网络连接失败&quot;);</div><div>                    [subscriber sendCompleted];</div><div>                }];</div><div>                return nil;</div><div>            }];</div><div>        }];</div><div>    }</div><div><br/></div><div>    return _nextPageCommand;</div><div>}</div><div><br/></div><div>- (LSCircleListHeaderViewModel *)listHeaderViewModel {</div><div><br/></div><div>    if (!_listHeaderViewModel) {</div><div><br/></div><div>        _listHeaderViewModel = [[LSCircleListHeaderViewModel alloc] init];</div><div>        _listHeaderViewModel.title = @&quot;已加入的圈子&quot;;</div><div>        _listHeaderViewModel.cellClickSubject = self.cellClickSubject;</div><div>    }</div><div><br/></div><div>    return _listHeaderViewModel;</div><div>}</div><div><br/></div><div>- (LSCircleListSectionHeaderViewModel *)sectionHeaderViewModel {</div><div><br/></div><div>    if (!_sectionHeaderViewModel) {</div><div><br/></div><div>        _sectionHeaderViewModel = [[LSCircleListSectionHeaderViewModel alloc] init];</div><div>        _sectionHeaderViewModel.title = @&quot;推荐圈子&quot;;</div><div>    }</div><div><br/></div><div>    return _sectionHeaderViewModel;</div><div>}</div><div><br/></div><div>- (NSArray *)dataArray {</div><div><br/></div><div>    if (!_dataArray) {</div><div><br/></div><div>        _dataArray = [[NSArray alloc] init];</div><div>    }</div><div><br/></div><div>    return _dataArray;</div><div>}</div><div><br/></div><div>- (RACSubject *)cellClickSubject {</div><div><br/></div><div>    if (!_cellClickSubject) {</div><div><br/></div><div>        _cellClickSubject = [RACSubject subject];</div><div>    }</div><div><br/></div><div>    return _cellClickSubject;</div><div>}</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ViewModel也是分为三个模块，由于代码太多摘重要的讲</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅰ 第一个模块 : 处理数据、逻辑模块</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [17].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">处理数据这块，先用字典转为Model，在用Model配置ViewModel，ViewModel再去与UI及其逻辑对应。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅱ 第二个模块 : 私有函数</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [18].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">对于请求参数字典，可以放在VM中，便于模块化移植，也可以放在公共API中便于管理，看个人选择了，没有绝对的好位置，只有更适合个人的位置。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">另外两个函数就是处理下拉及上拉时有没有更多数据的私有函数。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">ⅲ 第三个模块 : 懒加载</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [19].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">此数据请求用的是AFNetworking。</span></div><h3><span style="font-weight: bold;">5、APPDelegate的代码简化</span></h3><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">一般而言，我们正式项目中会遇到很多需要启动项目时就加载的，所以很快APPDelegate就会越来越庞大，既然其他的代码都简化解耦了，这里也可以做一下处理。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">目录如下：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [20].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">简化后的AppDelegate如下：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [21].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">其他代码存放的位置如下：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [22].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold;">当类对象被引入项目时, runtime 会向每一个类对象发送 load 消息. load 方法还是非常的神奇的, 因为它会在每一个类甚至分类被引入时仅调用一次, 调用的顺序是父类优先于子类, 子类优先于分类. 而且 load 方法不会被类自动继承, 每一个类中的 load 方法都不需要像 viewDidLoad 方法一样调用父类的方法。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">这是利用了这个算是黑魔法的玩意，哈哈，就简化了APPDelegate！</span></div><h2><span style="font-weight: bold;">四、后记</span></h2><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="margin-top: 1em; margin-bottom: 1em; text-decoration: line-through;">当初本来想</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold; text-decoration: line-through;">干掉基类</span><span style="margin-top: 1em; margin-bottom: 1em; text-decoration: line-through;">来着，</span><span style="margin-top: 1em; margin-bottom: 1em; font-weight: bold; text-decoration: line-through;">想利用Category + Protocol并利用Runtime的Methode Swizzle 来给系统函数添加自己的私有函数</span><span style="margin-top: 1em; margin-bottom: 1em; text-decoration: line-through;">，当初VC已经搞定了，然而发现这样牵涉面太广，你对VC做了Category，UINavigationController 也会受到影响，假如你对View做了Category，其他继承View的也会有影响，而且当时交换方法都是在一个Category里管事，到第二个就覆盖了。。。不造为啥，因为知道这条路走不通就没继续搞下去了。。。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">写到这里，大家应该都对我笔下的设计模式有了一些了解，因为里面涉及的东西确实太多，主要是这些玩意需要站在巨人的肩膀，遇到文中没有提到而且不懂得可以：</span></div><div><img src="设计模式  (四)  MVVM + RAC_files/Image [23].jpg" type="image/jpeg" data-filename="Image.jpg"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; color: rgb(79, 129, 189); font-family: SimSun; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-size: 10.5pt; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-family: SimSun; color: rgb(79, 129, 189); font-weight: bold;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-size: 10.5pt; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-family: SimSun; color: rgb(79, 129, 189);"> </span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; color: rgb(79, 129, 189); font-family: SimSun; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; color: rgb(79, 129, 189); font-family: SimSun;"> </span></div><div><br/></div></span>
</div></body></html> 