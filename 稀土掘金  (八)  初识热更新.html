<html>
<head>
  <title>稀土掘金  (八) : 初识热更新</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="66D82FA0-3D97-4874-AAF0-BBB8D1EB00F9"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1552"/>
<h1>稀土掘金  (八) : 初识热更新</h1>

<div>
<span><div>每次提交版本都得等待一周到两周的审核时间，我是受不了这种速度了，于是决定研究有没有其他的方法跳过提交版本这个步骤，同样能够修复bug呢，于是找到了JSPatch，也许也有很多人觉得这是个很高大上的技术，其实不然，我们只需要在项目里引入极小的引擎文件，就可以使用 JavaScript 调用任何 Objective-C 的原生接口，替换任意 Objective-C 原生方法。当然呢，目前主要用于下发 JS 脚本替换原生 Objective-C 代码，实时修复线上 bug。</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">JSPatch的代码大家可以去</span><a href="https://github.com/bang590/JSPatch" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">github</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"> 上面下载</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">首先说一下JsPatch实现的内部原理：JsPatch能做到通过JS调用和改写OC方法最根本的原因是 Objective-C 是动态语言，OC上所有方法的调用/类的生成都通过 Objective-C Runtime 在运行时进行，我们可以通过类名和方法名反射得到相应的类和方法，也可以替换某个类的方法为新的实现，还可以新注册一个类，为类添加方法。这里就不详细介绍runtime了，相关的资料我会在后续的博客里介绍，大家再等等吧。所以 JSPatch 的原理就是：JS传递字符串给OC，OC通过 Runtime 接口调用和替换OC方法。这个很容易理解，JS的作用只是一个信使的作用，具体实现还是得靠我们OC,所以说OC还是世界上最美的语言，哈哈。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">同时在这里给大家一个比较好的网站 </span><a href="http://bang590.github.io/JSPatchConvertor/" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">点这里</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">.这是一个OC转JS的一个工具网站。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">下面给大家演示一下具体实现的步骤</span></div><pre><code>- (void)viewDidLoad<br/>{<br/><br/>    UITableView* tv = [[UITableView alloc]initWithFrame:self.view.bounds<br/>                                                 style:UITableViewStylePlain];<br/>    self.mqTableView = tv;<br/>    self.mqTableView.delegate = self;<br/>    self.mqTableView.dataSource = self;<br/>    [self.view addSubview:self.mqTableView];<br/><br/>}<br/>#pragma mark -- UITableViewDataSource<br/><br/>- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section<br/>{<br/>    return 3;<br/>}<br/><br/>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath<br/>{<br/>    static NSString* i=  @&quot;cell&quot;;<br/>    UITableViewCell* cell = [tableView  dequeueReusableCellWithIdentifier:i];<br/>    if (cell == nil ) {<br/>        cell =[[UITableViewCell alloc]initWithStyle:UITableViewCellStyleDefault<br/>                                    reuseIdentifier:i];<br/>    }<br/>    cell.textLabel.text = @&quot;meiqing&quot;;<br/>    cell.backgroundColor = [UIColor whiteColor];<br/>    return cell;<br/>}<br/><br/>- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath<br/>{<br/>    self.dataSource = @[@&quot;1&quot;,@&quot;2&quot;];<br/>    肯定会超出数组范围导致 crash<br/>    NSString *content = self.dataSource[indexPath.row];<br/><br/>}</code></pre><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">显示的结果是这样的</span></div><div><img src="稀土掘金  (八)  初识热更新_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">上面的图片是没有修改时候的显示，当我点击第三行一定会闪退，怎么修复呢？这个时候就不用发版本了，服务器可以给我们传送一个js文件，文件里的内容是这样的</span></div><div><img src="稀土掘金  (八)  初识热更新_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">同时，我们在APPDelegate里调用这个JS就可以了，如下：</span></div><div><img src="稀土掘金  (八)  初识热更新_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">再次运行就不会出现闪退了。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div><div><br/></div></span>
</div></body></html> 