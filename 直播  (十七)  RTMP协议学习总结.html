<html>
<head>
  <title>直播  (十七) : RTMP协议学习总结</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="96C79CCD-3643-4484-9B8E-B2B3900D206F"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1727"/>
<h1>直播  (十七) : RTMP协议学习总结</h1>

<div>
<span><div style="direction: ltr; font-family: Calibri; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">RTMP协议是一个互联网TCP/IP五层体系结构中应用层的协议。RTMP协议中基本的数据单元称为消息（Message）。当RTMP协议在互联网中传输数据的时候，消息会被拆分成更小的单元，称为消息块（Chunk）。</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">1</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">消息</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">消息是</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">协议中基本的数据单元。不同种类的消息包含不同的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Type ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，代表不同的功能。</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">协议中一共规定了十多种消息类型，分别发挥着不同的作用。例如，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Type ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">在</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">1-7</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的消息用于协议控制，这些消息一般是</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">协议自身管理要使用的消息，用户一般情况下无需操作其中的数据。</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Type ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">为</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">8</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">9</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的消息分别用于传输音频和视频数据。</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Type ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">为</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">15-20</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的消息用于发送</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">AMF</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">编码的命令，负责用户与服务器之间的交互，比如播放，暂停等等。消息首部（</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Header</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">）有四部分组成：标志消息类型的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Type ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，标志消息长度的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Payload Length</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，标识时间戳的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Timestamp</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，标识消息所属媒体流的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Stream ID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">。消息的报文结构如下图所示。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十七)  RTMP协议学习总结_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">2</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">消息块</span></div><div style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">在网络上传输数据时，消息需要被拆分成较小的数据块，才适合在相应的网络环境上传输。</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">协议中规定，消息在网络上传输时被拆分成消息块（</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">Chunk</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">）。消息块首部（</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">Chunk Header</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">）有三部分组成：用于标识本块的</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; font-family: Arial; color: #232323; background: #E56600;">Chunk Basic Header</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">，用于标识本块负载所属消息的</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; font-family: Arial; color: #333333; background: #FF9900;">Chunk Message Header</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">，以及当时间戳溢出时才出现的</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">Extended Timestamp</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">。消息块的报文结构如下图所示。</span></div><div style="direction: ltr; font-family: Calibri; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Calibri; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十七)  RTMP协议学习总结_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">3</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">消息分块</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">在消息被分割成几个消息块的过程中，消息负载部分（</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Message Body</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">）被分割成大小固定的数据块（默认是</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">128</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">字节，最后一个数据块可以小于该固定长度），并在其首部加上消息块首部（</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Chunk Header</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">），就组成了相应的消息块。消息分块过程如下图所示，一个大小为</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">307</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">字节的消息被分割成</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">128</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">字节的消息块（除了最后一个）。</span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="直播  (十七)  RTMP协议学习总结_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">传输媒体数据的过程中，发送端首先把媒体数据封装成消息，然后把消息分割成消息块，最后</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; font-family: &quot;Microsoft YaHei&quot;; color: white; background: #E53333;">将分割后的消息块通过</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; font-family: Arial; color: white; background: #E53333;">TCP</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; font-family: &quot;Microsoft YaHei&quot;; color: white; background: #E53333;">协议发送出去</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">。接收端在通过</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">TCP</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">协议收到数据后，首先把消息块重新组合成消息，然后通过对消息进行解封装处理就可以恢复出媒体数据。</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">2.1 Chunk Basic Header [1-3字节]</span></div><div style="direction: ltr; font-size: 10.8pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">HeaderType+ChannelID</span><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">组成，其中</span><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">ChannelID</span><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的大小决定了整个</span><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Chunk Basic Header</span><span style="direction: ltr; font-size: 10.8pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的大小</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri;">2.1.1</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri; mso-spacerun: yes;"> </span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">这个字段编码了消息块流的</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri;">ID</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">和消息块的类型，消息块类型决定了消息包头的编码格式，长度完全 取决于可变长的消息块流</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri;">HeaderType(fmt):</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">决定了</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri;">Chunk Message Header</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">的编码方式和大小</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Calibri;">,</span><span style="direction: ltr; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;;">在第一个字节的高两位</span></div><div style="direction: ltr; font-family: Calibri; font-size: 11pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Calibri; font-size: 11.0pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;">Bits Chunk Message Header Length</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">00   12 bytes</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">01   8 bytes</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">10   4 bytes</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">11   1 byte</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">2.1.2 ChannelID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">：</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">ChannelID</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">用途</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">02              Ping</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">和</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">ByteRead</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">通道</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">03              Invoke</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">通道 我们的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">connect() publish()</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">和自字写的</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">NetConnection.Call()</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">数据都是在这个通道的</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">04              Audio</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">和</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Vidio</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">通道</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">05 06 07     </span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">服务器保留</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">,</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">经观察</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">FMS2</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">用这些</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Channel</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">也用来发送音频或视频数据</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: Arial; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 10.5pt; background: white;">2.2 </span><span style="direction: ltr; font-family: Arial; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 10.8pt; background: white;">Chunk Message Header</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">以最大</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">fmt =00 length(</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">Chunk Message Header</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">) == 12 </span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为例</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">Chunk Message Header</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的结构是</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">:timestamp,message_length,message_type,msg_stream_id</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">其中</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">message_type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">是一个枚举变量：</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">type</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">为</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">1,2,3,5,6</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">的时候是协议控制消息</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">4</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">的时候表示</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">User Control Messages [Event_type + Event_Data] Event_type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">有</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">Stream Begin</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">，</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">Stream End...</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">8</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">，音频数据</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">9</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">，视频数据</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">18</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">元数据消息</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">[AMF0]</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">type</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">为</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">20</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">命令消息</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">Command Message(RPC Message)</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">These messages are sent to perform some operations like connect, createStream, publish, play, pause on the peer.</span></div><div style="direction: ltr; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">命令消息</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">主要分成两种</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">NetConnection</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">和</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">NetStream</span><span style="direction: ltr; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">。</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">connect</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">call</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">close</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">createStream</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">命令可以在</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">NetConnection</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">中发送。</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">coonect(name</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">TranscationID,Command Object pair)</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">play</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">，</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">publish,seek,pause</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">等命令可以在</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">NetStream</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">中发送。</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; background: white;">2.3 Ext Time Stamp</span></div><div style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: Arial; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">2.4</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">数据</span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 11.0pt;">3</span><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 11.0pt;"> </span><a href="http://blog.csdn.net/leixiaohua1020/article/details/11704355" style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 15.0pt; background: white;">RTMP</a><a href="http://blog.csdn.net/leixiaohua1020/article/details/11704355" style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-size: 15.0pt; background: white;">流媒体播放过程</a></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">协议规定，播放一个流媒体有两个前提步骤：第一步，建立一个网络连接（</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">NetConnection</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">）；第二步，建立一个网络流（</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">NetStream</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">）。其中，网络连接代表服务器端应用程序和客户端之间基础的连通关系。网络流代表了发送多媒体数据的通道。服务器和客户端之间只能建立一个网络连接，但是基于该连接可以创建很多网络流。</span></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">播放一个</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">协议的流媒体需要经过以下几个步骤：握手，建立连接，建立流，播放。</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">RTMP</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">连接都是以握手作为开始的。建立连接阶段用于建立客户端与服务器之间的“网络连接”；建立流阶段用于建立客户端与服务器之间的“网络流”；播放阶段用于传输视音频数据。</span></div><div style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; color: #333333; background: white;">参考</span><span style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; color: #333333; background: white;">:</span><a href="http://blog.csdn.net/leixiaohua1020/article/category/1362941" style="direction: ltr; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;">http://blog.csdn.net/leixiaohua1020/article/category/1362941</a></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://blog.csdn.net/leixiaohua1020/article/category/1362941" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">RTMP</a><a href="http://blog.csdn.net/leixiaohua1020/article/category/1362941" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; background: white;">协议中文版</a></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://wenku.baidu.com/link?url=Lc4gR-FLeCkHCMM1NL-FcAUtKFTRaFn0tcdoqcid6Dtvu_Q2wlSQ-GMY711Ptc_TdeG2KU0E9e-aHddFVZJSMwt2CujY2p7AdHg8Vr15HuG" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">http://wenku.baidu.com/link?url=Lc4gR-FLeCkHCMM1NL-FcAUtKFTRaFn0tcdoqcid6Dtvu_Q2wlSQ-GMY711Ptc_TdeG2KU0E9e-aHddFVZJSMwt2CujY2p7AdHg8Vr15HuG</a></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://blog.csdn.net/leixiaohua1020/article/category/1362941" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.8pt; background: white;">RTMP</a><a href="http://blog.csdn.net/leixiaohua1020/article/category/1362941" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; background: white;">协议</a><span style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.8pt; color: #333333; background: white; text-decoration: underline;">英文版</span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/rtmp/pdf/rtmp_specification_1.0.pdf" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/rtmp/pdf/rtmp_specification_1.0.pdf</a></div><div style="direction: ltr; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: &quot;Microsoft YaHei&quot;; background: white;">开源项目</span><span style="direction: ltr; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; background: white;"> RTMP Dump</span></div><div style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><a href="http://rtmpdump.mplayerhq.hu/" style="direction: ltr; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-family: Arial; font-size: 10.5pt; background: white;">http://rtmpdump.mplayerhq.hu/</a></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: 'Microsoft YaHei'; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: 'Microsoft YaHei'; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: 'Microsoft YaHei'; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div><div style="direction: ltr; font-family: 'Microsoft YaHei'; font-size: 10.5pt; color: rgb(51, 51, 51); -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: &quot;Microsoft YaHei&quot;; font-size: 10.5pt; color: #333333; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%;"> </span></div><div><br/></div></span>
</div></body></html> 