<html>
<head>
  <title>稀土掘金  (十七) : 教你反编译别人的app</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="EFC239FF-FB08-43BA-B002-C4466A005545"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1137"/>
<h1>稀土掘金  (十七) : 教你反编译别人的app</h1>

<div>
<span><div>虽然iOS系统相比于其他手机操作系统相对安全，但是这个安全并不是绝对的，我一直相信，道高一尺魔高一丈。此文想以实际例子出发，告诉大家，如何去反编译一个app，并且从某个角度来说，iOS没有传说中的“安全”。</div><div><br/></div><div><span style="font-weight: bold;">这里只最简单的结论给大家，具体原理以及工具的详细使用，请各位自行Google，为什么这么做呢，因为我想用最简单的语言，让没有汇编基础的同学也能明白。</span></div><div><br/></div><h4>将用以下几个方面来阐述我的观点：</h4><ul><li>iOS app可以“有条件”地被反编译</li><li>脱掉App Store给“二级制文件”穿上的外衣</li><li>如何利用工具去反编译</li><li>在感兴趣的地方生成伪代码</li><li>如何预防反编译</li></ul><h5>iOS app可以“有条件”地被反编译</h5><div>首先，告诉大家一个不幸的消息，上架至App Store的app，被apple加密了。所以标题才是“有条件”才能进行反编译，令人欣喜的是，在debug下产生的ipa或者是release下的ipa包或者是渠道包（各种应用市场能下的ipa包）都能直接反编译。</div><div><br/></div><h5>脱掉App Store给“二级制文件”穿上外衣</h5><div>当然，引言已经说了，道高一尺魔高一丈，就算是被apple加密的ipa，其实也是可以反编译的，只不过相对麻烦罢了。</div><div>来来来，给你们几个工具，就可以解掉apple的加密了。</div><ul><li>clutch</li><li>dumpdecrypted</li><li>gdb</li><li>AppCrackr</li></ul><div>由于AppCrackr被很多开发者吐槽，这个傻瓜式的解密会严重导致盗版泛滥，所以这个工具已经很不好用了。</div><div>这里就不展示demo了，感觉如果把App Store上的东西反编译出来发到网上去，我感觉我的程序员生涯可能就要到头了。</div><h5>如何利用工具去反编译</h5><div>这里会介绍两个工具<span style="font-weight: bold;">class-dump</span>和<span style="font-weight: bold;">Hopper Disassembler</span>。</div><div>首先，先撸一个最简单的app来做小白鼠。<a href="https://github.com/kuailejim/demo">下载地址（包含二进制文件&amp;dump结果）</a></div><div>看图，就是这样，我只改了ViewController这个类。</div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div><br/></div><div>由代码可以看出，我就写了两个方法testClassDump和testHideClassDump，后者没有声明在.h中（ps：我想试验这样能不能被反编译到）。</div><div><br/></div><div><span style="font-weight: bold;">ok，前戏都做完了，可以开始干活了。</span></div><div><br/></div><div>我们run一下工程，然后打开Products文件夹下的DecompilingTest.app所在目录，显示包内容，拿到<span style="font-weight: bold;">二进制文件</span>。</div><div><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div>然后我是复制到桌面，然后执行下述命令，即可拿到工程中的.h文件。</div><div><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></div><div>OK，得到下述结果，我们看看拿到的ViewController.h里面，能拿到什么方法</div><div><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [4].png" type="image/png" data-filename="Image.png"/><br/></div><div><span style="font-weight: bold;">事实证明，没有声明的方法也被dump出来了。</span></div><div><br/></div><div>下一步我们要做的就是看看能不能拿到这两个方法的具体实现了，接下来我们用<span style="font-weight: bold;">Hopper Disassembler</span>来试试。</div><div><br/></div><div><span style="font-weight: bold;">Hopper Disassembler</span>的用法很简单，只要将二进制文件拖进去就行了。看看拖进去之后的结果。</div><div><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [5].png" type="image/png" data-filename="Image.png"/><br/></div><div>此时心中一万头草泥马飞奔而过，what’s the fk！！一堆汇编语言宝宝看不懂啊。（当然那个ret应该是return的意思我猜）</div><div><br/></div><h5>在感兴趣的地方生成伪代码</h5><div>Don’t worry！点右上角的<span style="font-weight: bold;">if(b)f(x);</span>按钮，我们能看到这个方法的伪代码，大部分的时候我们能从伪代码中看出我们需要的信息。</div><div><br/></div><div>结果如下：</div><div><br/></div><div><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [6].png" type="image/png" data-filename="Image.png"/><img src="稀土掘金  (十七)  教你反编译别人的app_files/Image [7].png" type="image/png" data-filename="Image.png"/><br/></div><div>至此，两个方法都被反编译出来了！！</div><div><br/></div><div><span style="font-weight: bold;">这里需要注意，就算方法没有声明在.h中，也能被dump，之后就能被反编译了。</span></div><div><br/></div><h5>如何预防反编译</h5><div>说了这么多，我们预防呢，是不是需要像Java的一样加上各种复杂的<span style="font-weight: bold;">混淆</span>呢。</div><div><br/></div><div>其实我觉得大可不必，本身反编译成本就很大，代码这么多，一个个反编译过来是在蛋疼，就算有伪代码也需要理解，而且有些代码就算有伪代码也很难理解。</div><div><br/></div><div><span style="font-weight: bold;">只要做好核心代码，做好混淆就行了，比如涉及到密码，核心算法。</span></div><div><br/></div><h5>总结：</h5><div><span style="font-weight: bold;">没有绝对安全的系统，也没有黑客破不掉的系统，所有需要的只是时间而已。</span></div><div><br/></div><div><br/></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div><div><br/></div></span>
</div></body></html> 