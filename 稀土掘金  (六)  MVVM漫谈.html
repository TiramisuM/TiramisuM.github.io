<html>
<head>
  <title>稀土掘金  (六) : MVVM漫谈</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="application-data:corenote-hostUUID" content="C8940BC2-A53C-4B55-B59C-4779464BC778"/>
  <meta name="application-data:corenote-localUUID" content="209A34F1-89D9-4DD0-89D6-9BFBE6F62DE4"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1556"/>
<h1>稀土掘金  (六) : MVVM漫谈</h1>

<div>
<span><div>我个人对MVVM的理解主要是借鉴于之前的用过的MVC的Web框架~在学校的时候用过ThinkPHP框架，和SSH框架，都是MVC的架构模式，今天MVVM与传统的MVC可谓是极为相似，也可以说是兄弟关系，也就是一家人了。</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">说到架构设计和团队协作，这个对App的开发还是比较重要的。即使作为一个专业的搬砖者，前提是你这砖搬完放在哪？不只是Code有框架，其他的东西都是有框架的，比如桥梁等等神马的~在这儿就不往外扯了。一个好的工程框架不进可以提高团队的协作效率，同时还可以减少代码的冗余度和耦合性，合理的分工与系统的架构设计是少不了的。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">至于团队协作不仅仅是有SVN或者Git这些版本控制工具就行的，至于如何在iOS开发中使用SVN,请参考之前的博客（</span><a href="http://www.cnblogs.com/ludashi/p/4018245.html" style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">iOS开发之版本控制（SVN）</a><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">）。一个团队可以高效的工作，本人觉得交流是最为重要的，团队中的每个人都比较和气，而且交流上没有什么障碍（不过有的团队中总有几个合不来的人），交流在团队中最为重要。至于SVN怎么用，那都不是事儿！交流思想，共同学习！</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold;">一、小酌一下MVVM</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">在这呢也不赘述什么是MVC,神马又是MVVM了,在百度上谷歌一下一抓一大把，在这儿就简单的提上一嘴。下面的Demo用的就是MVVM的架构模式。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Model层是少不了的了，我们得有东西充当DTO(数据传输对象)，当然，用字典也是可以的，编程么，要灵活一些。Model层是比较薄的一层，如果学过Java的小伙伴的话，对JavaBean应该不陌生吧。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ViewModel层，就是View和Model层的粘合剂，他是一个放置用户输入验证逻辑，视图显示逻辑，发起网络请求和其他各种各样的代码的极好的地方。说白了，就是把原来ViewController层的业务逻辑和页面逻辑等剥离出来放到ViewModel层。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">View层，就是ViewController层，他的任务就是从ViewModel层获取数据，然后显示。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">上面对MVVM就先简单的这么一说，好好的理解并应用的话，还得实战。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold;">二、关于工程中是否使用StoryBoard的论述</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">从网上经常看到说不推荐使用StoryBoard或者Xib,推荐用纯代码手写。个人认为这种观点是和苹果设计StoryBoard的初衷相悖的，在我做过的项目中是以StoryBoard为主，xib为辅，然后用代码整合每个StoryBoard.</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">举一个用Storyboard好处的例子就OK了，给控件添加约束，如果用Storyboard完成那是分分秒的事情，而用代码的添加约束的话是何等的恶心，纯代码写的话会把大量的时间花在写UI上，而且技术含量是比较低的，这个个人认为没什么必要。在团队合作中负责UI开发的小伙伴只需没人负责一个Storyboard,各开发各的，用SVN提交时把下面的勾（如下图）去掉即可，这样用Storyboard是没有问题的。然后再用代码进行整合就OK了。如果你在你的工程中加入了新的资源文件的话，用XCode自带的SVN提交的话需要吧Project Setting文件一并提交。</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image.png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-weight: bold;">三、实战MVVM（用Xcode创建的Group是虚拟的文件夹，为了便于维护，建议创建物理文件夹，然后再手动引入）</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">1.下面通过一个实例来体会一下MVVM架构模式，下面是该工程的一级目录如下，每层之间的交互是用Block的形式来实现的</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">工程目录说明：</span></div><ol style="list-style-type: decimal;"><li>Request:文件夹下存储网络请求的类，下面会给出具体的实现</li><li>Config:就是工程的配置文件</li><li>Resource:就是工程的资源文件，下面有图片资源和Storyboard文件资源</li><li>Tools是:工具文件类，存放工具类，比如数据正则匹配等。</li><li>Vender:存放第三方类库</li><li>Model:这个就不多说了</li><li>ViewController:存放ViewController类资源文件，也就是View层</li><li>ViewModel：存放各种业务逻辑和网络请求</li></ol><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">2.详解Request:Request负责网络请求的东西，具体如下：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [2].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">NetRequestClass是存放网络请求的代码，本工程用的AF，因为本工程只是一个Demo,所以就只封装了监测网络状态，GET请求，POST请求方法，根据现实需要，还可以封装上传下载等类方法。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">NetRequestClass.h中的代码如下：</span></div><div>#import @interface NetRequestClass : NSObject</div><div><br/></div><div>#pragma 监测网络的可链接性</div><div>+ (BOOL) netWorkReachabilityWithURLString:(NSString *) strUrl;</div><div><br/></div><div>#pragma POST请求</div><div>+ (void) NetRequestPOSTWithRequestURL: (NSString *) requestURLString</div><div>                        WithParameter: (NSDictionary *) parameter</div><div>                 WithReturnValeuBlock: (ReturnValueBlock) block</div><div>                   WithErrorCodeBlock: (ErrorCodeBlock) errorBlock</div><div>                     WithFailureBlock: (FailureBlock) failureBlock;</div><div><br/></div><div>#pragma GET请求</div><div>+ (void) NetRequestGETWithRequestURL: (NSString *) requestURLString</div><div>                        WithParameter: (NSDictionary *) parameter</div><div>                WithReturnValeuBlock: (ReturnValueBlock) block</div><div>                  WithErrorCodeBlock: (ErrorCodeBlock) errorBlock</div><div>                    WithFailureBlock: (FailureBlock) failureBlock;</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">NetRequestClass.m中的代码如下：</span></div><div>#import &quot;NetRequestClass.h&quot;</div><div><br/></div><div>@interface NetRequestClass ()</div><div><br/></div><div>@end</div><div><br/></div><div><br/></div><div>@implementation NetRequestClass</div><div>#pragma 监测网络的可链接性</div><div>+ (BOOL) netWorkReachabilityWithURLString:(NSString *) strUrl</div><div>{</div><div>    __block BOOL netState = NO;</div><div>    </div><div>    NSURL *baseURL = [NSURL URLWithString:strUrl];</div><div>    </div><div>    AFHTTPRequestOperationManager *manager = [[AFHTTPRequestOperationManager alloc] initWithBaseURL:baseURL];</div><div>    </div><div>    NSOperationQueue *operationQueue = manager.operationQueue;</div><div>    </div><div>    [manager.reachabilityManager setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) {</div><div>        switch (status) {</div><div>            case AFNetworkReachabilityStatusReachableViaWWAN:</div><div>            case AFNetworkReachabilityStatusReachableViaWiFi:</div><div>                [operationQueue setSuspended:NO];</div><div>                netState = YES;</div><div>                break;</div><div>            case AFNetworkReachabilityStatusNotReachable:</div><div>                netState = NO;</div><div>            default:</div><div>                [operationQueue setSuspended:YES];</div><div>                break;</div><div>        }</div><div>    }];</div><div>    </div><div>    [manager.reachabilityManager startMonitoring];</div><div>    </div><div>    return netState;</div><div>}</div><div><br/></div><div><br/></div><div>/***************************************</div><div> 在这做判断如果有dic里有errorCode</div><div> 调用errorBlock(dic)</div><div> 没有errorCode则调用block(dic</div><div> ******************************/</div><div><br/></div><div>#pragma --mark GET请求方式</div><div>+ (void) NetRequestGETWithRequestURL: (NSString *) requestURLString</div><div>                       WithParameter: (NSDictionary *) parameter</div><div>                WithReturnValeuBlock: (ReturnValueBlock) block</div><div>                  WithErrorCodeBlock: (ErrorCodeBlock) errorBlock</div><div>                    WithFailureBlock: (FailureBlock) failureBlock</div><div>{</div><div>    AFHTTPRequestOperationManager *manager = [[AFHTTPRequestOperationManager alloc] init];</div><div>    </div><div>    AFHTTPRequestOperation *op = [manager GET:requestURLString parameters:parameter success:^(AFHTTPRequestOperation *operation, id responseObject) {</div><div>        NSDictionary *dic = [NSJSONSerialization JSONObjectWithData:responseObject options:NSJSONReadingAllowFragments error:nil];</div><div>        DDLog(@&quot;%@&quot;, dic);</div><div>        </div><div>        block(dic);</div><div>        </div><div>    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {</div><div>        failureBlock();</div><div>    }];</div><div>    </div><div>    op.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div>    </div><div>    [op start];</div><div>    </div><div>}</div><div><br/></div><div>#pragma --mark POST请求方式</div><div><br/></div><div>+ (void) NetRequestPOSTWithRequestURL: (NSString *) requestURLString</div><div>                        WithParameter: (NSDictionary *) parameter</div><div>                 WithReturnValeuBlock: (ReturnValueBlock) block</div><div>                   WithErrorCodeBlock: (ErrorCodeBlock) errorBlock</div><div>                     WithFailureBlock: (FailureBlock) failureBlock</div><div>{</div><div>    AFHTTPRequestOperationManager *manager = [[AFHTTPRequestOperationManager alloc] init];</div><div>    </div><div>    AFHTTPRequestOperation *op = [manager POST:requestURLString parameters:parameter success:^(AFHTTPRequestOperation *operation, id responseObject) {</div><div>        NSDictionary *dic = [NSJSONSerialization JSONObjectWithData:responseObject options:NSJSONReadingAllowFragments error:nil];</div><div>        </div><div>        DDLog(@&quot;%@&quot;, dic);</div><div>        </div><div>        block(dic);</div><div>        /***************************************</div><div>         在这做判断如果有dic里有errorCode</div><div>         调用errorBlock(dic)</div><div>         没有errorCode则调用block(dic</div><div>         ******************************/</div><div>        </div><div>    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {</div><div>        failureBlock();</div><div>    }];</div><div>    </div><div>    op.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div>    </div><div>    [op start];</div><div><br/></div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">3.详解Config:创建pch文件，和Config.h文件</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">pch文件引入常用的头文件，内容如下：</span></div><div>#ifndef MVVMTest_PrefixHeader_pch</div><div>#define MVVMTest_PrefixHeader_pch</div><div><br/></div><div>#import&quot;AFNetworking.h&quot;</div><div>#import &quot;UIKit+AFNetworking.h&quot;</div><div>#import &quot;Config.h&quot;</div><div><br/></div><div>#import &quot;NetRequestClass.h&quot;</div><div>#import &quot;SVProgressHUD.h&quot;</div><div>#endif</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Config.h中就是各种宏定义和各种枚举类型和block类型，代码如下：</span></div><div>#ifndef MVVMTest_Config_h</div><div>#define MVVMTest_Config_h</div><div><br/></div><div>//定义返回请求数据的block类型</div><div>typedef void (^ReturnValueBlock) (id returnValue);</div><div>typedef void (^ErrorCodeBlock) (id errorCode);</div><div>typedef void (^FailureBlock)();</div><div>typedef void (^NetWorkBlock)(BOOL netConnetState);</div><div><br/></div><div>#define DDLog(xx, ...)  NSLog(@&quot;%s(%d): &quot; xx, __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__)</div><div><br/></div><div>//accessToken</div><div>#define ACCESSTOKEN @&quot;你自己的access_token&quot;</div><div><br/></div><div>//请求公共微博的网络接口</div><div>#define REQUESTPUBLICURL @&quot;<a href="https://api.weibo.com/2/statuses/public_timeline.json">https://api.weibo.com/2/statuses/public_timeline.json</a>&quot;</div><div><br/></div><div>#define SOURCE @&quot;source&quot;</div><div>#define TOKEN @&quot;access_token&quot;</div><div>#define COUNT @&quot;count&quot;</div><div><br/></div><div>#define STATUSES @&quot;statuses&quot;</div><div>#define CREATETIME @&quot;created_at&quot;</div><div>#define WEIBOID @&quot;id&quot;</div><div>#define WEIBOTEXT @&quot;text&quot;</div><div>#define USER @&quot;user&quot;</div><div>#define UID @&quot;id&quot;</div><div>#define HEADIMAGEURL @&quot;profile_image_url&quot;</div><div>#define USERNAME @&quot;screen_name&quot;</div><div><br/></div><div>#endif</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">4.详解资源文件Resource，结构如下图：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [4].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Image中就存放各种图片（3x,2x等），InterfaceBuider里面就是放一些Xib和Storyboard文件，每个负责UI的开发人员负责一个Storyboard</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">5.详解Model:本工程用的是请求公共微博接口我们需要在页面上现实用户的头像，用户名，发布日期，博文，已经隐式的用户ID和微博ID,文件目录结构如下：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [5].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">PublicModel中的内容如下：</span></div><div>#import @interface PublicModel : NSObject</div><div>@property (strong, nonatomic) NSString *userId;</div><div>@property (strong, nonatomic) NSString *weiboId;</div><div>@property (strong, nonatomic) NSString *userName;</div><div>@property (strong, nonatomic) NSURL *imageUrl;</div><div>@property (strong, nonatomic) NSString *date;</div><div>@property (strong, nonatomic) NSString *text;</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">6.详解ViewModel层，本层是最为重要的一层，下面是本层的详细截图，ViewModeClass是所有ViewMode的父类，其中存储着共同部分</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [6].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ViewModelClass.h中的内容如下：</span></div><div>#import @interface ViewModelClass : NSObject</div><div><br/></div><div>@property (strong, nonatomic) ReturnValueBlock returnBlock;</div><div>@property (strong, nonatomic) ErrorCodeBlock errorBlock;</div><div>@property (strong, nonatomic) FailureBlock failureBlock;</div><div><br/></div><div><br/></div><div>//获取网络的链接状态</div><div>-(void) netWorkStateWithNetConnectBlock: (NetWorkBlock) netConnectBlock WithURlStr: (NSString *) strURl;</div><div><br/></div><div>// 传入交互的Block块</div><div>-(void) setBlockWithReturnBlock: (ReturnValueBlock) returnBlock</div><div>                 WithErrorBlock: (ErrorCodeBlock) errorBlock</div><div>               WithFailureBlock: (FailureBlock) failureBlock;</div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">ViewModelClass.m中的内容如下：</span></div><div>#import &quot;ViewModelClass.h&quot;</div><div>@implementation ViewModelClass</div><div><br/></div><div>#pragma 获取网络可到达状态</div><div>-(void) netWorkStateWithNetConnectBlock: (NetWorkBlock) netConnectBlock WithURlStr: (NSString *) strURl;</div><div>{</div><div>    BOOL netState = [NetRequestClass netWorkReachabilityWithURLString:strURl];</div><div>    netConnectBlock(netState);</div><div>}</div><div><br/></div><div>#pragma 接收穿过来的block</div><div>-(void) setBlockWithReturnBlock: (ReturnValueBlock) returnBlock</div><div>                 WithErrorBlock: (ErrorCodeBlock) errorBlock</div><div>               WithFailureBlock: (FailureBlock) failureBlock</div><div>{</div><div>    _returnBlock = returnBlock;</div><div>    _errorBlock = errorBlock;</div><div>    _failureBlock = failureBlock;</div><div>}</div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">PublicWeiboViewModel.h中的内容如下：</span></div><div>#import &quot;ViewModelClass.h&quot;</div><div>#import &quot;PublicModel.h&quot;</div><div><br/></div><div>@interface PublicWeiboViewModel : ViewModelClass</div><div>//获取围脖列表</div><div>-(void) fetchPublicWeiBo;</div><div><br/></div><div>//跳转到微博详情页</div><div>-(void) weiboDetailWithPublicModel: (PublicModel *) publicModel WithViewController: (UIViewController *)superController;</div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">PublicWeiboViewModel.m中的内容如下：</span></div><div>#import &quot;PublicWeiboViewModel.h&quot;</div><div>#import &quot;PublicDetailViewController.h&quot;</div><div><br/></div><div>@implementation PublicWeiboViewModel</div><div><br/></div><div>//获取公共微博</div><div>-(void) fetchPublicWeiBo</div><div>{</div><div>    NSDictionary *parameter = @{TOKEN: ACCESSTOKEN,</div><div>                                COUNT: @&quot;100&quot;</div><div>                                };</div><div>    [NetRequestClass NetRequestGETWithRequestURL:REQUESTPUBLICURL WithParameter:parameter WithReturnValeuBlock:^(id returnValue) {</div><div>        </div><div>        DDLog(@&quot;%@&quot;, returnValue);</div><div>        [self fetchValueSuccessWithDic:returnValue];</div><div>        </div><div>    } WithErrorCodeBlock:^(id errorCode) {</div><div>        DDLog(@&quot;%@&quot;, errorCode);</div><div>        [self errorCodeWithDic:errorCode];</div><div>        </div><div>    } WithFailureBlock:^{</div><div>        [self netFailure];</div><div>        DDLog(@&quot;网络异常&quot;);</div><div>        </div><div>    }];</div><div>    </div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div>#pragma 获取到正确的数据，对正确的数据进行处理</div><div>-(void)fetchValueSuccessWithDic: (NSDictionary *) returnValue</div><div>{</div><div>    //对从后台获取的数据进行处理，然后传给ViewController层进行显示</div><div>    </div><div>    NSArray *statuses = returnValue[STATUSES];</div><div>    NSMutableArray *publicModelArray = [[NSMutableArray alloc] initWithCapacity:statuses.count];</div><div>    </div><div>    for (int i = 0; i &lt; statuses.count; i ++) {</div><div>        PublicModel *publicModel = [[PublicModel alloc] init];</div><div>        </div><div>        //设置时间</div><div>        NSDateFormatter *iosDateFormater=[[NSDateFormatter alloc]init];</div><div>        iosDateFormater.dateFormat=@&quot;EEE MMM d HH:mm:ss Z yyyy&quot;;</div><div>        </div><div>        //必须设置，否则无法解析</div><div>        iosDateFormater.locale=[[NSLocale alloc]initWithLocaleIdentifier:@&quot;en_US&quot;];</div><div>        NSDate *date=[iosDateFormater dateFromString:statuses[i][CREATETIME]];</div><div>        </div><div>        //目的格式</div><div>        NSDateFormatter *resultFormatter=[[NSDateFormatter alloc]init];</div><div>        [resultFormatter setDateFormat:@&quot;MM月dd日 HH:mm&quot;];</div><div>        </div><div>        publicModel.date = [resultFormatter stringFromDate:date];</div><div>        publicModel.userName = statuses[i][USER][USERNAME];</div><div>        publicModel.text = statuses[i][WEIBOTEXT];</div><div>        publicModel.imageUrl = [NSURL URLWithString:statuses[i][USER][HEADIMAGEURL]];</div><div>        publicModel.userId = statuses[i][USER][UID];</div><div>        publicModel.weiboId = statuses[i][WEIBOID];</div><div>        </div><div>        [publicModelArray addObject:publicModel];</div><div>        </div><div>    }</div><div>    </div><div>    self.returnBlock(publicModelArray);</div><div>}</div><div><br/></div><div>#pragma 对ErrorCode进行处理</div><div>-(void) errorCodeWithDic: (NSDictionary *) errorDic</div><div>{</div><div>    self.errorBlock(errorDic);</div><div>}</div><div><br/></div><div>#pragma 对网路异常进行处理</div><div>-(void) netFailure</div><div>{</div><div>    self.failureBlock();</div><div>}</div><div><br/></div><div><br/></div><div>#pragma 跳转到详情页面，如需网路请求的，可在此方法中添加相应的网络请求</div><div>-(void) weiboDetailWithPublicModel: (PublicModel *) publicModel WithViewController:(UIViewController *)superController</div><div>{</div><div>    DDLog(@&quot;%@,%@,%@&quot;,publicModel.userId,publicModel.weiboId,publicModel.text);</div><div>    UIStoryboard *storyboard = [UIStoryboard storyboardWithName:@&quot;Main&quot; bundle:[NSBundle mainBundle]];</div><div>    PublicDetailViewController *detailController = [storyboard instantiateViewControllerWithIdentifier:@&quot;PublicDetailViewController&quot;];</div><div>    detailController.publicModel = publicModel;</div><div>    [superController.navigationController pushViewController:detailController animated:YES];</div><div>    </div><div>}</div><div><br/></div><div><br/></div><div>@end</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">7.ViewController层的目录结构如下：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [7].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">上面的代码就不一一粘了（主要是手按command + C 按累了），后面的链接会有源码</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">8.storybord中的结构如下：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [8].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">运行的最终效果：</span></div><div style="text-align: center; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><img src="稀土掘金  (六)  MVVM漫谈_files/Image [9].png" type="image/png" data-filename="Image.png"/><br/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">9.完整目录结构，页面间的业务逻辑，和网络的请求数据是放在ViewModel层的，当然了这也不是绝对的，要灵活把握。我个人是特别喜欢编程的，因为编程灵活起来就会很有乐趣。</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">10.文章快结束了，在这儿在总结一下SVN使用频率比较高的而且比较重要的命令吧（当然，本人平时主要是用XCode自带的SVN可视化管理~）</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">（1）、更新本地代码命令</span></div><ul style="list-style-type: disc;"><li>svn  up 更新版本</li><li>svn info 查看当前版本信息</li></ul><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">（2）、代码的提交</span></div><ul style="list-style-type: disc;"><li>svn info 查看当前本地版本信息</li><li>svn up 更新到最新版本信息</li><li>svn st 查看文件状态 M-修改  D-删除 A-添加 U-更新  ?-未知状态  !-警告  C-冲突</li><li>svn add fileName: 如果出现？一般是添加文件时出的问题，在把文件svn add fileName一下后，该文件的状态会改成A</li><li>svn del fileName:如果出现！一般是删除文件时会出现的警告需呀执行svn del fileName命令后，该文件的状态会改成D</li><li>svn ci -m&quot;提交的原因”</li></ul><div><br/></div><div><br/></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">笔记整理：Edison</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; font-weight: bold; color: rgb(79, 129, 189); unicode-bidi: embed;">联系方式：QQ：277593 （笔记意见建议可加此Q，专人更新此笔记）；</span></div><div style="direction: ltr; font-family: Menlo; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><span style="direction: ltr; font-family: SimSun; font-size: 10.5pt; -en-paragraph: true; margin-top: 1em; margin-bottom: 1em; border-width: 100%; color: rgb(79, 129, 189); unicode-bidi: embed;"> </span></div><div><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%; font-weight: bold;">注：小道途径获取到的笔记，无法自动更新，请谅解！(笔记平均每月更新一次，祝各位都能拿到心仪的offer)</span><span style="direction: ltr; font-family: SimSun; color: rgb(79, 129, 189); margin-top: 1em; margin-bottom: 1em; unicode-bidi: embed; font-size: 10.5pt; -en-paragraph: true; border-width: 100%;"> </span></div><div><br/></div></span>
</div></body></html> 